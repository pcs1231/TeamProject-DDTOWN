<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>신고 관리 - DDTOWN 관리자</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="text/javascript" src="${pageContext.request.contextPath}/resources/ckeditorInquiry/ckeditor.js"></script>
    
<style >
.input-group-append {
    display: flex;
}

.status-badge.noReportcnt {
    background-color: #ffc107; /* 주황색 */
    color: #343a40; /* 배경색이 밝으므로 글자색을 어둡게 (검정 계열) */
}

.status-badge.reason-RRC001 { /* 예: '스팸' 사유 */
    background-color: #6c757d; /* 회색 - 진한 색으로 */
    color: #fff; /* 글자색은 흰색 */
}
.status-badge.reason-RRC002 { /* 예: '욕설' 사유 */
    background-color: #17a2b8; /* 청록색 - 진한 색으로 */
    color: #fff; /* 글자색은 흰색 */
}
.status-badge.reason-RRC003 { /* 예: '음란물' 사유 */
    background-color: #dc3545; /* 빨간색 - 진한 색으로 */
    color: #fff; /* 글자색은 흰색 */
}
.status-badge.reason-RRC004 { /* 예: '기타' 사유 */
    background-color: #6f42c1; /* 보라색 - 진한 색으로 */
    color: #fff; /* 글자색은 흰색 */
}
/* 처리상태 색부분 */
.report-status-badge {
    display: inline-block; /* 인라인 요소처럼 배치하되, width/height, padding, margin 등을 적용할 수 있도록 합니다. */
    padding: 0.5em 0.6em; /* 뱃지 안쪽 여백을 설정합니다.  em은 글자 크기에 비례하는 단위입니다. */
    border-radius: 12em;      /* 뱃지의 모서리를 둥글게 만듭니다. */
    font-size: 0.9em;         /* 뱃지 안 글자 크기를 설정합니다. */
    font-weight: bold;        /* 글자를 굵게 만듭니다. */
    text-align: center;       /* 글자를 가운데 정렬합니다. */
    white-space: nowrap;      /* 텍스트가 줄바꿈되지 않도록 합니다. */
    color: #fff;             /* 기본 글자색은 흰색으로 설정합니다. */
}

/* '접수됨' 상태 스타일 */
.report-status-badge.status-received {
    background-color: #007bff; /* 파란색 */
    color: #fff;
}

/* '처리 완료' 상태 스타일 */
.report-status-badge.status-completed {
    background-color: #28a745; /* 초록색 */
    color: #fff;
}


</style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="emp-content">
                <section id="reportListSection" class="ea-section active-section">
                    <div class="ea-section-header">
                        <h2>신고 관리</h2>
                        <div class="status-badges-container">
	                        <div class="status-badge noReportcnt">
						        <span class="label">미처리</span>
						        <span class="count">${reportCnt}명</span>
						    </div>
						    
						    <%-- 2. 사유별 신고 인원 뱃지 (동적으로 생성) --%>
						    <c:forEach var="entry" items="${reportReasonCnt}">
							    <div class="status-badge reason-${entry.key}">
							        <span class="label">
							            <c:choose>
							                <c:when test="${entry.key eq 'RRC001'}">스팸</c:when>
							                <c:when test="${entry.key eq 'RRC002'}">욕설</c:when>
							                <c:when test="${entry.key eq 'RRC003'}">음란물</c:when>
							                <c:when test="${entry.key eq 'RRC004'}">기타</c:when>
							                <c:otherwise>${entry.key}</c:otherwise>
							            </c:choose>
							        </span>
							        <span class="count">${entry.value}명</span>
							    </div>
							</c:forEach>
 <!-- 신고검색부분 -->    	</div>
                        <div class="ea-header-actions"> 
	                         <form class="input-group input-group-sm" method="get" id="searchForm" style="flex-wrap: nowrap; ">                                      
								<input type="hidden" name="page" id="page"/>
	                            <select id="searchType" name="searchType" class="ea-filter-select" onchange="this.form.submit();" title="신고 유형 필터">
	                                <option value="all" ${searchType == 'all' ? 'selected' : ''}>전체 유형</option>
	                                <option value="RTTC001" ${searchType == 'RTTC001' ? 'selected' : ''}>게시물</option>
	                                <option value="RTTC002" ${searchType == 'RTTC002' ? 'selected' : ''}>댓글</option>
	                                <option value="RTTC003" ${searchType == 'RTTC003' ? 'selected' : ''}>채팅</option>
	                            </select>&nbsp;
	                            <select id="searchCode" name="searchCode" class="ea-filter-select" onchange="this.form.submit();" title="처리 상태 필터">
	                                <option value="all" ${searchCode == 'all' ? 'selected' : ''}>전체 상태</option>
	                                <option value="RSC001" ${searchCode == 'RSC001' ? 'selected' : ''}>접수됨</option>
	                                <option value="RSC002" ${searchCode == 'RSC002' ? 'selected' : ''}>처리완료</option>
	                            </select>&nbsp;
	                            <input type="text" class="ea-search-input" name="searchWord" id="reportSearchInput" placeholder="신고 대상, 신고자 검색"  value="${searchWord}">&nbsp;
								<div class="input-group-append">
									<button type="submit" id="memberSearchButton" class="ea-btn primary" style="width:60px;" >검색</button>
									<button type="button" id="resetSearchButton" class="ea-btn" style="width:70px; margin-left: 5px;">초기화</button>
								</div>
							</form>
                        </div>                       
                    </div>
<!-- 신고 목록 부분 -->
                    <table class="ea-table">
                        <thead>
                            <tr>
                                <th class="col-report-id">신고번호</th>
                                <th class="col-status">처리상태</th>
                                <th class="col-report-typeNo">게시글 번호</th>
                                <th class="col-report-type">신고유형</th>
                                <th class="col-reported-writer">신고대상</th>
                                <th class="col-reason">신고 사유</th>
                                <th class="col-reporter">신고자</th>
                                <th class="col-report-date">신고일</th>
                                <th class="col-status">동일 신고 수</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                       		<c:forEach items="${reportList}" var="report">
                        		<tr data-report-id="RPT001">
	                                <td>${report.reportNo }</td>
	                                <td>
	                                	 <span class="report-status-badge new
									        <c:choose>
									            <c:when test="${report.reportStatCode eq 'RSC001'}">status-received</c:when>
									            <c:when test="${report.reportStatCode eq 'RSC002'}">status-completed</c:when>
									        </c:choose>
									    ">
		                                	<c:choose>
		                                			<c:when test="${report.reportStatCode eq 'RSC001'}">접수됨</c:when>
					                       			<c:when test="${report.reportStatCode eq 'RSC002'}">처리 완료</c:when>
		                                	</c:choose>
	                                	</span>
	                                </td>
	                                <td>${report.targetComuPostNo }</td>
	                                <td>
	                                	<c:choose>
	                                			<c:when test="${report.reportTargetTypeCode eq 'RTTC001'}">게시글</c:when>
				                       			<c:when test="${report.reportTargetTypeCode eq 'RTTC002'}">댓글</c:when>
				                       			<c:when test="${report.reportTargetTypeCode eq 'RTTC003'}">채팅</c:when>
	                                	</c:choose>
	                                </td>
	                                <td class="col-reported-writer">
	                                	<a href="/admin/community/report/detail?reportNo=${report.reportNo }">
	                                		${report.targetMemUsername} (${report.peoLastNm}${report.peoFirstNm})
	                                	</a>
	                                </td>
	                                <td class="col-reason">
	                                	<c:choose>
	                                			<c:when test="${report.reportReasonCode eq 'RRC001'}">스팸</c:when>
				                       			<c:when test="${report.reportReasonCode eq 'RRC002'}">욕설</c:when>
				                       			<c:when test="${report.reportReasonCode eq 'RRC003'}">음란물</c:when>
				                       			<c:when test="${report.reportReasonCode eq 'RRC004'}">기타</c:when>
	                                	</c:choose>
	                                </td>
	                                <td>${report.memUsername}</td>
	                                <td>
	                                	<c:set value="${fn:split(report.reportRegDate, ' ')}" var="reportRegDate"/> 
	                                	${reportRegDate[0]}
	                                </td>
	                                <td>${report.reportedCount}</td>
                            	</tr>
                       		</c:forEach>
                       		<c:if test="${empty reportList}">
					                <tr>
					                    <td colspan="9">신고 내역이 없습니다.</td>
					                </tr>
					            </c:if>
                        </tbody>
                    </table>
                    <div class="pagination-container" id="pagingArea">
                        ${pagingVO.pagingHTML}
                    </div>
                </section>
            </main>
        </div>
    </div>
<script>
$(function(){

	let pagingArea = $("#pagingArea");	//페이징 영역
	let searchForm = $("#searchForm");	//검색 Form 태그 Element			
	

   	 // 페이지네이션 로직

	 $(document).on('click', '.page-link', function(e) {
	        e.preventDefault(); // 기본 링크 동작(href="#") 방지

	        var page = $(this).data('page'); // data-page 속성 값 가져오기
	        
	        if (page) { // page 값이 유효한 경우에만 실행
	            $('#page').val(page); // hidden input #page의 값을 설정
	            $('#searchForm').submit(); // 검색 폼 제출
	        }
	    });
	 $('#resetSearchButton').on('click', function() {
	        // 검색 필드 값 초기화
	        $('#searchType').val('all');   // 신고 유형 '전체 유형'으로
	        $('#searchCode').val('all');   // 처리 상태 '전체 상태'로
	        $('#reportSearchInput').val(''); // 검색어 입력 필드 비움
	        $('#page').val(1);             // 페이지를 1페이지로 초기화

	        // 폼 제출
	        $('#searchForm').submit();
	    });
})       
</script>
</body>
<%@ include file="../../modules/footerPart.jsp" %>

<%@ include file="../../modules/sidebar.jsp" %>
</html> 