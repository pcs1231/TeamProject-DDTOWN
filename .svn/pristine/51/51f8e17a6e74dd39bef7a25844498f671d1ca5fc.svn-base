<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artist A - ì»¤ë®¤ë‹ˆí‹°</title>
<meta name="_csrf" content="${_csrf.token}"/>
<meta name="_csrf_header" content="${_csrf.headerName}"/>
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js'></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>
<%@ include file="../../modules/headerPart.jsp" %>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/communityModal.css">

<style>
.membership-blur {
    filter: blur(5px);
    pointer-events: none;
}

.membership-only {
    position: relative;
}

.membership-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.membership-badge {
    background: #8a2be2;
    color: #fff;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.8em;
    margin-left: 5px;
}

.imgDiv{
	position :relative;
	width: 100px;
	height : 100px;
}

.imgDiv img{
	width : 100%;
	height : 100%
}

.imgDiv i{
	position : absolute;
	top : 5%;
	right: 5%; /* ì•„ì´ì½˜ì„ ì´ë¯¸ì§€ì˜ ê°€ë¡œ ì¤‘ì•™ì— ìœ„ì¹˜ */
    transform: translate(-10%, -10%); /* ì•„ì´ì½˜ì„ ì¤‘ì•™ì— ì •í™•íˆ ìœ„ì¹˜ */
    font-size: 1rem; /* ì•„ì´ì½˜ í¬ê¸° ì¡°ì ˆ */
    color: white; /* ì•„ì´ì½˜ ìƒ‰ìƒ ì„¤ì • */
}

.replyWriterInfo {
    display: flex;
    align-items: center;
    gap: 10px;
}

</style>
</head>
<body>

	<sec:authentication property="principal" var="user"/>
	<input type="hidden" id="communityArtistGroupNo" value="${artistGroupVO.artGroupNo }">
	    <c:out value="${user}"/>
	    
    <c:choose>
		<c:when test="${communityVO.artistTabYn }">
			<c:set value="${artistPostVO }" var="communityPostVO" />
		</c:when>
		<c:otherwise>
			<c:set value="${fanPostVO }" var="communityPostVO" />
		</c:otherwise>
	</c:choose>

    <div class="apt-main-layout">
        <div class="apt-container">
            <header class="apt-header">
                <div class="apt-header-avatar">
                    <div class="artist-avatar-placeholder">A</div><!-- ì•„í‹°ìŠ¤íŠ¸ ê·¸ë£¹ ì´ë¯¸ì§€ ë„£ì„ ì˜ˆì •-->
                </div>
                <div class="apt-header-info">
                    <h2><c:out value="${artistGroupVO.artGroupNm }" /> <span style="font-size:0.7em; color: #888;">(ì•„í‹°ìŠ¤íŠ¸)</span></h2>
                    <div class="artist-stats">
                        <span><c:out value="${artistGroupVO.communityVO.totalArtist }"/>ëª…</span> &bull; <span><fmt:formatNumber value="${artistGroupVO.communityVO.totalFan }" pattern="#,###"/></span> íŒ¬
                    </div>
                </div>
                <div class="apt-header-actions">
	               	<c:if test="${followFlag eq 'N'}">
		                <button class="btn-apt-action" id="followToggleBtn">
		                    íŒ”ë¡œìš°
		                </button>
	              	</c:if>
	               	<c:if test="${followFlag eq 'Y'}">
		                <button class="btn-apt-action following" id="followToggleBtn">
		                    <span class="follow-icon">âœ”</span> íŒ”ë¡œì‰
		                </button>
	               	</c:if>
	                <button class="btn-apt-action">ğŸ”” ì•Œë¦¼ ì„¤ì •</button>
	            </div>
            </header>

            <ul class="nav apt-tabs" id="comuTab" role="tabList">
            	<li class="nav-item" role="presentation">
			        <button class="tab-item<c:if test="${communityVO.boardTypeCode eq 'ARTIST_BOARD' }"> active</c:if>" id="artistPost" data-bs-target="#artistPostList" type="button" role="tab" aria-controls="artistPostList" >ì•„í‹°ìŠ¤íŠ¸</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item<c:if test="${communityVO.boardTypeCode eq 'FAN_BOARD' }"> active</c:if>" id="fanPost" data-bs-target="#fanPostList" type="button" role="tab" aria-controls="fanPostList">íŒ¬</button>
			    </li>
			    <li class="nav-item" role="presentation" >
			        <button class="tab-item" id="live" data-bs-target="#liveList" type="button" role="tab" aria-controls="liveList" aria-selected="false">ë¼ì´ë¸Œ</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="schedule" data-bs-target="#scheduleList" type="button" role="tab" aria-controls="scheduleList" aria-selected="false">ìŠ¤ì¼€ì¤„</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="noticeApt" data-bs-target="#noticeAptList" type="button" role="tab" aria-controls="noticeAptList" aria-selected="false">ê³µì§€ì‚¬í•­</button>
			    </li>
            </ul>

            <main class="apt-content-area">
				
                <div class="tab-pane<c:if test="${communityVO.boardTypeCode eq 'ARTIST_BOARD' || communityVO.boardTypeCode eq 'FAN_BOARD'}"> show active</c:if>" id="artistPostList" role="tabpanel" aria-labelledby="artistPost">
                    <div id="artistFeedList">
                    	<c:if test="${empty communityPostVO}">
                    		<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    	</c:if>
                    	<div id="artistFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">
			            	<form action="/community/gate/${artistGroupVO.artGroupNo }/apt" id="artistSearchForm" method="get">
				            	<input type="hidden" id="comuArtGroupNo" value="${artistGroupVO.artGroupNo }" />
				            	<input type="hidden" id="artistTabYn" name="artistTabYn" value="${communityVO.artistTabYn }" />
				            	<input type="hidden" name="searchType" id="searchType" />
		                        <input type="text" name="searchWord" id="artistFeedSearchInput" value="${communityVO.searchWord }" placeholder="ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œê¸€ ê²€ìƒ‰ (ì œëª©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
		                        <input type="button" id="searchFormBtn" class="btn btn-primary" value="ê²€ìƒ‰" />
		                        <sec:authorize access="hasAnyRole('MEMBER','MEMBERSHIP','EMPLOYEE','ADMIN')">
		                        	<input type="radio" class="btn-check" name="artistNm" id="all" value="" />
		                        	<label class="btn btn-outline-primary" for="all">ì „ì²´</label>
		                        	<c:if test="${communityVO.artistTabYn }">
				                        <c:forEach items="${artistGroupVO.artistList }" var="artist">
				                        	<input type="radio" class="btn-check" name="artistNm" id="${artist.artNm }" value="${artist.memUsername }" <c:if test="${not empty communityVO.searchType and communityVO.searchType eq artist.memUsername}">checked</c:if>/>
				                        	<label class="btn btn-outline-primary" for="${artist.artNm }">${artist.artNm }</label>
				                        </c:forEach>
		                        	</c:if>
		                        </sec:authorize>
			            	</form>
	                    </div>
	
	                    <!-- ë“±ë¡ ëª¨ë‹¬ ì˜¤í”ˆ -->
	                    <div class="post-composer" id="openModal">
					        <button type="button" data-bs-toggle="modal" data-bs-target="#insertPostModal">
						        <div class="profile-placeholder"></div>
						        <span class="placeholder-text">í¬ìŠ¤íŠ¸ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</span>
							</button>
					    </div>
	
					    <input type="button" id="test" value="test">

				    <!-- ë“±ë¡ ëª¨ë‹¬ ì˜¤í”ˆ ë -->
                    	<c:forEach items="${communityPostVO }" var="post" varStatus="v">
                    				<div class="feed-item feedBox" data-post-id="${post.comuPostNo }" style="cursor:pointer;">
                    				<div class="feed-item-header">
                    					<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="${post.writerProfile.comuProfileImg }"></div>
                    					<div class="author-info">
                    						<span class="author-name" style="color:'#8a2be2';">${post.writerProfile.comuNicknm}</span>
                    						<span class="post-time">
	                    						<c:choose>
	                    							<c:when test="${post.comuPostRegDate ne post.comuPostModDate }">
			                    						<fmt:formatDate value="${post.comuPostModDate }" pattern="MM.dd. HH:mm"/>(ìˆ˜ì •ë¨)
	                    							</c:when>
	                    							<c:otherwise>
	                    								<fmt:formatDate value="${post.comuPostRegDate }" pattern="MM.dd. HH:mm"/>
	                    							</c:otherwise>
	                    						</c:choose>
                    						</span>
                    						<c:if test="${post.memberShipYn }">
                    							<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>
                    						</c:if>
                    					</div>
                    					<div class="post-options">
                    						<button class="post-options-btn" style="background:none;border:none;font-size:1.2em;cursor:pointer;">â€¢â€¢â€¢</button>
			                                <div class="post-options-menu" style="position:absolute;right:0;top:30px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);z-index:10;min-width:90px;">
				                                <sec:authorize access="hasAnyRole('ARTIST','MEMBER')">
				                                	<c:choose>
				                                		<c:when test="${user.username eq post.writerProfile.memUsername }">
				                                			<div class="post-option-item" id="edit" data-postNum="${post.comuPostNo }">ìˆ˜ì •</div>
					           								<div class="post-option-item" id="delete" data-action="delete" data-postNum="${post.comuPostNo }">ì‚­ì œ</div>
				                                		</c:when>
				                                		<c:otherwise>
				                                			<button class="btn btn-primary" id="reportPost"
						                                			data-bs-toggle="modal"
						                                			data-bs-target="#reportModal"
						                                			data-bs-whatever="${post.comuPostNo }"
						                                			data-bs-boardType="${post.boardTypeCode }"
						                                			data-bs-comuProfileNo="${post.comuProfileNo }"
						                                			data-bs-comuNick="${post.writerProfile.comuNicknm }"
						                                			data-bs-comuContent="${post.comuPostContent }"
						                                			data-bs-selectType="RTTC001">ì‹ ê³ </button>
				                                		</c:otherwise>
				                                	</c:choose>
				                                </sec:authorize>
			                                </div>
                    					</div>
                    				</div>
                    				<div class="feed-item-content<c:if test="${post.memberShipYn }">membership-blur</c:if>" style="<c:if test="${post.memberShipYn }">'position:relative;'</c:if>">
                    					<form id="postForm${v.index }" data-postNum=${v.index }>
	                    					<div class="openPostModal" id="openPostModal" data-postNum=${post.comuPostNo }>
		                   						<c:if test="${not empty post.postFiles }">
			                    					<div class="post-img">
		                    							<c:forEach items="${post.postFiles }" var="file">
		                    								<img src="${file.webPath }">
		                    							</c:forEach>
			                    					</div>
		                   						</c:if>
		                    					<div class="post-text" id="artistPostViewer">${post.comuPostContent}</div>
	                    					</div>
                    					</form>
                    				</div>
                    				<div class="feed-item-actions">
			                            <button class="action-btn comment-toggle-btn">ğŸ’¬ ëŒ“ê¸€ <span class="count"><c:out value="${post.comuPostReplyCount }" /></span></button>
			                            <button class="action-btn comment-toggle-btn">
			                            	<i class="
				                            	<c:if test="${post.likeYn eq 'N' }">bi bi-suit-heart</c:if>
				                            	<c:if test="${post.likeYn eq 'Y' }">bi bi-suit-heart-fill</c:if>
			                            	">${post.comuPostLike }</i>
			                            </button>
			                        </div>
			                        <div class="comments-wrapper" style="display:block;">
			                        	<div class="comment-form-container">
			                        		<textarea class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                    						<button class="btn-submit-comment" disabled>ë“±ë¡</button>
			                        	</div>
			                        	<div class="comment-list">
			                        		<c:forEach items="${post.comuPostReplyList }" var="reply">
				                        		<div class="comment-content">
				                        			<span class="comment-author-name"><c:out value="${reply.replyMember.comuNicknm }"/></span>
	                                				<p class="comment-text"><c:out value="${reply.comuReplyContent }"/></p>
				                        		</div>
			                        		</c:forEach>
			                        	</div>
			                        </div>
                    			</div>
                    	</c:forEach>
                    </div>
                </div>
                <div class="tab-pane" id="fanPostList" role="tabpanel" aria-labelledby="fanPost">ddd</div>

				<sec:authentication property="principal.username" var="currentUserId"/>
				<c:out value="í˜„ì¬ ë¡œê·¸ì¸í•œ ì•„ì´ë”” : ${currentUserId }"></c:out> 
				
				<div class="tab-pane" id="liveList" role="tabpanel" aria-labelledby="live">
					ë¼ì´ë¸Œ íƒ­ ì˜ì—­
					
					<button onclick="startLive()" id="stream-info" data-user-id="${currentUserId}" data-room-id="stream-room-${artistGroupVO.artGroupNo }">Live ë°©ì†¡í•˜ê¸°</button>
					<button onclick="watchLive()" id="watch-info" data-user-id="${currentUserId}" data-room-id="stream-room-${artistGroupVO.artGroupNo }">Live ì‹œì²­í•˜ê¸°</button>
				    
				    
				</div>
			
			    <div class="tab-pane" id="scheduleList" role="tabpanel" aria-labelledby="schedule">
			        <p class="loading-placeholder" style="text-align: center; display: none;">
			        	<div id="calendar"></div>
					</p>
			    </div>
			
			    <div class="tab-pane" id="noticeAptList" role="tabpanel" aria-labelledby="noticeApt">
			        <p class="loading-placeholder" style="text-align: center; display: none;">ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
			    </div>

            </main>
        </div>




<!-- /////////////////////////////////////////////////////////////////////////////////////////////////////// -->






        <aside class="apt-sidebar">
            <div class="sidebar-widget apt-level-widget">
                <h3>APT í˜„í™©</h3>
                <div class="apt-floor-display" id="aptFloorDisplay">123ì¸µ APT</div>
                <div class="fan-count-tooltip-wrapper"> <p class="fan-count-display">íŒ¬ <span id="sidebarFanCountApprox">ì•½ 12.3ë§Œ</span> ëª…</p> <span class="fan-count-tooltip" id="sidebarFanCountExact">123,456ëª…</span> </div>
            </div>

            <div class="sidebar-widget membership-widget">
                <div class="membership-icon">ğŸ›¡ï¸</div>
                <h3>Membership</h3>
                <p>ì§€ê¸ˆ ë©¤ë²„ì‹­ì— ê°€ì…í•˜ê³  Artist Aì˜ íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”.</p>
                <button class="btn-join-membership" id="openMembershipModalBtn">
                    ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° <span class="arrow">&gt;</span>
                </button>
            </div>

			<c:if test="${not empty userProfile}">
	             <!-- ë§ˆì´ í”„ë¡œí•„ ì˜ì—­ ì¶”ê°€ -->
	             <div id="myProfile" class="sidebar-widget my-profile-widget" style="margin-bottom: 20px; text-align: center; cursor: pointer;" data-comu-profile-no="${userProfile.comuProfileNo}">
	                <div style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; overflow: hidden; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
	                	<img alt="í”„ë¡œí•„ img" src="${userProfile.comuProfileImg}">
	                </div>
	                <p id="myProfileNickname" style="margin-top: 8px; font-weight: bold; font-size: 1.1em;">${userProfile.comuNicknm}</p>
	                <small>ë‚´ê°€ ì“´ ê¸€ : ${fn:length(userProfile.postList)}ê°œ</small> | <small>ë‚´ê°€ ì“´ ëŒ“ê¸€ : ${fn:length(userProfile.replyList)}ê°œ</small>
	            </div>
			</c:if>

        </aside>
    </div>

    <div id="footer-placeholder"></div>

     <div class="modal-overlay" id="membershipModalOverlay" style="display: none;">
        <div class="modal-content membership-modal">
            <button class="modal-close-btn" id="closeMembershipModalBtn" title="ë‹«ê¸°">&times;</button>
            <div class="modal-header">
                <h2>Artist A OFFICIAL MEMBERSHIP</h2>
                <p class="membership-duration">ì´ìš© ê¸°ê°„: ê²°ì œì¼ë¡œë¶€í„° 30ì¼</p>
            </div>
            <div class="modal-body">
                <div class="membership-main-image">
                </div>
                <h3>ì£¼ìš” í˜œíƒ ì•ˆë‚´</h3>
                <ul class="modal-benefits-list">
                    <li>âœ”ï¸ ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥ (ì¼ë¶€ ë¸”ëŸ¬ ì²˜ë¦¬ëœ ì½˜í…ì¸  ì¦‰ì‹œ í•´ì œ!)</li>
                    <li>ğŸ—“ï¸ APT ë©”ì¸ ìƒë‹¨ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ êµ¬ë…ì¼ D-Day í™•ì¸</li>
                    <li>ğŸ¤ ì½˜ì„œíŠ¸/íŒ¬ë¯¸íŒ… ì„ ì˜ˆë§¤ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ ì°¸ì—¬ ê¸°íšŒ</li>
                    <li>ğŸ í•œì •íŒ ë©¤ë²„ì‹­ í‚¤íŠ¸ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë˜ëŠ” ë“±ê¸‰ì— ë”°ë¼)</li>
                </ul>

                <h3>ì´ìš© ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</h3>
                <ul class="modal-notes-list">
                    <li>ë³¸ ë©¤ë²„ì‹­ì€ ë¹„ìš©ì„ ì„ ì§€ë¶ˆí•˜ì—¬ ì´ìš©í•˜ëŠ” ìœ ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</li>
                    <li>ë©¤ë²„ì‹­ì€ ì•„í‹°ìŠ¤íŠ¸(ì†”ë¡œ, ê·¸ë£¹)ë³„ë¡œ ë³„ë„ ìš´ì˜ë˜ë©°, ë³¸ ë©¤ë²„ì‹­ì€ [Artist A] ì „ìš©ì…ë‹ˆë‹¤.</li>
                    <li>ê·¸ë£¹ ë‚´ ì†”ë¡œ í™œë™ ë©¤ë²„ ë°œìƒ ì‹œ, í•´ë‹¹ ë©¤ë²„ì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³„ë„ ìƒì„±/ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ìì„¸í•œ ë‚´ìš©ì€ êµ¬ë§¤ í˜ì´ì§€ì˜ ì•½ê´€ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <div class="membership-price">â‚©30,000 <span class="vat-notice">(VAT í¬í•¨)</span></div>
                <button class="btn-modal-purchase" id="goToPurchasePageBtn">ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>

	<c:if test="${followFlag eq 'N'}">
	     <!-- ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë²„ë ˆì´ -->
	    <div id="communityOverlay" class="d-flex p-2 align-items-center fixed-bottom"
	    	style="height:50px; bottom: 0px; width:100%; background-color: rgba(0,0,0,0.7); border-radius: 5px;">
	        <div class="community-overlay-bg"></div>
	        <span style="color: #fff;">ì»¤ë®¤ë‹ˆí‹° íŒ”ë¡œìš°ë¥¼ í•´ì„œ ëª¨ë“  ì»¨í…ì¸ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”</span>
	        <button class="community-join-btn" id="followBtn" style="margin-left: auto; color:#fff">íŒ”ë¡œìš°í•˜ê¸°</button>
	    </div>

	    <!-- ë‹‰ë„¤ì„ ì…ë ¥ ëª¨ë‹¬ -->
	    <div class="modal fade" id="commProfileModal" tabindex="-1" aria-labelledby="nicknameModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="commProfileModalLabel">ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                	<div class="mb-3 d-flex justify-content-center align-items-center">
	                        <div class="profile-img-box" id="previewImgBox" style="width:100px; height:100px; border-radius: 50%; cursor:pointer; overflow: hidden;">
	                            <img alt="í”„ë¡œí•„ì´ë¯¸ì§€" src="${pageContext.request.contextPath}/upload/profile/base/defaultImg.png" id="previewImg" width="100px" height="100px">
	                        </div>
	                	</div>
	                    <div class="mb-3">
	                        <label for="comuNicknm" class="form-label">ë‹‰ë„¤ì„</label>
	                        <input type="text" class="form-control" id="comuNicknm" name="comuNicknm" maxlength="12" placeholder="12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”">
	                    </div>

	                    <div class="mb-3">
	                        <label for="imgFile" class="form-label">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
	                        <input class="form-control" type="file" id="imgFile" name="imgFile" accept="image/*">
	                    </div>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	                    <button type="button" class="btn btn-primary" id="profileSubmitBtn">ì™„ë£Œ</button>
	                </div>
	            </div>
	        </div>
	    </div>
	</c:if>

    <!-- DM ëª¨ë‹¬ì´ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="weverse-dm-modal-container"></div>

    <!-- DM ì—´ê¸° ë²„íŠ¼ (ì›í•˜ëŠ” ê³³ì— ë°°ì¹˜) -->
    <button onclick="openWeverseDM()">DM ì—´ê¸°</button>

<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade " id="insertPostModal" tabindex="-1"
	aria-labelledby="insertPostModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="insertPostModalLabel">
					<c:out value="${artistGroupVO.artGroupNm }" />
				</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="postForm" action="/community/insert/post"
					enctype="multipart/form-data" method="post">
					<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />

					<div id="imgArea"></div>

					<div>ë‚´ìš©</div>
					<textarea rows="5" cols="10" id="comuPostContent"
						onkeyup="contentLengthCheck(this)" name="comuPostContent"></textarea>

					<div class="text-right pt-2">
						<span class="pt-1"><span class="cmt-sub-size">0</span>/1000</span>
					</div>
				
					<c:if test="${communityVO.artistTabYn }">
						<label for="memberShipYn"> <input type="checkbox"
							id="postMemberShipYn" name="postMemberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼" />
							<input type="hidden" id="memberShipYn" name="memberShipYn"
							value="" /> ë©¤ë²„ì‹­ì „ìš©
						</label>
					</c:if>
					 <input type="file" name="files" id="insertPostFile" multiple
						accept="image/*">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="postSendBtn">ì €ì¥</button>
				<button type="button" class="btn btn-secondary"
					data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ë“±ë¡ ëª¨ë‹¬ ë -->

<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade " id="editPostModal" tabindex="-1" aria-labelledby="editPostModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="editPostModalLabel">
					<c:out value="í¬ìŠ¤íŠ¸ ìˆ˜ì •" />
				</h1>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="editPostForm" enctype="multipart/form-data" method="post">
				<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
					<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
					<input type="hidden" name="comuPostNo" id="postNum" />
					<input type="hidden" id="fileGroupNo" name="fileGroupNo" />
					<input type="hidden" id="deleteFiles" name="deleteFiles" />

					<div id="editImgArea" class="editImg"></div>
					<div id="plusImg" class="editImg"></div>

					<div>ë‚´ìš©</div>
					<textarea rows="5" cols="10" id="editComuPostContent"
						 name="comuPostContent" onkeyup="contentLengthCheck(this)"></textarea>
					<div class="text-right pt-2">
						<span class="pt-1"><span class="cmt-sub-size">0</span>/1000</span>
					</div>
	
					<c:if test="${communityVO.artistTabYn }">
						<label for="editPostMemberShipYn" id="checkBoxMbs">
							<input type="checkbox" id="editPostMemberShipYn" name="postMemberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼" />
							<input type="hidden" id="editMemberShipYn" name="memberShipYn"
							value="" /> ë©¤ë²„ì‹­ì „ìš©
						</label>
					</c:if>
					<input type="file" name="files" id="editInsertPostFile" multiple accept="image/*">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="postUpdateBtn">ìˆ˜ì •</button>
				<button type="button" class="btn btn-secondary"
					data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ìˆ˜ì • ëª¨ë‹¬ ë -->

<!-- ì‹ ê³ ëª¨ë‹¬ -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="reportModalLabel">ì‹ ê³ ì‚¬ìœ  ì„ íƒ</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="reportForm" method="post">
        	<input type="hidden" name="targetComuPostNo" id="targetComuPostNo">
        	<input type="hidden" name="targetBoardTypeCode" id="targetBoardTypeCode">
        	<input type="hidden" name="targetComuReplyNo" id="targetComuReplyNo" value="">
        	<input type="hidden" name="artGroupNo" id="reportArtGroupNo">
        	<input type="hidden" name="targetComuProfileNo" id="targetComuProfileNo">
        	<input type="hidden" name="reportTargetTypeCode" id="reportTargetTypeCode">
          <div class="mb-3">
          	<div class="radioArea">
          	</div>
          </div>
          <div class="mb-3">
            <label for="targetNick" class="col-form-label">ì‹ ê³  ì²˜ë¦¬ ëŒ€ìƒ:</label>
            <input type="text" class="form-control" id="targetNick" disabled="disabled" />
          </div>
          <div class="mb-3">
            <label for="targetContent" class="col-form-label">ì²˜ë¦¬ ë‚´ìš©:</label>
            <textarea class="form-control" id="targetContent" disabled="disabled"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="reportSendBtn">ì‹ ê³ í•˜ê¸°</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>
</div>
<!-- í¬ìŠ¤íŠ¸ ìƒì„¸ ëª¨ë‹¬ ver2 -->
<div class="modal fade" id="detailPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-custom">
         <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>

        <div class="modal-content">
            <div class="modal-body p-0">
                <div class="d-flex h-100">

                    <div class="post-pane" id="postBox">
                    </div>

                    <div class="comment-pane">
					    <div class="comment-pane-header">
					        <strong class="mx-auto" id="replyCount"></strong>
					    </div>

					    <div class="comment-pane-body" id="replyList">

					    </div>

					    <div class="comment-pane-footer">
					    	<form action="/community/reply/insert" method="get" id="replyForm">
								<input type="hidden" id="boardTypeCode" name="boardTypeCode" />
								<input type="hidden" id="comuPostNo" name="comuPostNo" />
								<input type="hidden" id="artGroupNo" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
							    <div class="input-group">
						        	<textarea id="comuReplyContent" onkeyup="replyContentLengthCheck(this)" name="comuReplyContent" class="form-control" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." aria-label="ëŒ“ê¸€ ì…ë ¥" rows="1" style="resize: none;"></textarea>
						        	<button class="btn btn-primary" type="button" id="replyBtn">ë“±ë¡</button>
							    </div>
							</form>
						</div>
						<div class="text-right pt-2">
							<span class="pt-1"><span class="cmt-sub-size">0</span>/300</span>
						</div>
					</div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- ìŠ¤ì¼€ì¤„ ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="scheduleModalLabel">ì¼ì •ìƒì„¸</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeBtn"></button> 
			</div>
			<div class="modal-body">
	        	<div class="mb-3">
	        		 <label for="title" class="form-label">ì¼ì •ëª…</label>
	        		 <input type="text" class="form-control-plaintext" id="title" name="title" disabled="disabled">
	        	</div>
	        	<div class="mb-3">
					<label for="content" class="col-form-label">ë‚´ìš©</label>
					<textarea class="form-control" id="content" disabled="disabled"></textarea>
				</div>
				<div class="mb-3">
					<label for="place" class="col-form-label">ì¥ì†Œ</label>
					<input type="text" name="place" id="place" class="form-control" disabled="disabled"/>
				</div>
				<div class="mb-3">
					<label for="dateUrl" class="col-form-label">ê²½ë¡œ</label><br/>
					<a href="" id="datelink"></a>
				</div>
				<div class="mb-3">
					<label for="allDayCheck" class="col-form-label">í•˜ë£¨ì¼ì •ì—¬ë¶€</label>
					<input type="checkbox"  id="allDayStatus" name="allDayStatus" disabled="disabled"> 
				</div>
				<div class="mb-3">
					<label for="date" class="col-form-label">ì¼ì •</label>
					<div class="notAllDaySchedule" style="display:none">
						<input type="text" name="datetimes" id="startDate" class="form-control" disabled="disabled"/> ~ 
						<input type="text" name="datetimes" id="endDate" class="form-control" disabled="disabled"/> 
					</div>
					<div class="allDaySchedule" style="display:none">
						<input type="text" name="datetimes" id="allDate" class="form-control" disabled="disabled"/>
					</div>
				</div>
	        </div>
	        <div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelBtn">ë‹«ê¸°</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
const streamInfo = document.getElementById('stream-info');
const currentUserId = streamInfo.dataset.userId; 
const roomId = streamInfo.dataset.roomId;

//8080 ì‹œê·¸ë„ë§ ì„œë²„ì™€ WebSocketìœ¼ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.
const socket = new WebSocket('ws://192.168.35.124:8080/signal');

/**
 * 'Live ë°©ì†¡í•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ, 8080ì„œë²„ì˜ ë°©ì†¡ ê°œì„¤ í˜ì´ì§€ë¥¼ ìƒˆ ì°½ìœ¼ë¡œ ì—½ë‹ˆë‹¤.
 */
function startLive(){
    const streamInfo = document.getElementById('stream-info');
	const currentUserId = streamInfo.dataset.userId; 
    
    if (!currentUserId) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return;
    }
    
    // 8080 ì„œë²„ì˜ ë°©ì†¡ ê°œì„¤ í˜ì´ì§€ ì£¼ì†Œ (/broadcast/new)
    // URL íŒŒë¼ë¯¸í„°ë¡œ ë¡œê·¸ì¸í•œ ìœ ì €ì˜ ì•„ì´ë””ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì„ íƒì‚¬í•­)
    const broadcastURL = `http://192.168.35.124:8080/broadcast/new?userId=${currentUserId}`;
    
    // ìƒˆ ì°½(íŒì—…)ìœ¼ë¡œ ë°©ì†¡ í˜ì´ì§€ë¥¼ ì—½ë‹ˆë‹¤.
    window.open(broadcastURL, 'broadcastWindow', 'width=1280,height=720');
}

/**
 * 'Live ì‹œì²­í•˜ê¸°' ë²„íŠ¼ì€ ì´ì œ 8080ì„œë²„ì˜ ë©”ì¸ í˜ì´ì§€(ë°©ì†¡ ëª©ë¡)ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.
 * ì‚¬ìš©ìê°€ ëª©ë¡ì—ì„œ ì§ì ‘ ë°©ì†¡ì„ ì„ íƒí•´ì„œ ë“¤ì–´ê°€ë„ë¡ í•©ë‹ˆë‹¤.
 */
function watchLive(){
    // 8080 ì„œë²„ì˜ ë©”ì¸ í˜ì´ì§€ ì£¼ì†Œ (index.html)
    const watchURL = `http://192.168.35.124:8080/`;
    window.open(watchURL, 'watchWindow', 'width=1280,height=720');
}

$(function(){
	
	console.log("codeMap : ", ${codeMap})
	
	let fileMap = new Map();	// ì—…ë¡œë“œí•œ íŒŒì¼ ë‹´ì„ ê°ì²´
	let fileNum = 0;		// ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ìˆœë²ˆ

	let upFile = new Map();	// ìˆ˜ì • ì¤‘ ì—…ë¡œë“œí•œ íŒŒì¼ ë‹´ì„ ê°ì²´
	let upFileNum = 0;		// ìˆ˜ì • ì¤‘ ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ìˆœë²ˆ

	let deleteFileList = [];	// ì‚­ì œí•  íŒŒì¼ì˜ ìƒì„¸ë²ˆí˜¸
	let deleteFileGroupNo = new Map();	// ì‚­ì œí•  íŒŒì¼ì˜ ê·¸ë£¹ë²ˆí˜¸

	let likeFlag = false;	// ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì—¬ë¶€
	let oldLikeCount;
	let newLikeCount;
	
	let active = $("#artistTabYn").val();
	if(active){
		$("#artistPost").attr("class","tab-item active");
	}else{
		$("#fanPost").attr("class","tab-item active");
	}

	// ì´ë¯¸ì§€ ì˜ì—­ ê°€ì ¸ì˜¤ê¸°
	let area = $("#imgArea");

	$("#insertPostFile").on("change",function(e){
		let files = e.target.files;

		let html = ``;
		for(let i=0; i<files.length; i++){
			let file = files[i];

			fileMap.set(fileNum.toString(),file);

			let reader = new FileReader();
    		reader.onload = function(e){
    			html += `
					<div class="imgDiv">
						<img src="\${e.target.result}"  data-fileNum='\${fileNum}' >
								<i class="bi bi-x-lg"></i>
						</img>

					</div>
					`;
        		fileNum++;
			$("#imgArea").html(html);
    		}
    		reader.readAsDataURL(file);
    		
		}

	});

	// ì´ë¯¸ì§€ ì‚­ì œ ì‹œ files mapì— ì‚­ì œ
	area.on("click","i",function(){
		let pr = $(this).parent("div").remove();
		let cur = $(this).parent("div").children('img')[0].dataset.filenum;

		files.delete(cur);

	});

	$("#postSendBtn").on("click",function(){
		let checkeded = $("#postMemberShipYn").is(':checked');
		$("#memberShipYn").val(checkeded);
		let postForm = document.getElementById("postForm");

		let artGroupNo = $("#comuArtGroupNo").val();

		let data = new FormData(postForm);

		$.ajax({
			url : "/community/insert/post",
			type : "post",
			data : data,
			processData : false,
			contentType : false,
			success : function(res){
				if(res == 'OK'){
					alert("ê¸€ ë“±ë¡ ì„±ê³µ!");
				}else{
					alert("ê¸€ ë“±ë¡ ì‹¤íŒ¨")
				}
				location.href = "/community/gate/" + artGroupNo + "/apt";
			},
			error : function(error){
				console.log(error.status);
			},
			beforeSend : function(xhr) {
		        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
		    }
		});
	});

	let artistBtnList = document.querySelectorAll('#artistSearchForm input[name=artistNm]');
	artistBtnList.forEach(artist => {
		artist.addEventListener("click",function(){
			let selectArtist = $(this).val();
			$("#searchType").val(selectArtist);

			$("#artistSearchForm").submit();
		})
	})
	
	$('.apt-tabs .tab-item').on('click', function() {
        // ëª¨ë“  íƒ­ ë²„íŠ¼ì—ì„œ 'active' í´ë˜ìŠ¤ ì œê±°
        $('.apt-tabs .tab-item').removeClass('active');
        // í´ë¦­ëœ íƒ­ ë²„íŠ¼ì— 'active' í´ë˜ìŠ¤ ì¶”ê°€
        $(this).addClass('active');
        
        const targetId = $(this).attr('data-bs-target');
        console.log(targetId)
        $('.apt-content-area .tab-pane').removeClass('show active');
        
        $(targetId).addClass('show active');
        
        const currentTabId = $(this).attr('id');
        
        if (currentTabId === 'artistPost') {
            // ì´ì „ì— ì œì•ˆí–ˆë˜ loadPosts(true) í˜¸ì¶œ
            $('#artistTabYn').val('true');
            $('#artistSearchForm').submit();
        } else if (currentTabId === 'fanPost') {
            // ì´ì „ì— ì œì•ˆí–ˆë˜ loadPosts(false) í˜¸ì¶œ
            $('#artistTabYn').val('false');
            $('#artistSearchForm').submit();
        } else {
        	const artGroupNo = $('#comuArtGroupNo').val();
        	const $targetPane = $(targetId);
        	console.log(currentTabId)
        	
        	 if ($targetPane.data('loaded') === true) {
                 console.log(`Content for ${targetId} already loaded.`);
                 return; // ì´ë¯¸ ë¡œë“œë˜ì—ˆìœ¼ë©´ ë‹¤ì‹œ ìš”ì²­í•˜ì§€ ì•ŠìŒ
            }
        	
        	let apiUrl = ``;
            if (currentTabId === 'schedule') {
                location.href = "/community/schedule/" + artGroupNo;
                console.log(${schedule});
                fullCalendar(${schedule});
            } else if (currentTabId === 'noticeApt') {
                apiUrl = `/community/notice/\${artGroupNo}`;
            }
            
            if(apiUrl){
            	$.ajax({
            		url : apiUrl,
            		type : "get",
            		success : function(html){
            			console.log(html)
            			$targetPane.html(html);
                        $targetPane.data('loaded', true);
            		},
            		error: function(xhr, status, error) {
                        console.error(`Error loading ${targetId}:`, status, error);
                        $targetPane.html('<p style="color: red;">ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>');
                    },
                    complete: function() {
                        $targetPane.find('.loading-placeholder').hide();
                    }
            	});
            }
        }
	});
	

	// ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#searchFormBtn").on("click",function(){
		console.log($("#artistSearchForm").find("input:checked").val());
		
		let selectArtist = $("#artistSearchForm").find("input:checked").val();
		
		$("#searchType").val(selectArtist);
		
		$("#artistSearchForm").submit();
	});
	

	// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ
	let editBtnList = document.querySelectorAll("#edit");		// ëª¨ë“  ìˆ˜ì • ë²„íŠ¼ì„ nodeListë¡œ ê°€ì ¸ì˜´
	editBtnList.forEach(div => {
		div.addEventListener("click",function(e){				// div íƒœê·¸ì— í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë„˜

			console.log("ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°ë¥¼ ìš”ì²­í•¨");
		
			let postNum = e.target.dataset.postnum;					// í´ë¦­í•œ divì— ì €ì¥ë˜ì–´ìˆëŠ” postNumì„ ê°€ì ¸ì™€ postFormìˆœë²ˆ ê³¼ editPostFormìˆœë²ˆì˜ ìŠ¤íƒ€ì¼ displayë¥¼ ë³€ê²½í•´ì¤Œìœ¼ë¡œ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ ë³€ê²½í•´ì¤Œ

			console.log("ìˆ˜ì • ë²„íŠ¼ì— ìˆëŠ” data ì†ì„±ì„ ê°€ì§€ê³  ì˜´ : postNum ", postNum);
			
			$("#postNum").val(postNum);
			
			updateModalInfo(postNum);

			

			$("#postUpdateBtn").on("click",function(){
				
				let tabCheck = $("#artistTabYn").val();
				if(tabCheck){
					let checkeded = $("#editPostMemberShipYn").is(':checked');
					$("#editMemberShipYn").val(checkeded);
				}
				
				let editPostForm = document.getElementById("editPostForm");

				let artGroupNo = $("#communityArtistGroupNo").val();

				if(deleteFileList != null && deleteFileList.length > 0){
					console.log(deleteFileList);
					$("#deleteFiles").val(deleteFileList);
				}

				let data = new FormData(editPostForm);

				$.ajax({
					url : "/community/update/post",
					type : "post",
					data : data,
					processData : false,
					contentType : false,
					success : function(res){
						if(res == "OK"){
							alert("ê¸€ ìˆ˜ì • ì™„ë£Œ!");
						}else{
							alert("ê¸€ ìˆ˜ì • ì‹¤íŒ¨!");
						}
						location.href = "/community/gate/" + artGroupNo + "/apt";
					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				})
			});

		});
	})

	let deleteBtnList = document.querySelectorAll("#delete");
	deleteBtnList.forEach(div => {
		div.addEventListener("click",function(e){
			if(!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
				return false;
			}
			console.log("ehla")
			let postNum = e.target.dataset.postnum;
			let artGroupNo = $("#comuArtGroupNo").val();
			let data = new FormData();
			data.append("artGroupNo",artGroupNo);
			data.append("comuPostNo",postNum)
			
			$.ajax({
				url : "/community/delete/post/" + postNum,
				type : "post",
				data : data,
				contentType : false,
				processData : false,
				success : function(res){
					if(res == "OK"){
						alert("ê²Œì‹œê¸€ì´ ì‚­ì œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.");
					}else{
						alert("ê²Œì‹œê¸€ì´ ì‚­ì œê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
					}
					location.href = "/community/gate/" + artGroupNo + "/apt";
				},
				error : function(error){
					console.log(error.status);
				},
				beforeSend : function(xhr) {
			        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
			    }
			})
		});
	});


	let openDetailBtnList = document.querySelectorAll(".openPostModal");
	openDetailBtnList.forEach(div => {
		div.addEventListener("click",function(e){
			e.preventDefault();
			let detailModal = document.getElementById("detailPostModal");
			let myDetailModal = new bootstrap.Modal(detailModal);

			let postNum = e.target.closest(".openPostModal").dataset.postnum;

			myDetailModal.show(postNum);

			console.log(e);
		})
	});

	$("#replyBtn").on("click", function(e){
		e.preventDefault();
		let content = $("#comuReplyContent");
		if(content.val().trim() == null || content.val().trim() == ""){
			alert("ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”");
			return false;
		}

		let detailModal = document.getElementById("detailPostModal");
		let myDetailModal = bootstrap.Modal.getInstance(detailModal);

		myDetailModal.hide();
		
		let replyForm = document.getElementById("replyForm");

		let data = new FormData(replyForm);

		$.ajax({
			url : "/community/reply/insert",
			type : "post",
			data : data,
			processData : false,
			contentType : false,
			success : function(res){
				console.log(res);
				if(res.result == "OK"){
					let detailModalReOpen = document.getElementById("detailPostModal");
					let detailModal = new bootstrap.Modal(detailModalReOpen);
					let postNum = res.replyVO.comuPostNo;
					
					let feedbox = $(".feed-item.feedBox[data-post-id='"+postNum+"']").find("span.count");
					
					feedbox.html(res.replyVO.replyCount);
					
					detailModal.show(postNum);
				}
			},
			error : function(error){
				console.log(error.status);
			},
			beforeSend : function(xhr) {
		        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
		    }
		});
	});

	// ìƒì„¸ ëª¨ë‹¬ì°½ ì—´ë ¸ì„ ì‹œ
	$("#detailPostModal").on("show.bs.modal",function(e){
		$("#comuReplyContent").val("");
		$("#replyList").html("");
		$("#detailImgArea").html("");

		let postNum = e.relatedTarget;
		
		openDetailModal(postNum);

	})

	// ë“±ë¡ ëª¨ë‹¬ ì—´ë ¸ì„ ì‹œ
	$("#insertPostModal").on("show.bs.modal",function(){
		$("#comuPostContent").val("");
		let tabCheck = $("#artistTabYn").val();
		if(tabCheck){
			$("#postMemberShipYn").prop("checked",false);
		}
		$("#insertPostFile").val("");
		$("#imgArea").html("");

		let content = document.getElementById("comuPostContent");
		contentLengthCheck(content);
	});

	// ìˆ˜ì • ëª¨ë‹¬ ë‹«ì•˜ì„ ì‹œ
	$("#editPostModal").on("hide.bs.modal",function(){
		$("#editImgArea").html("");
		let tabCheck = $("#artistTabYn").val();
		if(tabCheck){
			$("#editPostMemberShipYn").prop("checked",false);
		}
		$("#editInsertPostFile").val("");
	});

	$("#detailPostModal").on("shown.bs.modal",function(){
		// ëŒ“ê¸€ ìˆ˜ì • í´ë¦­ ì‹œ (ì‚­ì œë¨)
// 		let replyUpdateBtnList = document.querySelectorAll("#replyUpdateBtn");
// 		replyUpdateBtnList.forEach(btn => {
// 			btn.addEventListener("click",function(e){
// 				e.preventDefault();

// 				let contentArea = $(this).parents(".reply").children(".replyContent")[0]
// 				let content =contentArea.innerText;
// 				let postNo = $(this).parents(".replyArea").find("#comuPostNo").val();
// 				console.log(contentArea)

// 				let html = `
// 					<div class="img-push pt-3 cmt-sub-text">
// 						<textarea class="form-control form-control-sm cmtContent" rows="5" cols="20" id="cmtContent" onkeyup="contentLengthCheck(this)" placeholder="Press enter to post comment">\${content}</textarea>
// 						<div class="text-right pt-2">
// 							<span class="pt-1"><span class="cmt-sub-size">0</span>/650</span>
// 							<button type="button" class="btn btn-sm btn-primary cmtBtn" id="replyUpdateForm">ë“±ë¡</button>
// 							<button type="button" class="btn btn-sm btn-secondary cmtBtn" id="replyUpdateCancel">ì·¨ì†Œ</button>
// 						</div>
// 					</div>
// 				`;
// 				$(this).parents(".reply").children(".replyContent").append(html);

// 				$("#replyUpdateForm").on("click",function(){
// 					let detailModal = document.getElementById("detailPostModal");
// 					let myDetailModal = bootstrap.Modal.getInstance(detailModal);

// 					myDetailModal.hide();

// 					console.log($("#cmtContent").val());
// 					let content = $("#cmtContent").val();
// 					let replyNo = $(this).parents(".reply").children(".replyWriterInfo").find("#replyNo").val();

// 					let data = new FormData();
// 					data.append("comuReplyNo",replyNo);
// 					data.append("comuReplyContent",content);

// 					$.ajax({
// 						url : "/community/reply/update",
// 						type : "post",
// 						data : data,
// 						contentType : false,
// 						processData : false,
// 						success : function(res){
// 							console.log(res)
// 							if(res == 'OK'){
// 								alert("ëŒ“ê¸€ ìˆ˜ì • ì™„ë£Œ!");
// 								let detailModalReOpen = document.getElementById("detailPostModal");
// 								let detailModal = new bootstrap.Modal(detailModalReOpen);

// 								detailModal.show(postNo);
// 							}
// 						},
// 						error : function(error){
// 							console.log(error.status)
// 						},
// 						beforeSend : function(xhr) {
// 					        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
// 					    }
// 					});
// 				});

// 				$("#replyUpdateCancel").on("click",function(){
// 					$("#cmtContent").parent('div').remove();

// 				});
// 			});
// 		});

		// ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
		let replyDeleteBtnList = document.querySelectorAll("#replyDeleteBtn");
		replyDeleteBtnList.forEach(btn => {
			btn.addEventListener("click",function(e){
				e.preventDefault();
				if(!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
					return false;
				}

				let detailModal = document.getElementById("detailPostModal");
				let myDetailModal = bootstrap.Modal.getInstance(detailModal);

				myDetailModal.hide();

				let test = e.target.dataset.comuReplyNo;
				let postNo = e.target.dataset.postNo;
				let replyNo = e.target.dataset.comuReplyNo;
				
				let data = new FormData();
				data.append("replyNo", replyNo)
				$.ajax({
					url : "/community/reply/delete",
					type : "post",
					data : data,
					contentType : false,
					processData : false,
					success : function(res){
						console.log(res)
						if(res == 'OK'){
							alert("ëŒ“ê¸€ ì‚­ì œ ì™„ë£Œ!");

							let detailModalReOpen = document.getElementById("detailPostModal");
							let detailModal = new bootstrap.Modal(detailModalReOpen);

							detailModal.show(postNo);
						}
					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				});
			})
		});

		oldLikeCount = $(this).find("#likeCount").html();
		console.log("ì²˜ìŒ ì¢‹ì•„ìš” ìˆ˜ : ", oldLikeCount);
		
		$("#likeButton").on("click", function(){
			console.log("ëˆ„ë¦„");
			likeFlag = true;
			likeBtn($(this));
		});
		
	});


	$("#detailPostModal").on("hide.bs.modal",function(e){
		console.log("ë‹«ì•˜ì„ ë•Œ : ", e);
		console.log(e.currentTarget);
		console.log("í˜„ì¬ : ", $(this).find("#likeCount").html());

		newLikeCount = $(this).find("#likeCount").html();

		let comuPostNo = $(this).find("#comuPostNo").val();
		let boardTypeCode = $(this).find("#boardTypeCode").val();
		let artGroupNo = $("#communityArtistGroupNo").val();

		// ê¸°ì¡´ì˜ ì¢‹ì•„ìš” ìˆ˜ê°€ 40ì´ë¼ê³  ê°€ì •
		// ì•¡ì…˜ 1. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ ì•Šê³  ì°½ì„ ë‹«ì„ ë•Œ ì¢‹ì•„ìš” ìˆ˜ ë³€í™”ê°€ ì—†ìŒ
		// ì•¡ì…˜ 2. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì°½ì„ ë‹«ì„ ë•Œ ì¢‹ì•„ìš” ìˆ˜ëŠ” +1ì¸ ìƒíƒœ ê·¸ë˜ì„œ ì°½ì„ ë‹«ì„ ë•Œ 41ì´ ë˜ì–´ ìˆìŒ. ì´ì „ì— ìˆë˜ ì¢‹ì•„ìš” ìˆ˜ë³´ë‹¤ ìƒˆë¡œìš´ ì¢‹ì•„ìš” ìˆ˜ê°€ ë” ë†’ê¸°ì— pMì— 1ì´ ë“¤ì–´ê°€ ìˆìŒ
		// ì•¡ì…˜ 3. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ì·¨ì†Œí•˜ê³  ì°½ì„ ë‹«ì„ ë–„ ì¢‹ì•„ìš” ìˆ˜ëŠ” -1ì¸ìƒíƒœ ê·¸ë˜ì„œ ì°½ì„ ë‹«ì„ ë•Œ 39ê°€ ë˜ì–´ ìˆìŒ. ì´ì „ì— ìˆë˜ ì¢‹ì•„ìš” ìˆ˜ê°€ ë” ë†’ê¸°ì— pMì— -1ì´ ë“¤ì–´ê°€ ìˆìŒ
		let pM = 0;
		if(oldLikeCount == newLikeCount){
			pM = 0;
		}else if(oldLikeCount > newLikeCount){
			pM = -1;
		}else if(oldLikeCount < newLikeCount){
			pM = +1;
		}
		console.log("ê³„ì‚° : ", pM)

		if(likeFlag){	// ì¢‹ì•„ìš”ê°€ ë³€ê²½ì´ ë˜ì—ˆë‹¤ë©´
			let data = new FormData();
			data.append("comuPostNo",comuPostNo);
			data.append("boardTypeCode",boardTypeCode);
			data.append("artGroupNo",artGroupNo);
			data.append("insertDelete", pM);

			likeUpdate(data);
		}
		
	});
	
	// ìˆ˜ì • ëª¨ë‹¬ì—ì„œ íŒŒì¼ ì„ íƒ í´ë¦­ ì‹œ 
	$("#editInsertPostFile").on("change",function(e){
		console.log("ìˆ˜ì • ì´ë¯¸ì§€ ì¶”ê°€ë¨")
		let files = e.target.files;

		for(let i=0; i<files.length; i++){
			let file = files[i];

			fileMap.set(fileNum.toString(),file);

			let reader = new FileReader();
    		reader.onload = function(e){
    			html = `
					<div class="imgDiv">
						<img src="\${e.target.result}"  data-fileNum='\${fileNum}' >
								<i class="bi bi-x-lg"></i>
						</img>
					</div>
					`;
        		fileNum++;
				$("#editImgArea").append(html);
    		}
    		reader.readAsDataURL(file);
		}

	});
	
	// ìˆ˜ì • ëª¨ë‹¬ì— ìˆëŠ” íŒŒì¼ ì˜ì—­ì— iíƒœê·¸ í´ë¦­ ì‹œ 
	$("#editImgArea").on("click","i",function(){
		$(this).parent('div').remove();		// ì‚­ì œí•  íŒŒì¼ì„ ê°ì‹¸ê³  ìˆëŠ” divë¥¼ ì‚­ì œí•¨

		// ìˆ˜ì • ì´ë¯¸ì§€ ì˜ì—­ì— ì´ë¯¸ì§€ element
		let img = $(this).parent('div').find('img')[0];
		console.log("img : ", img);

		if(img.dataset.filenum != null){
			deleteFileList.push(img.dataset.filenum);	// ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì— ì‚­ì œí•œ íŒŒì¼ì˜ ìƒì„¸ë²ˆí˜¸ë¥¼ ë„£ìŒ
		}
		deleteFileGroupNo.set(img.dataset.filegroupno,deleteFileList);	// ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•  íŒŒì¼ì˜ ê·¸ë£¹ë²ˆí˜¸ë¥¼ í‚¤ë¡œ ì„¤ì •í•˜ê³  ì•ˆì— ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë„£ìŒ
	});

	$("#reportModal").on("show.bs.modal",function(e){
		console.log("ì‹ ê³  ëª¨ë‹¬ ì—´ë¦¼ / ê²Œì‹œíŒ ë²ˆí˜¸ : " + e.relatedTarget.getAttribute('data-bs-whatever'));
		console.log("ë³´ë“œìœ í˜• : " + e.relatedTarget.getAttribute('data-bs-boardType'));
		
		let postNo = e.relatedTarget.getAttribute('data-bs-whatever');
		let boardType = e.relatedTarget.getAttribute('data-bs-boardType');
		let comuProfileNo = e.relatedTarget.getAttribute('data-bs-comuProfileNo');
		let comuNick = e.relatedTarget.getAttribute('data-bs-comuNick');
		let comuContent = e.relatedTarget.getAttribute('data-bs-comuContent');
		let selectType = e.relatedTarget.getAttribute('data-bs-selectType');
		let comuReplyNo = e.relatedTarget.getAttribute('data-bs-comuReplyNo');
		
		console.log("boardType:", boardType);
		
		//let code = ${codeMap};
		let reasonCode = code.reasonCode;
		let reportStatCode = code.reportStatCode;
		let reportTarCode = code.reportTarCode;

		let targetCode;
		if(boardType == 'ARTIST_BOARD'){
			for(let i=0; i<reportTarCode.length; i++){
				if(reportTarCode[i].commCodeDetNo === selectType){
					targetCode = reportTarCode[i].commCodeDetNo;
				}
			}
			
			console.log("ì•„í‹°ìŠ¤íŠ¸ê²Œì‹œíŒì„", targetCode)
		}
		
		let info = {
			"postNo" : postNo,
			"boardType" : boardType,
			"comuProfileNo" : comuProfileNo,
			"reasonCode" : reasonCode,
			"reportTarCode" : targetCode,
			"comuNick" : comuNick,
			"comuContent" : comuContent,
			"comuReplyNo" : comuReplyNo
		};
		reportModalInfo(info);

	});

	
	$("#reportSendBtn").on("click",function(){
		let reportForm = document.getElementById("reportForm");

		let data = new FormData(reportForm);
		console.log(data)
		$.ajax({
			url : "/community/send/report",
			type : "post",
			data : data,
			contentType : false,
			processData : false,
			success : function(res){
				if(res == 'OK'){
					alert("ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!");
					$("#reportModal").modal('hide');
				}else if(res == 'EXIST'){
					alert("ì´ë¯¸ ì‹ ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.");
				}
			},
			error : function(error){
				console.log(error.status);
			},
			beforeSend : function(xhr) {
		        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
		    }
		});
	});

	$("#reportModal").on("hide.bs.modal",function(e){
		$("#targetComuReplyNo").val("");
	});

	$("#scheduleModal").on("show.bs.modal",function(e){
		console.log(e);
		let flag = true;	// ìƒì„¸ì¼ì •ì´ë¼ëŠ” ì˜ë¯¸
		
		let modalTitle = $("#title");		// ìƒì„¸ ëª¨ë‹¬ ì œëª©
    	let modalContent = $("#content");	// ìƒì„¸ ëª¨ë‹¬ ë‚´ìš©
    	let modalPlace = $("#place");		// ìƒì„¸ ëª¨ë‹¬ ì¥ì†Œ
    	let modalUrl = $("#dateUrl");		// ìƒì„¸ ëª¨ë‹¬ 
    	let modalTextColor = $("#textColor");	// ìƒì„¸ ëª¨ë‹¬ ì œëª© ìƒ‰ìƒ
    	let modalBackgroundColor = $("#backgroundColor");	// ì¼ì • ë°°ê²½ ìƒ‰
    	let modalDateId = $("#dateId");		// ì¼ì • ë²ˆí˜¸
    	let link = $("#datelink");			// urlíƒœê·¸
    	let modalAllDayStatus = $("#allDayStatus");
    	
    	let twolDayDiv = $("div[class=notAllDaySchedule]");
    	let oneDayDiv = $("div[class=allDaySchedule]");
    	let modalStartDate = $("#startDate");
    	let modalEndDate = $("#endDate");
    	let allDate = $("#allDate");
    	
		let target = e.relatedTarget;
		
		console.log("ìƒì„¸ëª¨ë‹¬", twolDayDiv);
		
		let { title, url, textColor, backgroundColor, id, allDay, startStr, endStr, start, end } = target.event;
		let { allDayStatus, content, place } = target.event.extendedProps;
		
		modalTitle.val(title);
    	modalContent.html(content);
    	modalPlace.val(place);
    	modalUrl.val(url);
    	modalTextColor.val(textColor);
    	modalBackgroundColor.val(backgroundColor);
    	modalDateId.val(id);
    	modalAllDayStatus.val(allDayStatus)
    	
    	link.attr("href",url);
    	link.html(title+"ë°”ë¡œê°€ê¸°");
    	
    	if(allDay){
    		$("#allDayStatus").prop("checked",true);
    		
    		if(endStr == null || end == null){
    			endStr = startStr;
    			oneDayDiv.attr("style","display:block");
    			allDate.val(startStr)
    		}else{
    			twolDayDiv.attr("style","display:block")
	    		modalStartDate.val(startStr);
	    		modalEndDate.val(endStr);
    		}
    		
    	}else{
    		$("#allDayStatus").prop("checked",false);
    		twolDayDiv.attr("style","display:block");
    		let formatStart = scheduleDateFormat(start);
    		let formatEnd = scheduleDateFormat(end);
    		modalStartDate.val(formatStart);
    		modalEndDate.val(formatEnd);
    	}
	});
	
	$("#scheduleModal").on('hide.bs.modal',function(){
		let twolDayDiv = $("div[class=notAllDaySchedule]");
    	let oneDayDiv = $("div[class=allDaySchedule]");
    	
    	twolDayDiv.attr("style","display:none");
    	oneDayDiv.attr("style","display:none");
	});
	
	$("#test").on("click",function(){
		$("#postDetailModal").modal('show');
	});
	


	// íŒ”ë¡œìš° ê¸°ëŠ¥
	// íŒ”ë¡œìš°ë²„íŠ¼
	let followFlag = "${followFlag}" != 'N' ? true : false;
	let followToggleBtn = $("#followToggleBtn"); // íŒ”ë¡œìš° ë²„íŠ¼

	followToggleBtn.on("click",function(){
		if(followFlag){
			Swal.fire({
				   title: 'íŒ”ë¡œìš°ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
				   text: 'ì·¨ì†Œ í›„ ì¬ ê°€ì…ì‹œ ê¸°ì¡´ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
				   icon: 'warning',

				   showCancelButton: true, // cancelë²„íŠ¼ ë³´ì´ê¸°. ê¸°ë³¸ì€ ì›ë˜ ì—†ìŒ
				   confirmButtonColor: '#3085d6', // confrim ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
				   cancelButtonColor: '#d33', // cancel ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
				   confirmButtonText: 'í™•ì¸', // confirm ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •
				   cancelButtonText: 'ì·¨ì†Œ', // cancel ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •

				}).then(result => {
				   // ë§Œì•½ Promiseë¦¬í„´ì„ ë°›ìœ¼ë©´,
				    if(result.isConfirmed) { // ë§Œì•½ ëª¨ë‹¬ì°½ì—ì„œ confirm ë²„íŠ¼ì„ ëˆŒë €ë‹¤ë©´
				    	let comuProfileNo = "${userProfile.comuProfileNo}";
				    	let artGroupNo = "${userProfile.artGroupNo}";
				    	let memUsername = "${userProfile.memUsername}";
				    	let data = {
				    			comuProfileNo : comuProfileNo,
				    			artGroupNo : artGroupNo,
				    			memUsername : memUsername,
				    	}
				    	// íŒ”ë¡œìš° ì·¨ì†Œ
				    	$.ajax({
				    		url : "/api/community/removeapt",
				    		type : "post",
				    		contentType : "application/json; charset=utf-8",
				    		data : JSON.stringify(data),
				    		beforeSend : function(xhr){
								xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
							},
				    		success : function(res){
				    			location.reload();
				    		},
				    		error : function(err){
				    			console.log(err);
				    			sweetAlert("error","ì·¨ì†Œ ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!");
				    		}
				    	});

				    }
				});
		}else{
			$("#commProfileModal").modal("show");
		}
	})

	if(!followFlag){
		let followBtn = $("#followBtn");	// ì˜¤ë²„ë ˆì´ìª½ íŒ”ë¡œìš° ë²„íŠ¼
		let commProfileModal = $("#commProfileModal"); // ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ ìƒì„± ëª¨ë‹¬
		let previewImgBox = $("#previewImgBox"); //ë¯¸ë¦¬ë³´ê¸°ì´ë¯¸ì§€ë°•ìŠ¤
		let imgFile = $("#imgFile"); // ì´ë¯¸ì§€ ì²¨ë¶€ íŒŒì¼
		let previewImg = $("#previewImg"); // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€
		let comuNicknm = $("#comuNicknm"); // ë‹‰ë„¤ì„ í•„ë“œ
		let file = null;	// íŒŒì¼ ì—†ìœ¼ë©´ null
		let profileSubmitBtn = $("#profileSubmitBtn"); // ë‹‰ë„¤ì„ ë“±ë¡ ë²„íŠ¼

		followBtn.on("click",function(){
			commProfileModal.modal("show");
		});

		// í”„ë¡œí•„ ì´ë¯¸ì§€ ë°•ìŠ¤ í´ë¦­ì‹œ ì´ë¯¸ì§€íŒŒì¼ ì„ íƒ
		previewImgBox.on("click",function(){
			imgFile.click();
		})

		// í”„ë¡œí•„ ì´ë¯¸ì§€ ì´ë²¤íŠ¸
		imgFile.on("change",function(){
			const defaultPath = "${pageContext.request.contextPath}/upload/profile/base/defaultImg.png";
			const maxSize = 2 * 1024 * 1024;
			file = this.files[0];

			if(file == null){
				previewImg.attr("src", defaultPath);
				return false;
			}

			if(file.size > maxSize){
				sweetAlert("error", "íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 2MB ë¯¸ë§Œìœ¼ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”!");
				$(this).val("");
				file = null;
				previewImg.attr("src", defaultPath);
				return false;
			}

			if(!file.type.startsWith("image/")){
				sweetAlert("error", "ì´ë¯¸ì§€íŒŒì¼ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”");
				$(this).val("");
				file = null;
				previewImg.attr("src", defaultPath);
				return false;
			}

			let fileReader = new FileReader();
			fileReader.onload = function(e){
				previewImg.attr("src", e.target.result);
			};

			fileReader.readAsDataURL(file);
		})

		profileSubmitBtn.on("click",function(){
			let comuNicknmVal = comuNicknm.val();
			if(comuNicknmVal == null || comuNicknmVal.trim() == ''){
				sweetAlert("error","ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
				return false;
			}
			if(comuNicknmVal.length > 12){
				sweetAlert("error","ë‹‰ë„¤ì„ì€ 12ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”");
				return false;
			}

			let formData = new FormData();
			let artGroupNo = "${artistGroupVO.artGroupNo}";
			let memUsername = "${user.username}";
			formData.append("artGroupNo",artGroupNo);
			formData.append("memUsername",memUsername);
			formData.append("comuNicknm", comuNicknmVal);
			if(file != null){
				formData.append("imgFile", file);
			}
			joinCommunity(formData);
		})

	}

	function joinCommunity(formData){
		$.ajax({
			url : '/api/community/joinapt',
			type : "post",
			processData : false,
			contentType : false,
			data : formData,
			beforeSend : function(xhr){
				xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
			},
			success : function(res){
				location.reload();
			},
			error : function(err){
				console.log(err);
				sweetAlert("error","íŒ”ë¡œìš° í•˜ëŠ” ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!");
			}
		});
	}

	let myProfile = $("#myProfile"); // ë§ˆì´í”„ë¡œí•„ ì—˜ë¦¬ë¨¼íŠ¸
	myProfile.on("click",function(){
		let artGroupNo = "${artistGroupVO.artGroupNo}";
		let comuProfileNo = $(this).data("comuProfileNo");
		location.href = `${pageContext.request.contextPath}/community/\${artGroupNo}/profile/\${comuProfileNo}`;
	});


	// ëª¨ë‹¬ ìˆ˜ì • ë¶€ë¶„
	// feedItem í´ë¦­ì‹œ ëª¨ë‹¬ ì˜¤í”ˆ
	$(".feedBox").each((i,v) => {
		$(v).on("click",function(){
			let postNum = $(this).data("postId");

			openDetailModal(postNum);
			$("#detailPostModal").modal("show");
		})
	});
});
function contentLengthCheck(ele){
	let size = ele.value.length;
	let text = ele.value;
	if(size > 1000){
		alert("ê¸€ ì‘ì„±ì€ 1000ì ì´ìƒì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		let subText = text.substring(0,1000);
		ele.value = subText;
		$(ele).parents("form").find(".cmt-sub-size").text(subText.length);
		return false;
	}

	$(ele).parent("form").find(".cmt-sub-size").text(size);
}

function replyContentLengthCheck(ele){
	let size = ele.value.length;
	let text = ele.value;
	if(size > 300){
		alert("ëŒ“ê¸€ ì‘ì„±ì€ 300ì ì´ìƒì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		let subText = text.substring(0,300);
		ele.value = subText;
		$(ele).parents(".comment-form-container").parent("#replyArea").find(".cmt-sub-size").text(subText.length);
		return false;
	}

	$(ele).parent(".comment-form-container").parent("#replyArea").find(".cmt-sub-size").text(size);
}


function dateFormat(jsonDate){
	if (!jsonDate) return "";
	let date = new Date(jsonDate);
	let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return month + '.' + day + '. ' + hour + ':' + minute;
}

function scheduleDateFormat(jsonDate){
	if (!jsonDate) return "";
	let date = new Date(jsonDate);
	let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return month + '-' + day + ' ' + hour + ':' + minute;
}

// ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì‹œ
function likeBtn(e){
	let icon = e.children('i');
	let like = e.children('span');

	let iconAttr = icon.attr("class")
	let likeCount = e.children('span').html();

	console.log("iconAttr", iconAttr);
	let updateLikeCount;

	if(iconAttr === "bi bi-heart-fill"){
		icon.attr("class","bi bi-heart");
		updateLikeCount = parseInt(likeCount) - 1;
	}else{
		icon.attr("class","bi bi-heart-fill");
		updateLikeCount = parseInt(likeCount) + 1;
	}

	like.html(updateLikeCount);

}

// ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
function likeUpdate(data){
	$.ajax({
		url : "/community/like/update",
		type : "post",
		data : data,
		processData : false,
		contentType : false,
		success : function(res){
			if(res == 'OK'){
				location.reload();
			}
		},
		error : function(error){
			console.log(error.status);
		},
		beforeSend : function(xhr){
			xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
		}
	});
}

/* let info = {
"postNo" : postNo,
"boardType" : boardType,
"comuProfileNo" : comuProfileNo,
"reasonCode" : reasonCode,
"reportTarCode" : reportTarCode,
"comuNick" : comuNick,
"comuContent" : comuContent
"comuReplyNo" : comuReplyNo
}; */

function reportModalInfo(info){
	console.log("ì²˜ë¦¬í•˜ê¸° : " + info)
// 	<input type="radio" class="btn-check" name="options-outlined" id="success-outlined" autocomplete="off" checked>
// 	<label class="btn btn-outline-primary" for="success-outlined">Checked success radio</label>

// 	<input type="radio" class="btn-check" name="options-outlined" id="danger-outlined" autocomplete="off">
// 	<label class="btn btn-outline-danger" for="danger-outlined">Danger radio</label>
	let postNo = info.postNo;	
	let boardType = info.boardType;  
	let comuProfileNo = info.comuProfileNo; 
	let reasonCodeList = info.reasonCode;	
	let reportTarCode = info.reportTarCode; 
	let artGroupNo = $("#communityArtistGroupNo").val();
	let comuReplyNo = info.comuReplyNo;
	
	console.log(artGroupNo)

	let targetNick = info.comuNick;

	let targetContent = info.comuContent;

	let radioHtml = ``;
	for(let i=0; i<reasonCodeList.length; i++){
		let reasonCode = reasonCodeList[i];
		radioHtml += `
			<input type="radio" class="btn-check" name="reportReasonCode" id="\${reasonCode.commCodeDetNm}" value="\${reasonCode.commCodeDetNo}" autocomplete="off">
		 	<label class="btn btn-outline-primary" for="\${reasonCode.commCodeDetNm}">\${reasonCode.description}</label>
		`;
	}

	$(".radioArea").html(radioHtml);

	$("#targetNick").val(targetNick);
	$("#targetContent").html(targetContent);

	$("#targetComuPostNo").val(postNo);
	$("#targetBoardTypeCode").val(boardType);
	$("#reportArtGroupNo").val(artGroupNo);
	$("#targetComuProfileNo").val(comuProfileNo);
	$("#reportTargetTypeCode").val(reportTarCode);
	
	if(comuReplyNo != null){
		$("#targetComuReplyNo").val(comuReplyNo);
	}

	console.log("íƒ€ê²Ÿ ì½”ë“œ : ", reportTarCode);
}

function updateModalInfo(postNum){
	$.ajax({
		url : "/community/post/get/" + postNum,
		type : "get",
		success : function(res){
			console.log("ìˆ˜ì • ëª¨ë‹¬ì— ë“±ë¡ ë  ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì§€ê³  ì˜´",res);

			$("#editComuPostContent").text(res.comuPostContent);

			let content = document.getElementById("editComuPostContent");
			contentLengthCheck(content);

			$("#fileGroupNo").val(res.fileGroupNo);
			console.log("ê°€ì§€ê³  ì˜¨ ì •ë³´ ì¤‘ íŒŒì¼ ê·¸ë£¹ë²ˆí˜¸ë¥¼ fileGroupNoì•„ì´ë””ë¥¼ ê°€ì§„ inputì˜ íˆë“  íƒ€ì…ì— ê°’ì„ ë„£ì–´ì¤Œ fileGroupNo : ", res.fileGroupNo);

			if(res.artistTabYn){
				if(res.memberShipYn){
					$("#editPostMemberShipYn").prop("checked",true);
				}
				$("#checkBoxMbs").attr("style", "display:block");
			}else{
				$("#checkBoxMbs").attr("style", "display:none");
			}

			let html = ``;
			if(res.postFiles != null && res.postFiles.length > 0){
				for(let i=0; i<res.postFiles.length; i++){
					let postFile = res.postFiles[i];
					html += `
						<div class="imgDiv">
							<img src="\${postFile.webPath}"  data-fileNum='\${postFile.attachDetailNo}' >
									<i class="bi bi-x-lg"></i>
							</img>
						</div>
					`;
				}
			}

			$("#editImgArea").append(html);

			let modal = document.getElementById("editPostModal")
			let myModal = new bootstrap.Modal(modal);
			myModal.show();

		},
		error : function(error){
			console.log(error.status);
		}
	});
}

// ëª¨ë‹¬ ìˆ˜ì • ë¶€ë¶„
function openDetailModal(postNum){

	console.log("postNum: ", postNum)
	let artGroupNo = $("#communityArtistGroupNo").val();

	let data = new FormData();
	data.append("artGroupNo",artGroupNo);
	data.append("comuPostNo",postNum )

	$.ajax({
		url : "/community/post/detail/" + postNum,
		type : "get",
		data : {
			"artGroupNo" : artGroupNo,
			"comuPostNo" : postNum
		},
		success : function(res){
			console.log(res);
			// ì‘ì„±ì ì •ë³´
			let writer = res.writerProfile;
			let {comuProfileImg : writerImg, comuNicknm : writerNick, comuProfileNo:writerComuProfileNo} = writer;
			let userProfileNo = 0;
				if("${not empty userProfile}"){
					userProfileNo = "${userProfile.comuProfileNo}"
				}
			// ê²Œì‹œíŒ ì •ë³´
			let {comuPostContent:content,postFiles,boardTypeCode
				,comuPostNo,likeYn, comuPostRegDate:regDate
				,comuPostModDate : modDate
				,comuPostLike : likeCount, comuPostReplyList, comuPostReplyCount} = res
			
			console.log("comuPostReplyCount : ", comuPostReplyCount);
				
			$("#comuPostNo").val(comuPostNo);
			$("#boardTypeCode").val(boardTypeCode);

			let likeIcon = $("#likeBtn").children('i');
			let likeClass;
			if(likeYn == 'Y'){
				likeClass = "bi bi-suit-heart-fill";
			}else{
				likeClass = "bi bi-suit-heart";
			}
			likeIcon.attr("class",likeClass);

			let date;
			if(regDate === modDate){
				date = dateFormat(regDate);
			}else{
				date = dateFormat(modDate) + "(ìˆ˜ì •ë¨)";
			}

			let postHtml = ``;
			postHtml = `
				<div class="post-pane-header">
                	<div class="d-flex align-items-center">
                        <img src="\${writerImg}" class="rounded-circle" width="50px" height="50px">
                        <div class="ms-2">
                            <strong class="d-block">\${writerNick}</strong>
                            <small class="text-muted">\${date}</small>
                        </div>
                	</div>
                	<div class="dropdown">
				        <button class="btn btn-link text-secondary p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
				            <i class="bi bi-three-dots-vertical"></i>
				        </button>
				        <ul class="dropdown-menu"
				`;
			if(writerComuProfileNo == userProfileNo){
				postHtml += `
					<li><button class="dropdown-item" data-comu-post-no="\${postNum}" id="edit" >ìˆ˜ì •</button></li>
		            <li><button class="dropdown-item" data-comu-post-no="\${postNum}" id="delete">ì‚­ì œ</button></li>
				`;
			}else{
				postHtml += `
					<li><button class="dropdown-item text-danger" data-comu-post-no="\${postNum}" >ì‹ ê³ </button></li>
				`;
			}
			postHtml += `
				        </ul>
				    </div>
                </div>
                <div class="post-pane-body">
                `;
            if(postFiles != null && postFiles.length > 0){
            	for(let file of postFiles){
            		postHtml += `
            			<img src="\${file.webPath}" alt="\${file.fileOriginalNm}" width="150px" height="150px">
            		`;
            	}
            }
            postHtml += `
                	<p>\${content}<p>
                </div>
                <div class="post-pane-footer">
                `;
            if(likeYn == 'Y'){
            postHtml += `
				    <button type="button" class="btn btn-like active" data-comu-post-no="\${postNum}" data-comu-profile-no="\${userProfileNo}" id="likeButton">
				        <i class="bi bi-heart-fill"></i>
				        <span id="likeCount">\${likeCount}</span>
				    </button>
            	`;
            }else{
            	postHtml += `
				    <button type="button" class="btn btn-like" data-comu-post-no="\${postNum}" data-comu-profile-no="\${userProfileNo}" id="likeButton">
				        <i class="bi bi-heart"></i>
				        <span id="likeCount">\${likeCount}</span>
				    </button>
            	`;
            }
            postHtml +=`
				</div>
			`;

			$("#postBox").html(postHtml);

			$("#replyCount").html("ë‹µê¸€ " + comuPostReplyCount + "ê°œ");

			// ëŒ“ê¸€ ì˜ì—­
			let replyHtml = ``;
			for(let reply of comuPostReplyList){
				let {comuReplyContent, comuReplyRegDate, comuReplyNo, replyMember, comuReplyModDate} = reply;
				let {comuProfileImg, comuNicknm, comuProfileNo:replyComuProfileNo} = replyMember;
				replyHtml += `
					<div class="comment-item">
		            <img src="\${comuProfileImg}" class="rounded-circle comment-avatar">
		            <div class="comment-main-wrapper">
		            	<div class="comment-header">
		            		<strong>\${comuNicknm}</strong>
		            		<div class="dropdown">
						        <button class="btn btn-link text-secondary p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
						            <i class="bi bi-three-dots-vertical"></i>
						        </button>
						        <ul class="dropdown-menu">
					`;
					if(userProfileNo == replyComuProfileNo){
						replyHtml += `
				            <li><button class="dropdown-item" data-comu-reply-no="\${comuReplyNo}" data-post-no="\${comuPostNo}" id="replyDeleteBtn">ì‚­ì œ</button></li>
						`;
					}else{
						replyHtml += `
							<li><button class="dropdown-item text-danger" 
								data-bs-toggle="modal"
								data-bs-target="#reportModal"
								data-bs-whatever="\${comuPostNo}"
								data-bs-comuReplyNo="\${comuReplyNo}"
								data-bs-boardType="\${boardTypeCode}"
								data-bs-comuProfileNo="\${replyComuProfileNo}"
								data-bs-comuNick="\${comuNicknm}"
								data-bs-comuContent="\${comuReplyContent}"
								data-bs-selectType="RTTC002"
								>ì‹ ê³ </button></li>
						`;
					}
					replyHtml += `
										</ul>
						            </div>
						        </div>
						        <div class="comment-body-text"> <p>\${comuReplyContent}</p>
						            <small class="text-muted">\${dateFormat(comuReplyModDate)}</small>
						        </div>
						    </div>
						</div>
					`;
			}
			$("#replyList").html(replyHtml);

			$("#boardTypeCode",$("#postBox")).val(boardTypeCode);
			$("#comuPostNo",$("#postBox")).val(comuPostNo)

		},
		error : function(error){
			console.log(error.status);
		}
	});
}

function fullCalendar(schedule){
	var calendarEl = document.getElementById('calendar');
	var calendar = new FullCalendar.Calendar(calendarEl,{
		height : 'auto',
		initialView : 'dayGridMonth',
		locale : 'ko',
		buttonText : {
			today : 'ì˜¤ëŠ˜',
			month : 'ë‹¬',
			week : 'ì´ë²ˆì£¼'
		},
		events : schedule,
		eventDidMount: function(info) {
			console.log(info);
			
			let { place, content } = info.event.extendedProps;
			
			tooltipHtml = `
				<div> ì¥ ì†Œ : \${place}</div>
				<div> ë‚´ ìš© : \${content}</div>
			`;
			var tooltip = new bootstrap.Tooltip(info.el, {
			   title : tooltipHtml,
			html : true,
			   placement: 'top',
			   trigger: 'hover',
			   container: 'body'
			});
	    },
	    headerToolbar : {
			start : 'prevYear,prev,next,nextYear today',
			center : 'title',
			end : 'dayGridMonth,dayGridWeek'
		},
		eventClick : function(e){
        	e.jsEvent.cancelBubble = true;		// ì¼ì •ì— ìˆëŠ” url ë§‰ê¸°
        	e.jsEvent.preventDefault();
        	
        	const detailModal = new bootstrap.Modal(document.getElementById('scheduleModal'));
        	
        	detailModal.show(e);
        },
	});
	calendar.render();
}
</script>
</body>
</html>