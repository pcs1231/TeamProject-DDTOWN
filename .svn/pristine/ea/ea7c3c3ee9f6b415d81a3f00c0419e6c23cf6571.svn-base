<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%> 

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <%-- Assuming product object is set in request scope --%>
	<title>DDTOWN êµ¿ì¦ˆìƒµ - ${not empty goods.goodsNm ? goods.goodsNm : "ìƒí’ˆ ìƒì„¸"}</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
 	<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/goods.css">
</head>
<body class="product-detail-page-body">
    <header class="site-header">
        <div class="logo">
            <a href="../2.main/artist_community_main.html">DDTOWN SQUARE</a>
        </div>
        <nav class="utility-nav">
            <ul id="loggedOutNav">
                <li><a href="../login.html" class="auth-link">ë¡œê·¸ì¸</a></li>
                <li><a href="../signup.html" class="signup-link">íšŒì›ê°€ì…</a></li>
            </ul>
            <ul id="loggedInNav" style="display: none">
                <li><a href="#" class="icon-btn" title="ì•Œë¦¼">ğŸ””</a></li>
                <li><a href="../mypage.html" class="icon-btn" title="ë§ˆì´í˜ì´ì§€">ğŸ‘¤</a></li>
                <li><a href="#" class="icon-btn" title="ê³ ê°ì„¼í„°">ğŸ‘©â€ğŸ’»</a></li>
                <li><a href="#" id="logoutBtn" class="auth-link">ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </nav>
    </header>

    <nav class="main-navigation">
        <ul>
            <li><a href="goods_shop.html">êµ¿ì¦ˆìƒµ</a></li>
            <li>
                <a href="#">ì„ í˜¸ë„ ì¡°ì‚¬</a>
                <ul class="submenu">
                    <li><a href="#">ì¸ê¸° íˆ¬í‘œ</a></li>
                </ul>
            </li>
            <li><a href="#">ì½˜ì„œíŠ¸</a></li>
        </ul>
    </nav>

    <div class="detail-container">
        <c:if test="${not empty goods}">
            <div class="product-main-info-wrapper">
				<section class="product-image-gallery">
				    <%-- goods ê°ì²´ê°€ ìœ íš¨í•œì§€ ë¨¼ì € í™•ì¸ --%>
				    <c:if test="${not empty goods}">
				        <div class="product-main-image-detail">
				            <%-- ë©”ì¸ ì´ë¯¸ì§€: goodsVOì˜ representativeImageUrl í•„ë“œë¥¼ ì‚¬ìš© --%>
				            <img src="${not empty goods.representativeImageUrl ? goods.representativeImageUrl : 'https://via.placeholder.com/550x550/E6E6FA/000000?text=Album+Main'}" 
				                 alt="ìƒí’ˆ ë©”ì¸ ì´ë¯¸ì§€" id="mainProductImageDetail">
				        </div>
				        <div class="product-thumbnail-images-detail">
				            <%-- ì¸ë„¤ì¼ ì´ë¯¸ì§€: goodsVOì˜ attachmentFileListë¥¼ ìˆœíšŒí•˜ë©° AttachmentFileDetailVOì˜ webPath ì‚¬ìš© --%>
				            <%-- attachmentFileListê°€ ë¹„ì–´ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ë°˜ë³µ --%>
				            <c:if test="${not empty goods.attachmentFileList}">
				                <c:forEach var="file" items="${goods.attachmentFileList}" varStatus="loop">
				                    <%-- ëŒ€í‘œ ì´ë¯¸ì§€ì™€ ì¸ë„¤ì¼ ì´ë¯¸ì§€ê°€ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ í•„ìš”í•˜ë‹¤ë©´ ì¡°ê±´ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
				                         ì˜ˆ: <c:if test="${file.fileNo ne goods.representativeImageFile.fileNo}"> --%>
				                    <img src="${file.webPath}" 
				                         alt="ì¸ë„¤ì¼ ${loop.count}" 
				                         class="${loop.first ? 'active' : ''}" <%-- ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë§Œ 'active' í´ë˜ìŠ¤ ë¶€ì—¬ --%>
				                         onclick="changeDetailMainImage('${file.webPath}', '550x550', this)">
				                </c:forEach>
				            </c:if>
				            
				            <%-- ì²¨ë¶€íŒŒì¼(ì¸ë„¤ì¼ í¬í•¨)ì´ ì•„ì˜ˆ ì—†ê±°ë‚˜, ëª¨ë“  íŒŒì¼ì´ í•„í„°ë§ë˜ì–´ ì¸ë„¤ì¼ë¡œ í‘œì‹œí•  ê²ƒì´ ì—†ëŠ” ê²½ìš°ì˜ í´ë°± ì´ë¯¸ì§€ --%>
				            <%-- ì—¬ê¸°ì„œëŠ” goods.attachmentFileListê°€ ë¹„ì–´ìˆì„ ë•Œë§Œ í´ë°± ì²˜ë¦¬í•©ë‹ˆë‹¤. --%>
				            <c:if test="${empty goods.attachmentFileList}">
				                <img src="https://via.placeholder.com/70x70/E6E6FA/000000?text=Thumb1" alt="ì¸ë„¤ì¼ 1" class="active" onclick="changeDetailMainImage(this.src, '550x550', this)">
				                <img src="https://via.placeholder.com/70x70/D8BFD8/000000?text=Thumb2" alt="ì¸ë„¤ì¼ 2" onclick="changeDetailMainImage(this.src, '550x550', this)">
				            </c:if>
				        </div>
				    </c:if>
				    <%-- goods ê°ì²´ê°€ ì•„ì˜ˆ ì—†ëŠ” ê²½ìš° (ìƒí’ˆ ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ì‚­ì œëœ ê²½ìš° ë“±) --%>
				    <c:if test="${empty goods}">
				        <div style="text-align: center; padding: 50px;">
				            <p>ìƒí’ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
				            <img src="https://via.placeholder.com/550x550/E6E6FA/000000?text=Product+Not+Found" alt="ìƒí’ˆ ì°¾ì„ ìˆ˜ ì—†ìŒ" style="max-width: 100%;">
				        </div>
				    </c:if>
				</section>

                <section class="product-purchase-info">
                        <%-- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ "goods"ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë„˜ê²¨ì¤€ ê°ì²´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. --%>
					    <div class="artist-tag">${goods.artGroupNo}</div>
					    <h1 class="product-name-detail">${not empty goods.goodsNm ? goods.goodsNm : "ìƒí’ˆëª… ì—†ìŒ"}</h1>
					    <p class="product-short-description">${not empty goods.goodsContent ? goods.goodsContent : "ìƒí’ˆ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤."}</p>

                    <div class="product-price-detail-area">
                        <%-- Initial price set to 0, will be updated by JS if an option is selected --%>
                        <div class="product-price-detail" id="productPrice">${goods.goodsPrice }<span class="currency">ì›</span></div>
                        <div class="shipping-info-summary">ë°°ì†¡ë¹„ 3,000ì› (50,000ì› ì´ìƒ êµ¬ë§¤ ì‹œ ë¬´ë£Œ)</div>
                    </div>
				
					
					<div class="product-options-detail">
					    <div class="option-group">
					        <label for="productOption">ì˜µì…˜ ì„ íƒ</label>
					        <select id="productOption" name="productOption">
					            <option value="">ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
					            <c:forEach var="option" items="${optionList}">
					                <option value="${option.goodsOptNo}" data-price="${option.goodsOptPrice}" data-name="<c:out value='${option.goodsOptNm}'/>">
					                    <c:out value="${option.goodsOptNm}"/> - <fmt:formatNumber value="${option.goodsOptPrice}" type="number" groupingUsed="true" />ì›
					                </option>
					            </c:forEach>
					        </select>
					    </div>
	
						<div id="selectedOptionArea" style="margin-top: 10px; margin-bottom: 15px;">
						    	
						</div>
					</div>
				
					<div class="total-price-summary">
					    <span class="total-label">ì´ ìƒí’ˆê¸ˆì•¡:</span>
					    <span class="total-amount" id="totalProductPriceDetail">
					        <c:choose>
					            <c:when test="${not empty optionList}">0</c:when>
					            <c:otherwise><fmt:formatNumber value="${goods.goodsPrice}" type="number" groupingUsed="true" /></c:otherwise>
					        </c:choose>
					         ì›
					    </span>
					</div>

                    <div class="product-actions-detail">
                        <button class="btn-action-detail wishlist" id="addToWishlistBtnDetail">â¤ï¸ ì°œí•˜ê¸°</button>
						<form id="addToCartForm" action="/goods/cart" method="post">
							<button type="button" class="btn-action-detail cart" id="addToCartBtnDetail">ì¥ë°”êµ¬ë‹ˆ</button>
							<input type="hidden" name="goodsNo" value="${goods.goodsNo}">
							<sec:csrfInput/>
						</form>
                        <button class="btn-action-detail order" id="orderNowBtnDetail">ë°”ë¡œ ì£¼ë¬¸</button>
                    </div>
                </section>
            </div>

            <div class="product-info-tabs-container">
                <nav class="product-info-tabs">
                    <a href="#" class="tab-link active" data-tab-target="productDescription">ìƒí’ˆ ìƒì„¸</a>
                    <a href="#" class="tab-link" data-tab-target="shippingGuide">ë°°ì†¡/êµí™˜/í™˜ë¶ˆ ì•ˆë‚´</a>
                </nav>
					<div id="productDescription" class="tab-pane active">
					    <h4>ìƒí’ˆ ì •ë³´</h4>
					    <p>${not empty goods.goodsContent ? goods.goodsContent : "ìƒì„¸ ìƒí’ˆ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."}</p>
					
					    <%-- ìƒí’ˆ ìƒì„¸ ì´ë¯¸ì§€ ì¶œë ¥ --%>
					    <c:set var="hasDetailImages" value="false"/>
					    <c:forEach var="file" items="${goods.attachmentFileList}">
					        <c:if test="${file.webPath ne goods.representativeImageUrl}">
					            <img src="${file.webPath}" alt="ìƒí’ˆ ìƒì„¸ ì´ë¯¸ì§€ - ${file.fileOriginalNm}" style="max-width: 100%; height: auto; display: block; margin: 10px 0;">
					            <c:set var="hasDetailImages" value="true"/>
					        </c:if>
					    </c:forEach>

					    <c:if test="${empty goods.attachmentFileList or not hasDetailImages}">
					         <img src="https://via.placeholder.com/700x400/f0f0f0/333?text=ìƒí’ˆ+ìƒì„¸+ì´ë¯¸ì§€+ì—†ìŒ" alt="ìƒí’ˆ ìƒì„¸ ì´ë¯¸ì§€ ì—†ìŒ" style="max-width: 100%; height: auto; display: block; margin: 10px 0;">
					    </c:if>
					</div>
                    <div id="shippingGuide" class="tab-pane">
                        <h4>ë°°ì†¡/êµí™˜/í™˜ë¶ˆ ì•ˆë‚´</h4>
                        <p><strong>ë°°ì†¡ ì•ˆë‚´</strong><br> - ê¸°ë³¸ ë°°ì†¡ë¹„ëŠ” 3,000ì›ì´ë©°, 50,000ì› ì´ìƒ êµ¬ë§¤ ì‹œ ë¬´ë£Œë°°ì†¡ì…ë‹ˆë‹¤.<br> - ì£¼ë¬¸ì¼ë¡œë¶€í„° í‰ê·  2~5 ì˜ì—…ì¼ ì´ë‚´ ë°œì†¡ë©ë‹ˆë‹¤. (ì˜ˆì•½ ìƒí’ˆ ì œì™¸)</p>
                        <p><strong>êµí™˜/í™˜ë¶ˆ ì•ˆë‚´</strong><br> - ìƒí’ˆ ìˆ˜ë ¹ í›„ 7ì¼ ì´ë‚´ì— ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br> - ë‹¨ìˆœ ë³€ì‹¬ì˜ ê²½ìš° ì™•ë³µ ë°°ì†¡ë¹„ê°€ ë¶€ê³¼ë©ë‹ˆë‹¤.<br> - ìƒí’ˆ ë¶ˆëŸ‰ ë° ì˜¤ë°°ì†¡ì˜ ê²½ìš° ë°°ì†¡ë¹„ëŠ” íŒë§¤ì ë¶€ë‹´ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </c:if>
        <c:if test="${empty goodsList}">
            <p style="text-align: center; padding: 50px;">ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </c:if>
    </div>

    <nav class="floating-nav">
        <a href="goods_cart.html" class="floating-btn" title="ì¥ë°”êµ¬ë‹ˆ">
            ğŸ›’
            <span class="item-count-badge" id="cartItemCount" style="display: none;">0</span>
        </a>
        <a href="goods_wishlist.html" class="floating-btn" title="ì°œëª©ë¡">
            â¤ï¸
            <span class="item-count-badge" id="wishlistItemCount" style="display: none;">0</span>
        </a>
    </nav>

<script>
document.addEventListener('DOMContentLoaded', function () {
	//ìƒí’ˆ ì˜µì…˜
    const productOptionSelect = document.getElementById('productOption');
    const selectedOptionArea = document.getElementById('selectedOptionArea');
    const totalProductPriceDetailSpan = document.getElementById('totalProductPriceDetail');

    // ì´ ìƒí’ˆ ê¸ˆì•¡ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateTotalPrice() {
        let currentTotal = 0;
        const selectedItems = selectedOptionArea.querySelectorAll('.selected-option-item');
        
        selectedItems.forEach(item => {
            const price = parseFloat(item.dataset.optionPrice);
            const quantity = parseInt(item.querySelector('.quantity').value);
            currentTotal += price * quantity;
        });

        totalProductPriceDetailSpan.textContent = currentTotal.toLocaleString('ko-KR');
    }

    productOptionSelect.addEventListener('change', function () {
    		let list = document.getElementsByClassName("selected-option-item");
        const selectedOption = this.options[this.selectedIndex];
        const optionValue = selectedOption.value; 
        const optionName = selectedOption.dataset.name;
    		
    		for(let i=0; i<list.length; i++){
    			if(optionName.trim() == list[i].dataset.optionName.trim()){
    				alert("ì´ë¯¸ ì„ íƒí•˜ì‹  ìƒí’ˆì…ë‹ˆë‹¤.");
    				
    				this.value = '';
	   			return false;
    			}
    		}

        if (!optionValue || !optionName) {
            // optionNameì´ ì—†ëŠ” ê²½ìš°ë„ ì‹¤ì œë¡œëŠ” ì„ íƒë˜ë©´ ì•ˆ ë˜ë¯€ë¡œ í•¨ê»˜ ì²´í¬
            if (!optionName && optionValue) { // optionValueëŠ” ìˆëŠ”ë° ì´ë¦„ì´ ì—†ëŠ” ê²½ìš° ê²½ê³ 
                 console.warn("ì„ íƒëœ ì˜µì…˜ì— data-nameì´ ì—†ìŠµë‹ˆë‹¤:", selectedOption);
            }
            return;
        }
        
        const optionPrice = parseFloat(selectedOption.dataset.price);
        const optionItemDiv = document.createElement('div');
        
        optionItemDiv.classList.add('selected-option-item');
        optionItemDiv.dataset.optionId = optionValue;    
        optionItemDiv.dataset.optionName = optionName; // ì €ì¥í•  ë•ŒëŠ” ì›ë³¸ optionName ì €ì¥
        optionItemDiv.dataset.optionPrice = optionPrice; 

        optionItemDiv.innerHTML = `
            <span class="option-name">\${optionName}</span>
            <span class="option-price-display">(\${optionPrice.toLocaleString('ko-KR')}ì›)</span>
            <div>
                <label for="quantity-${optionValue}" class="visually-hidden">${optionName} ìˆ˜ëŸ‰</label>
                <input type="number" id="quantity-\${optionValue}" class="quantity" value="1" min="1">
            </div>
            <button type="button" class="remove-option-btn" title="ì˜µì…˜ ì‚­ì œ">&times;</button>
        `;
        
        selectedOptionArea.appendChild(optionItemDiv);

        const quantityInput = optionItemDiv.querySelector('.quantity');
        quantityInput.addEventListener('input', function() {
            if (parseInt(this.value) < 1 || isNaN(parseInt(this.value))) {
                this.value = 1;
            }
            updateTotalPrice();
        });

        const removeButton = optionItemDiv.querySelector('.remove-option-btn');
        removeButton.addEventListener('click', function () {
            optionItemDiv.remove();
            updateTotalPrice();
        });

        updateTotalPrice();
        this.value = '';
    });
    
 // ì¥ë°”êµ¬ë‹ˆ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('addToCartBtnDetail').addEventListener('click', function() {
        const form = document.getElementById('addToCartForm');
        const goodsNo = form.querySelector('input[name="goodsNo"]').value;
        const csrfToken = form.querySelector('input[name="_csrf"]').value;
        
        // ì„ íƒëœ ëª¨ë“  ì˜µì…˜ ì •ë³´ë¥¼ ë‹´ì„ ë°°ì—´ (ì—¬ê¸°ì— GoodsCartVOì™€ ë§¤í•‘ë  ë°ì´í„°ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤)
        const cartItems = [];
        // selectedOptionAreaì—ì„œ ëª¨ë“  ë™ì  ì˜µì…˜ í•­ëª©(.selected-option-item)ì„ ì°¾ìŠµë‹ˆë‹¤.
        const selectedOptionElements = selectedOptionArea.querySelectorAll('.selected-option-item');

        // ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ì˜µì…˜ì´ í•˜ë‚˜ë„ ì—†ëŠ” ê²½ìš°
        if (selectedOptionElements.length === 0) {
            alert("ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        // ê° ì„ íƒëœ ì˜µì…˜ í•­ëª©ì„ ìˆœíšŒí•˜ë©° ë°ì´í„° ì¶”ì¶œ
        selectedOptionElements.forEach(item => {
            const goodsOptNo = parseInt(item.dataset.optionId); // data-optionIdì— ì €ì¥ëœ ì˜µì…˜ ë²ˆí˜¸
            const cartQty = parseInt(item.querySelector('.quantity').value); // í•´ë‹¹ ì˜µì…˜ì˜ ìˆ˜ëŸ‰

            // ìœ íš¨ì„± ê²€ì‚¬ (ì˜µì…˜ ë²ˆí˜¸ì™€ ìˆ˜ëŸ‰ì´ ìœ íš¨í•œì§€ í™•ì¸)
            if (isNaN(goodsOptNo) || goodsOptNo <= 0) {
                console.error("ìœ íš¨í•˜ì§€ ì•Šì€ goodsOptNo:", goodsOptNo, "í•­ëª©:", item);
                alert("ìœ íš¨í•˜ì§€ ì•Šì€ ìƒí’ˆ ì˜µì…˜ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                cartItems.length = 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë°°ì—´ ë¹„ìš°ê³  ì¤‘ë‹¨
                return; 
            }
            if (isNaN(cartQty) || cartQty < 1) {
                console.error("ìœ íš¨í•˜ì§€ ì•Šì€ ìˆ˜ëŸ‰:", cartQty, "í•­ëª©:", item);
                alert("ìƒí’ˆ ìˆ˜ëŸ‰ì€ 1ê°œ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
                cartItems.length = 0; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë°°ì—´ ë¹„ìš°ê³  ì¤‘ë‹¨
                return; 
            }

            // ê° ì˜µì…˜-ìˆ˜ëŸ‰ ìŒì„ ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°°ì—´ì— ì¶”ê°€
            cartItems.push({
                goodsNo: goodsNo,       // ìƒí’ˆ ë²ˆí˜¸ (hidden inputì—ì„œ ê°€ì ¸ì˜´)
                goodsOptNo: goodsOptNo, // í˜„ì¬ ì˜µì…˜ì˜ ë²ˆí˜¸
                cartQty: cartQty        // í˜„ì¬ ì˜µì…˜ì˜ ìˆ˜ëŸ‰
                // GoodsCartVOì— ìˆëŠ” ë‹¤ë¥¸ í•„ë“œ(memUsername, cartTotalAmount ë“±)ëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜,
                // ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ì—ì„œ ì¡°íšŒí•˜ì—¬ í‘œì‹œí•  ì •ë³´ì´ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ëª¨ë‘ ë³´ë‚¼ í•„ìš” ì—†ìŠµë‹ˆë‹¤.
            });
        });

        // ìœ íš¨ì„± ê²€ì‚¬ í›„ cartItems ë°°ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ (ì˜¤ë¥˜ ë°œìƒ ì‹œ) ì¤‘ë‹¨
        if (cartItems.length === 0) { 
            return;
        }

        // Ajax ìš”ì²­ (fetch API ì‚¬ìš©)
        fetch('/goods/cart/addMultiple', { // ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸
            method: 'POST',
            headers: {
                'Content-Type': 'application/json', // ë³´ë‚´ëŠ” ë°ì´í„°ê°€ JSONì„ì„ ëª…ì‹œ
                'X-CSRF-TOKEN': csrfToken          // CSRF í† í° í—¤ë”ì— í¬í•¨ (ë³´ì•ˆ)
            },
            body: JSON.stringify(cartItems) // cartItems ë°°ì—´ì„ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
        })
        .then(response => {
            // ì„œë²„ ì‘ë‹µì´ ì„±ê³µ(2xx)ì¸ì§€ í™•ì¸
            if (!response.ok) {
                // HTTP ì—ëŸ¬ ìƒíƒœ (ì˜ˆ: 401 Unauthorized, 500 Internal Server Error)
                return response.json().then(errorData => {
                    throw new Error(errorData.message || 'ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
                });
            }
            return response.json(); // ì‘ë‹µ ë³¸ë¬¸ì„ JSONìœ¼ë¡œ íŒŒì‹±
        })
        .then(data => {
            // ì„œë²„ì—ì„œ ë°˜í™˜ëœ JSON ë°ì´í„° ì²˜ë¦¬ (ì˜ˆ: {"success": true, "message": "..."})
            if (data.success) { 
                alert("ìƒí’ˆì´ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
                window.location.href = "/goods/cart/list"; // ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ë¡œ ì´ë™
            } else {
                alert(data.message || "ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨!");
            }
        })
        .catch(error => {
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë‚˜ ìœ„ì—ì„œ throwëœ ì—ëŸ¬ ì²˜ë¦¬
            console.error('ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì—ëŸ¬:', error);
            alert("ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        });
    });
});
</script>
</body>
</html>