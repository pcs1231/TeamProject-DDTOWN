// =============================================================
//               apt-community.js 최종 버전
// =============================================================

// 전역 함수: 라이브 방송 시작
function startLive() {
    const mediaServerUrl = document.getElementById('mediaServerUrl').value;
    const artGroupNo = document.getElementById('communityArtistGroupNo').value;
    const artGroupNm = document.getElementById('communityArtistGroupNm').value;
    const streamInfoBtn = document.getElementById('stream-info');
    
    if (!streamInfoBtn) {
        alert("방송 시작 버튼 정보를 찾을 수 없습니다.");
        return;
    }
    const currentUserId = streamInfoBtn.dataset.userId; 

    if (!currentUserId) {
        alert("로그인이 필요합니다.");
        return;
    }
    
    const encodedArtGroupNm = encodeURIComponent(artGroupNm);
    
    if (!mediaServerUrl || !artGroupNo) {
        alert("방송 정보를 불러올 수 없습니다. 페이지를 새로고침 해주세요.");
        return;
    }
    
    const broadcastURL = `${mediaServerUrl}/broadcast/new?artGroupNo=${artGroupNo}&userId=${currentUserId}&artGroupNm=${encodedArtGroupNm}`;
    console.log("새 창으로 여는 URL:", broadcastURL);
    window.open(broadcastURL, 'broadcastWindow', 'width=1920,height=1080');
}

// 전역 함수: 라이브 방송 시청
function watchLive() {
    const mediaServerUrl = document.getElementById('mediaServerUrl').value;
    const artGroupNo = document.getElementById('communityArtistGroupNo').value;
    
	// 미디어 서버의 '검색 후 리다이렉트' URL을 호출
	const watchURL = `${mediaServerUrl}/broadcast/live/${artGroupNo}`;
	
    console.log("새 창으로 여는 URL:", watchURL);
    window.open(watchURL, 'watchWindow', 'width=1920,height=1080');
}