<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸ ìƒì„¸ ì •ë³´ - DDTOWN ê´€ë¦¬ì ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <%@ include file="../../../modules/headerPart.jsp" %>
    <style>
        .card-section {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            padding: 28px 28px 18px 28px;
            margin-bottom: 28px;
            border: 1px solid #e7eaf3;
        }
        .section-title {
            font-size: 1.25em;
            color: #2c3e50;
            margin-bottom: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px 32px;
            margin-bottom: 0;
        }
        .info-item {
            background: #f8f9fa;
            border-radius: 7px;
            padding: 16px 18px 10px 18px;
            display: flex;
            flex-direction: column;
            min-width: 0;
            border: 1px solid #e0e0e0;
        }
        .info-item dt {
            font-weight: 600;
            color: #555;
            margin-bottom: 4px;
            font-size: 0.98em;
        }
        .info-item dd {
            margin: 0;
            color: #222;
            font-size: 1.08em;
            word-break: break-all;
        }
        .info-item[style*="grid-column"] {
            grid-column: 1 / -1 !important;
        }
        .ordered-items-table {
            margin: 18px 0 18px 0;
        }
        .order-totals {
            margin-top: 18px;
            padding: 18px 30px;;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 7px;
            max-width: 320px;
            margin-left: auto;
        }
        .order-totals dl {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 0;
        }
        .order-totals dt, .order-totals dd {
            display: inline-block;
            font-size: 1.08em;
            margin: 0;
        }
        .order-totals dt {
            color: #444;
            font-weight: 600;
            width: 140px;
            text-align: left;
        }
        .order-totals dd {
            color: #222;
            text-align: right;
            width: 120px;
            font-weight: 500;
        }
        .order-totals .grand-total dt, .order-totals .grand-total dd {
            font-size: 1.18em;
            font-weight: bold;
            color: #e74c3c;
        }
        .order-totals .grand-total {
            margin-top: 10px;
            border-top: 1.5px solid #e0e0e0;
            padding-top: 10px;
        }
        .admin-memo-section {
            background: #f8f9fa;
            border-radius: 7px;
            border: 1px solid #e0e0e0;
            padding: 18px 18px 10px 18px;
            margin-bottom: 0;
        }
        .admin-memo-section textarea {
            background: #fff;
            border-radius: 5px;
            border: 1px solid #ced4da;
            min-height: 80px;
            font-size: 1em;
            padding: 10px;
        }
        .detail-actions {
            margin-top: 32px;
            text-align: right;
        }
        @media (max-width: 900px) {
            .info-grid { grid-template-columns: 1fr; }
            .order-totals { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../../modules/aside.jsp" %>
            <main class="emp-content">
                <section class="ea-section">
                    <div class="order-detail-container">
                        <div class="ea-section-header" style="margin-bottom:10px; padding-bottom:10px;">
                            <h2 id="orderDetailTitle">ì£¼ë¬¸ ìƒì„¸ ì •ë³´ (ì£¼ë¬¸ë²ˆí˜¸: <span id="orderIdTitle">${order.orderNo}</span>)</h2>
                            <div class="ea-header-actions">
                                <button id="saveOrderChangesBtn" class="ea-btn primary"><i class="fas fa-save"></i> ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                            </div>
                        </div>
                        <div class="card-section">
                            <div class="section-title"><i class="fas fa-receipt"></i> ì£¼ë¬¸ ê¸°ë³¸ ì •ë³´</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <dt>ì£¼ë¬¸ë²ˆí˜¸</dt>
                                    <dd id="orderIdDisplay">${order.orderNo}</dd>
                                </div>
                                <div class="info-item">
                                    <dt>ì£¼ë¬¸ì¼ì‹œ</dt>
                                    <dd id="orderDateDisplay"><fmt:formatDate value="${order.orderDate}" pattern="yyyy-MM-dd HH:mm:ss"/></dd>
                                </div>
                                <div class="info-item">
                                    <dt>ê²°ì œìƒíƒœ</dt>
                                    <%-- KAKAO_PAYMENT_APIì˜ PAYMENT_STAT_CODEë¥¼ ì‚¬ìš© (ì˜ˆ: SUCCESS, FAILED, CANCELED) --%>
                                    <dd id="paymentStatusDisplay">${order.paymentVO.paymentStatCode}</dd>
                                </div>
                                <div class="info-item">
								    <dt>ì£¼ë¬¸ìƒíƒœ</dt>
								    <dd>
								        <select id="overallOrderStatus" name="overallOrderStatus">
								            <option value="OSC001" ${order.orderStatCode eq 'OSC001' ? 'selected' : ''}>ê²°ì œ ì™„ë£Œ</option>
								            <option value="OSC002" ${order.orderStatCode eq 'OSC002' ? 'selected' : ''}>ê²°ì œ ì‹¤íŒ¨</option>
								            <option value="OSC003" ${order.orderStatCode eq 'OSC003' ? 'selected' : ''}>ìƒí’ˆ ì¤€ë¹„ì¤‘</option>
								            <option value="OSC004" ${order.orderStatCode eq 'OSC004' ? 'selected' : ''}>ë°°ì†¡ ì¤‘</option>
								            <option value="OSC005" ${order.orderStatCode eq 'OSC005' ? 'selected' : ''}>ë°°ì†¡ì™„ë£Œ</option>
								            <option value="OSC006" ${order.orderStatCode eq 'OSC006' ? 'selected' : ''}>ì·¨ì†Œ ìš”ì²­</option>
								            <option value="OSC007" ${order.orderStatCode eq 'OSC007' ? 'selected' : ''}>ì·¨ì†Œ ì²˜ë¦¬ì¤‘</option>
								            <option value="OSC008" ${order.orderStatCode eq 'OSC008' ? 'selected' : ''}>ì·¨ì†Œ ì™„ë£Œ</option> </select>
								    </dd>
								</div>
                                <div class="info-item">
                                    <dt>ê²°ì œìˆ˜ë‹¨</dt>
                                    <%-- OrdersVOì˜ orderPayMethodNm í•„ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                                         ì´ í•„ë“œì— 'KAKAO_PAY', 'BANK_TRANSFER' ê°™ì€ ì½”ë“œê°’ì´ ë“¤ì–´ì˜¨ë‹¤ë©´,
                                         ë³„ë„ì˜ ê³µí†µ ì½”ë“œ ë§¤í•‘ìœ¼ë¡œ í•œê¸€ëª…('ì¹´ì¹´ì˜¤í˜ì´', 'ë¬´í†µì¥ì…ê¸ˆ')ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. --%>
                                    <dd id="paymentMethodDisplay">${order.orderPayMethodNm}</dd>
                                </div>
                                <div class="info-item">
								    <dt>ê²°ì œì¼ì‹œ</dt>
								    <dd id="paymentDateDisplay">
								        <c:choose>
								            <%-- order.paymentVOì™€ completedAtì´ ëª¨ë‘ nullì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í¬ë§·íŒ… --%>
								            <c:when test="${order.paymentVO != null and order.paymentVO.completedAt != null}">
								                <fmt:formatDate value="${order.paymentVO.completedAt}" pattern="yyyy-MM-dd HH:mm:ss"/>
								            </c:when>
								            <c:otherwise>
								                ì •ë³´ ì—†ìŒ
								            </c:otherwise>
								        </c:choose>
								    </dd>
								</div>
                            </div>
                        </div>
                        <div class="card-section">
                            <div class="section-title"><i class="fas fa-user"></i> ì£¼ë¬¸ì ì •ë³´</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <dt>ì£¼ë¬¸ìëª…</dt>
                                    <dd id="customerNameDisplay">${order.customerName}</dd>
                                </div>
                                <div class="info-item">
                                    <dt>ì•„ì´ë””</dt>
                                    <dd id="customerIdDisplay">${order.customerId}</dd>
                                </div>
                                <%-- 'ì£¼ë¬¸ì ì—°ë½ì²˜'ëŠ” í˜„ì¬ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì œê±°í•©ë‹ˆë‹¤. 'ìˆ˜ë ¹ì¸ ì—°ë½ì²˜'ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. --%>
                                <%--
                                <div class="info-item">
                                    <dt>ì—°ë½ì²˜</dt>
                                    <dd id="customerPhoneDisplay">ë°ì´í„° ì—†ìŒ</dd>
                                </div>
                                --%>
                                <div class="info-item">
                                    <dt>ì´ë©”ì¼</dt>
                                    <dd id="customerEmailDisplay">${order.orderEmail}</dd>
                                </div>
                            </div>
                        </div>
                        <div class="card-section">
                            <div class="section-title"><i class="fas fa-truck"></i> ë°°ì†¡ ì •ë³´</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <dt>ìˆ˜ë ¹ì¸ëª…</dt>
                                    <dd id="recipientNameDisplay">${order.orderRecipientNm}</dd>
                                </div>
                                <div class="info-item">
                                    <dt>ìˆ˜ë ¹ì¸ ì—°ë½ì²˜</dt>
                                    <%-- OrdersVOì˜ orderRecipientPhone í•„ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. --%>
                                    <dd id="recipientPhoneDisplay">${order.orderRecipientPhone}</dd>
                                </div>
                                <div class="info-item" style="grid-column: 1 / -1;">
                                    <dt>ë°°ì†¡ì£¼ì†Œ</dt>
                                    <dd id="shippingAddressDisplay">(${order.orderZipCode}) ${order.orderAddress1} ${order.orderAddress2}</dd>
                                </div>
                                <div class="info-item" style="grid-column: 1 / -1;">
                                    <dt>ë°°ì†¡ë©”ëª¨</dt>
                                    <dd id="shippingMemoDisplay">${order.orderMemo}</dd>
                                </div>
                                <%-- 'ìš´ì†¡ì¥ë²ˆí˜¸'ëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê¸°ë¡œ í–ˆìœ¼ë¯€ë¡œ ì œê±°í•©ë‹ˆë‹¤. --%>
                                <%--
                                <div class="info-item">
                                    <dt>ìš´ì†¡ì¥ë²ˆí˜¸</dt>
                                    <dd id="trackingNumberDisplay">-</dd>
                                </div>
                                --%>
                            </div>
                        </div>
                        <div class="card-section">
                            <div class="section-title"><i class="fas fa-boxes"></i> ì£¼ë¬¸ ìƒí’ˆ ëª©ë¡</div>
                            <table class="ea-table ordered-items-table">
                                <thead>
                                    <tr>
                                        <th style="width:8%;">ì´ë¯¸ì§€</th>
                                        <th>ìƒí’ˆëª…/SKU</th>
                                        <th style="width:10%;">ì˜µì…˜</th>
                                        <th style="width:8%;">ìˆ˜ëŸ‰</th>
                                        <th style="width:10%;">íŒë§¤ê°€</th>
                                        <th style="width:10%;">í•©ê³„</th>
                                        <th style="width:12%;">ìƒí’ˆìƒíƒœ</th>
                                        <th style="width:15%;">ë¹„ê³ (ê´€ë¦¬ììš©)</th>
                                    </tr>
                                </thead>
                                <tbody id="orderedItemsTableBody">
                                    <c:choose>
                                        <c:when test="${not empty order.orderDetailList}">
                                            <c:forEach var="item" items="${order.orderDetailList}">
                                                <tr>
                                                    <td><img src="${item.representativeImageUrl}" alt="${item.goodsNm}" style="width:50px; height:50px; object-fit:cover;"></td>
                                                    <td>${item.goodsNm}</td>
                                                    <td>${item.goodsOptNm}</td>
                                                    <td>${item.orderDetQty}</td>
                                                    <td><fmt:formatNumber value="${item.goodsPrice + item.goodsOptPrice}" pattern="#,###ì›"/></td>
                                                    <td><fmt:formatNumber value="${(item.goodsPrice + item.goodsOptPrice) * item.orderDetQty}" pattern="#,###ì›"/></td>
                                                    <%-- OrderDetailVOì— ìƒí’ˆ ìƒíƒœ í•„ë“œê°€ ìˆë‹¤ë©´ ì‚¬ìš©. ì—†ë‹¤ë©´ 'ìƒí’ˆìƒíƒœ' ê³ ì • í…ìŠ¤íŠ¸ ìœ ì§€ --%>
                                                    <td>${item.goodsStatusKorName}</td>
                                                    <%-- OrderDetailVOì— ë¹„ê³  í•„ë“œê°€ ìˆë‹¤ë©´ ì‚¬ìš©. ì—†ë‹¤ë©´ '-' ê³ ì • í…ìŠ¤íŠ¸ ìœ ì§€ --%>
                                                    <td>-</td>
                                                </tr>
                                            </c:forEach>
                                        </c:when>
                                        <c:otherwise>
                                            <tr>
                                                <td colspan="8" class="text-center">ì£¼ë¬¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
                                            </tr>
                                        </c:otherwise>
                                    </c:choose>
                                </tbody>
                            </table>
						<div class="order-totals">
						    <dl>
						        <div style="display:flex;justify-content:space-between;align-items:center;">
								    <dt>ì´ ìƒí’ˆê¸ˆì•¡:</dt><dd id="itemsSubtotal"><fmt:formatNumber value="${order.totalGoodsPrice}" pattern="#,###ì›"/></dd>
								</div>
								<div style="display:flex;justify-content:space-between;align-items:center;">
								    <dt>ë°°ì†¡ë¹„:</dt><dd id="shippingFee"><fmt:formatNumber value="${order.actualShippingFee}" pattern="#,###ì›"/></dd>
								</div>
								<div class="grand-total" style="display:flex;justify-content:space-between;align-items:center;">
								    <dt>ìµœì¢… ê²°ì œê¸ˆì•¡:</dt>
								    <dd class="grand-total" id="grandTotal">
								        <c:choose>
								            <c:when test="${order.orderStatCode eq 'OSC008'}">
								                <fmt:formatNumber value="${order.refundedAmount}" pattern="#,###ì›"/> (í™˜ë¶ˆ ì™„ë£Œ)
								            </c:when>
								            <c:otherwise>
								                <fmt:formatNumber value="${order.orderTotalPrice}" pattern="#,###ì›"/>
								            </c:otherwise>
								        </c:choose>
								    </dd>
								</div>
						    </dl>
						</div>
                        </div>
                        <div class="card-section">
                            <div class="section-title"><i class="fas fa-sticky-note"></i> ê´€ë¦¬ì ì£¼ë¬¸ ë©”ëª¨</div>
                            <div class="admin-memo-section form-group">
                                <textarea id="orderMemo" name="orderMemo" placeholder="ì´ ì£¼ë¬¸ì— ëŒ€í•œ ë‚´ë¶€ ê´€ë¦¬ìš© ë©”ëª¨ë¥¼ ë‚¨ê¸°ì„¸ìš”...">${order.orderMemo}</textarea>
                            </div>
                        </div>
                        <div class="detail-actions">
                            <button id="saveOrderChangesBtn2" class="ea-btn primary"><i class="fas fa-save"></i> ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                            <%-- 'ëª©ë¡ìœ¼ë¡œ' ë²„íŠ¼ì— ì´ì „ ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ìœ ì§€ --%>
                            <a href="/admin/goods/orders/list?currentPage=${currentPage}&orderDateStart=${orderDateStart}&orderDateEnd=${orderDateEnd}&orderStatusFilter=${orderStatusFilter}&orderSearchInput=${orderSearchInput}" class="ea-btn">ëª©ë¡ìœ¼ë¡œ</a>
                            
                            <button id="cancelOrderBtn" class="ea-btn danger"><i class="fas fa-times-circle"></i> ì£¼ë¬¸ ì·¨ì†Œ</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
<%@ include file="../../../modules/footerPart.jsp" %>

<%@ include file="../../../modules/sidebar.jsp" %>    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const orderNo = document.getElementById('orderIdDisplay').innerText;
        const overallOrderStatusSelect = document.getElementById('overallOrderStatus');
        const adminOrderMemoTextarea = document.getElementById('orderMemo');
        const saveButtons = document.querySelectorAll('#saveOrderChangesBtn, #saveOrderChangesBtn2');
        const cancelOrderBtn = document.getElementById('cancelOrderBtn');

        // ë³€ê²½ì‚¬í•­ ì €ì¥ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        saveButtons.forEach(button => {
            button.addEventListener('click', function() {
                const updatedOrderStatus = overallOrderStatusSelect.value;
                const updatedAdminMemo = adminOrderMemoTextarea.value;

                const data = {
                	orderNo: orderNo,
                    orderStatCode: updatedOrderStatus,
                    // orderMemoëŠ” OrdersVO í•„ë“œì…ë‹ˆë‹¤.
                    // ì›ë˜ OrderVOì˜ orderMemoë¥¼ ê´€ë¦¬ì ë©”ëª¨ë¡œ ì‚¬ìš©í•œë‹¤ë©´ ì´ í•„ë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    orderMemo: updatedAdminMemo 
                };

                // CSRF í† í°ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì‚¬ìš© ì‹œ í•„ìš”)
                function getCsrfToken() {
                    const meta = document.querySelector('meta[name="_csrf"]');
                    return meta ? meta.content : null;
                }
                function getCsrfHeader() {
                    const meta = document.querySelector('meta[name="_csrf_header"]');
                    return meta ? meta.content : null;
                }

                const csrfToken = getCsrfToken();
                const csrfHeader = getCsrfHeader();

                fetch('/admin/goods/orders/update', { // ì£¼ë¬¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸
                    method: 'PUT', // ë˜ëŠ” 'POST'
                    headers: {
                        'Content-Type': 'application/json',
                        <c:if test="${not empty _csrf.headerName}">
                        '${_csrf.headerName}': '${_csrf.token}' // Spring Security CSRF í† í°
                        </c:if>
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        // HTTP ìƒíƒœ ì½”ë“œê°€ 2xxê°€ ì•„ë‹Œ ê²½ìš°
                        return response.json().then(errorData => {
                            throw new Error(errorData.message || 'ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');
                        });
                    }
                    return response.json(); // ì„±ê³µ ì‘ë‹µì€ JSONìœ¼ë¡œ ê°€ì •
                })
                .then(result => {
                    if (result.status === 'OK') {
                        alert('ì£¼ë¬¸ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // í•„ìš”í•œ ê²½ìš° UI ì—…ë°ì´íŠ¸ (ì˜ˆ: ê²°ì œ ìƒíƒœ ë“±)
                        // location.reload(); // ì „ì²´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì„ íƒ ì‚¬í•­, ë¹„ë™ê¸° ì¥ì  í¬ì„)
                    } else {
                        alert('ì €ì¥ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ì£¼ë¬¸ ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            });
        });

        // ì£¼ë¬¸ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        cancelOrderBtn.addEventListener('click', function() {
            if (!confirm('ì •ë§ë¡œ ì´ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì·¨ì†Œëœ ì£¼ë¬¸ì€ ë³µêµ¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.')) {
                return;
            }

            // CSRF í† í° ê°€ì ¸ì˜¤ê¸° (Spring Security ì‚¬ìš© ì‹œ)
            function getCsrfToken() {
                const meta = document.querySelector('meta[name="_csrf"]');
                return meta ? meta.content : null;
            }
            function getCsrfHeader() {
                const meta = document.querySelector('meta[name="_csrf_header"]');
                return meta ? meta.content : null;
            }

            const csrfToken = getCsrfToken();
            const csrfHeader = getCsrfHeader();

            fetch('/admin/goods/orders/cancel/' + orderNo, { // ì£¼ë¬¸ ì·¨ì†Œë¥¼ ìœ„í•œ ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸
                method: 'PUT', // ì·¨ì†ŒëŠ” 'PUT' ë˜ëŠ” 'POST' ì‚¬ìš© (ìƒíƒœ ë³€ê²½ì´ë¯€ë¡œ PUT ê¶Œì¥)
                headers: {
                    'Content-Type': 'application/json',
                    <c:if test="${not empty _csrf.headerName}">
                    '${_csrf.headerName}': '${_csrf.token}' // Spring Security CSRF í† í°
                    </c:if>
                },
            })
			.then(response => {
			    if (!response.ok) {
			        // ì„œë²„ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³´ë‚¸ë‹¤ë©´, text()ë¥¼ ì‚¬ìš©
			        return response.text().then(errorMessage => { 
			            throw new Error(errorMessage || 'ì„œë²„ ì˜¤ë¥˜ ë°œìƒ');
			        });
			    }
			    // ì»¨íŠ¸ë¡¤ëŸ¬ê°€ "SUCCESS" ë˜ëŠ” "FAILED" ë¬¸ìì—´ì„ ë°˜í™˜í•˜ë¯€ë¡œ text() ì‚¬ìš©
			    return response.text();
			})
			.then(result => {
			    // resultê°€ ì´ì œ "SUCCESS" ë˜ëŠ” "FAILED" ë¬¸ìì—´ì´ ë©ë‹ˆë‹¤.
			    if (result === 'SUCCESS') { // 'OK' ìƒíƒœê°€ ì•„ë‹Œ 'SUCCESS' ë¬¸ìì—´ê³¼ ë¹„êµ
		            alert('ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
		            // ğŸš¨ğŸš¨ğŸš¨ ì´ ë¶€ë¶„ì„ CSC003ìœ¼ë¡œ ë³€ê²½!
		            overallOrderStatusSelect.value = 'OSC008';
		            // ìƒíƒœ ë³€ê²½ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìµœì‹  ë°ì´í„° ë°˜ì˜
		            location.reload();
			    } else { // 'FAILED' ë¬¸ìì—´ì´ê±°ë‚˜ ê·¸ ì™¸
			        alert('ì£¼ë¬¸ ì·¨ì†Œ ì‹¤íŒ¨: ' + (result || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
			    }
			})
            .catch(error => {
                console.error('Error cancelling order:', error);
                alert('ì£¼ë¬¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        });
    });
    </script>
</body>
</html>