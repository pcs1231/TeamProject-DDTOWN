<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 전자결재 - 받은 결재/참조 문서함</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/approval_draft_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>
<body>
	<div class="emp-container">
		<%@ include file="../modules/header.jsp" %>

		<div class="emp-body-wrapper">
			<%@ include file="../modules/aside.jsp" %>

			<main class="emp-content">
				<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
					<ol class="breadcrumb">
					  <li class="breadcrumb-item"><a href="#" style="color:black;">전자결재</a></li>
					  <li class="breadcrumb-item active" aria-current="page">받은 결재/참조 문서함</li>
					</ol>
				</nav>
				<section class="ea-section">

					<div class="ea-section-header">
						<h2>받은 결재/참조 문서함</h2>

						<div class="approval-list-search-row ea-header-actions" style="display:flex; gap:8px; justify-content: flex-end; align-items: center; margin-bottom:18px;">
							<form id="searchForm">
								<input type="hidden" name="currentPage" id="currentPage" value="${pagingVO.currentPage}">
								<select id="searchType" name="searchType" class="approval-search-input" style="height:40px; border-radius:5px; border:1px solid #ccc; font-size:1em;">
									<option value="title" <c:if test="${pagingVO.searchType eq 'title'}">selected</c:if>>제목</option>
									<option value="approval"<c:if test="${pagingVO.searchType eq 'approval'}">selected</c:if>>기안자</option>
								</select>
								<input type="text" id="searchWord" name="searchWord" value="${pagingVO.searchWord}" class="approval-search-input" placeholder="검색 (제목, 작성자...)" style="width:220px; height:40px; border-radius:5px; border:1px solid #ccc; padding:0 12px; font-size:1em;">
								<button type="submit" id="approval-search-btn" class="ea-btn primary" style="height:36px; min-width:70px;"><i class="fas fa-search"></i> 검색</button>
							</form>
						</div>
					</div>

					<div class="approval-list-table-wrap">
						<table class="approval-list-table">
							<thead>
								<tr>
									<th width="15%">번호</th>
									<th width="10%">중요</th>
									<th width="10%">결재상태</th>
									<th width="25%">제목</th>
									<th>기안자</th>
									<th>기안일</th>
								</tr>
							</thead>
							<tbody id="approval-list-tbody">
								<c:choose>
									<c:when test="${pagingVO.dataList ne null and pagingVO.dataList[0].edmsNo ne 0 }">
										<c:forEach items="${pagingVO.dataList}" var="approval">
											<tr>
												<td>${approval.edmsManageNo}</td>
												<td>
													<c:if test="${approval.edmsUrgenYn eq 'Y'}">
														<span style="color:#b71c1c;">긴급</span>
													</c:if>
													<c:if test="${approval.edmsUrgenYn eq 'N'}">
														<span >일반</span>
													</c:if>

												</td>
												<td>
												<c:if test="${approval.edmsStatCode eq 'ESC001'}">
													<span style="background:#818681;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">대기</span>
												</c:if>
												<c:if test="${approval.edmsStatCode eq 'ESC002'}">
													<span style="background:#4caf50;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">진행</span>
												</c:if>
												<c:if test="${approval.edmsStatCode eq 'ESC003'}">
													<span style="background:#007bff;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">승인</span>
												</c:if>
												<c:if test="${approval.edmsStatCode eq 'ESC004'}">
													<span style="background:#b71c1c;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">반려</span>
												</c:if>
												<c:if test="${approval.edmsStatCode eq 'ESC005'}">
													<span style="background:#ec841a;color:#fff;padding:4px 12px;border-radius:16px;font-size:0.97em;">회수</span>
												</c:if>
												</td>
												<td style="text-align: left"><a href="" style="color:#007bff; text-decoration: none;" data-edms-stat-code="${approval.edmsStatCode}" data-edms-no="${approval.edmsNo}"> ${approval.edmsTitle}</a></td>
												<td>${approval.empName}</td>
												<td><fmt:formatDate value="${approval.edmsReqDate}" pattern="yyyy/MM/dd" type="date" /> </td>
											</tr>
										</c:forEach>
									</c:when>
									<c:otherwise>
										<tr><td colspan="6" style="text-align:center;">검색 결과가 없습니다.</td></tr>
									</c:otherwise>
								</c:choose>
							</tbody>
						</table>
						<div class="approval-pagination" id="pagingArea">
							${pagingVO.pagingHTML }
						</div>
					</div>
				</section>
			</main>
		</div>
	</div>
</body>
<%@ include file="../../modules/footerPart.jsp" %>

<%@ include file="../../modules/sidebar.jsp" %>
<script>
$(function(){
	const currentPageEl =  $("#currentPage"); // 현재 페이지 번호
	const searchTypeEl = $("#searchType"); // 정렬 실렉트박스
	const searchWordEl = $("#searchWord"); // 검색어

	// 검색결과 유지한채 상세정보 이동
	let approvalListTbody = $("#approval-list-tbody");
	approvalListTbody.on("click","a",function(e){
		e.preventDefault();
		const edmsNo = $(this).data("edmsNo");
		const edmsStatCode = $(this).data("edmsStatCode");
		let searchWord = "${pagingVO.searchWord}";
		let searchType = "${pagingVO.searchType}";
		let currentPage = "${pagingVO.currentPage}";

		sessionStorage.setItem("baseurl",window.location.pathname);
		sessionStorage.setItem("currentPage",currentPage);
		sessionStorage.setItem("searchWord",searchWord);
		sessionStorage.setItem("searchType",searchType);

		if(edmsStatCode == 'ESC005'){
			location.href="${pageContext.request.contextPath}/emp/edms/update?edmsNo="+edmsNo;
		}else{
			location.href="${pageContext.request.contextPath}/emp/edms/detail?edmsNo="+edmsNo;
		}
	})

	// 페이지 a누르면 이동
	const approvalPagination = $("#approval-pagination");
	const searchForm = $("#searchForm");

	approvalPagination.on("click","a",function(){
		const page = $(this).data("page");
		$("#currentPage").val(page);
		$("#searchWord").val("${pagingVO.searchWord}");
		$("#searchType").val("${pagingVO.searchType}");
		searchForm.submit();
	})

	// 검색입력창 클릭시 입력값 초기화
	$("#searchWord").on("click",function(){
		if($("#searchWord").val() != null && $("#searchWord").val() != ""){
			$("#searchWord").val("");
		}
	})


})
    </script>
</html>