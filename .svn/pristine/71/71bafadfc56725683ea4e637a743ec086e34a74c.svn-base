<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 관리자 - 아티스트 계정 관리</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/artistDetail.css">
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/artist.css">
    <style>
        /* admin_portal.css에 정의된 스타일을 최대한 활용합니다. */
        /* 아티스트명 링크 스타일 */
        .artist-name-link {
            font-weight: 500;
            color: #007bff; /* 기본 링크 색상 */
            text-decoration: none;
        }
        .artist-name-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>

        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>

            <main class="emp-content">
                <section class="ea-section">
                    <div class="ea-section-header">
                        <h2 id="groupDetailNameTitle">그룹 상세 정보</h2>
                        <div class="ea-header-actions">
                            <a href="/admin/community/group/update?artGroupNo=${artistGroupVO.artGroupNo }" class="ea-btn outline sm" id="editGroupBtn"><i class="fas fa-edit"></i> 정보 수정</a>
                            <form action="/admin/community/group/delete" method="post" id="deleteForm">
                            	<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }">
                            	<sec:csrfInput/>
	                            <button type="button" class="ea-btn danger sm" id="deleteGroupBtn"><i class="fas fa-trash-alt"></i>정보 삭제</button>                            	
                            </form>
                            <button type="button" class="ea-btn primary sm" id="listBtn"><i class="fas fa-list"></i> 목록으로</button>
                        </div>
                    </div>
                    <div class="group-detail-profile">
                        <img src="${artistGroupVO.artGroupProfileImg }" alt="그룹 프로필 이미지" class="profile-image" id="detailGroupProfileImage">
                        <div class="profile-info">
                            <h2 id="detailGroupDisplayName"></h2>
                            <p class="group-id-display">그룹명: <span id="detailGroupSystemId">${artistGroupVO.artGroupNm }</span></p>
                            <p>데뷔일: <span id="detailGroupDebutDate">${artistGroupVO.artGroupDebutdate }</span></p>
                            <p class="manager-display">담당자: <span id="detailGroupManager">${artistGroupVO.empName }(${artistGroupVO.empUsername})</span></p>
                        </div>
                    </div>
                    <div class="detail-card">
                        <h3>그룹 멤버</h3>
                        <div class="member-list" id="groupMemberList">
                        	<div class="artist-grid" style="grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));">
	                            <c:forEach items="${artistGroupVO.artistList }" var="artist">
	                                <div class="artist-item" data-name="${artist.artNm}" data-img="${artist.artProfileImg}">
	                                    <p class="artist-name">${artist.artNm }</p>
	                                </div>
	                            </c:forEach>
                        	</div>
                        </div>
                    </div>
                    <div class="detail-card">
                        <h3>앨범 목록</h3>
                        <div class="album-list" id="groupAlbumList">
			        <div class="album-list">
			            <c:forEach var="album" items="${artistGroupVO.albumList}">
			                <article class="album-item">
			                    <div class="album-cover">
			                        <img src="${album.albumImg}" alt="${album.albumNm} 커버" style="width:350px; height:auto;"/>
			                    </div>
			                    <div class="album-details">
			                        <h3 class="album-title">${album.albumNm}</h3>
			                        <p class="album-release-date">
			                            <strong>발매일:</strong> 
			                            <fmt:formatDate value="${album.albumRegDate}" pattern="yyyy년 MM월 dd일" />
			                        </p>
			                        <p class="album-description">${album.albumDetail}</p>
			                        
			                        <p><strong>타이틀 곡:</strong> 
			                            <c:choose>
			                                <c:when test="${not empty album.titleSong}">
			                                    ${album.titleSong}
			                                </c:when>
			                                <c:otherwise>
			                                    (타이틀 곡 정보 없음)
			                                </c:otherwise>
			                            </c:choose>
			                        </p>
			
			                        <h4>수록곡 전체:</h4>
			                        <ul class="track-list-table">
			                            <c:forEach var="song" items="${album.albumSongs}">
			                                <li>
			                                    ${song.songNm}
			                                    <c:if test="${'Y' eq song.songTitleYn}">
			                                        <span class="track-title-badge">(타이틀)</span>
			                                    </c:if>
			                                </li>
			                            </c:forEach>
			                        </ul>
			                    </div>
			                </article>
			                <hr/>
			            </c:forEach>
			        </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <footer class="emp-footer">
            <p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (관리자 전용)</p>
        </footer>
    </div>
</body>
<%@ include file="../../modules/footerPart.jsp" %>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
	const navItemsWithSubmenu = document.querySelectorAll('.emp-sidebar .emp-nav-item.has-submenu');
	navItemsWithSubmenu.forEach(item => {
		const arrow = item.querySelector('.submenu-arrow');
		item.addEventListener('click', function(event) {
			if (this.getAttribute('href') === '#') {
			    event.preventDefault();
			}
			const parentLi = this.parentElement;
			const submenu = this.nextElementSibling;
		
			if (submenu && submenu.classList.contains('emp-submenu')) {
				const parentUl = parentLi.parentElement;
				if (parentUl) {
					Array.from(parentUl.children).forEach(siblingLi => {
						if (siblingLi !== parentLi) {
							const siblingSubmenuControl = siblingLi.querySelector('.emp-nav-item.has-submenu.open');
							if (siblingSubmenuControl) {
								const siblingSubmenu = siblingSubmenuControl.nextElementSibling;
								siblingSubmenuControl.classList.remove('open');
								if (siblingSubmenu && siblingSubmenu.classList.contains('emp-submenu')) {
								    siblingSubmenu.style.display = 'none';
								}
								const siblingArrow = siblingSubmenuControl.querySelector('.submenu-arrow');
								if (siblingArrow) siblingArrow.style.transform = 'rotate(0deg)';
							}
						}
					});
				}
			}
		
			this.classList.toggle('open');
			if (submenu && submenu.classList.contains('emp-submenu')) {
				submenu.style.display = this.classList.contains('open') ? 'block' : 'none';
				if (arrow) arrow.style.transform = this.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
			}
		});
	});
	
	const listBtn = document.getElementById("listBtn");
	listBtn.addEventListener("click",function(){
		let searchWord = sessionStorage.getItem("searchWord");
		let currentPage = sessionStorage.getItem("currentPage");
		sessionStorage.removeItem("searchWord");
		sessionStorage.removeItem("currentPage");
		
		location.href="/admin/community/group/list?currentPage=" + currentPage + "&searchWord=" + searchWord; 
	})
	
	const deleteGroupBtn = document.getElementById("deleteGroupBtn");
	const deleteForm = document.getElementById("deleteForm");
	deleteGroupBtn.addEventListener("click",function(){
		Swal.fire({
			   title: '정말로 삭제 처리 하시겠습니까?',
			   text: '다시 되돌릴 수 없습니다. 신중하세요.',
			   icon: 'warning',
			   
			   showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
			   confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
			   cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
			   confirmButtonText: '삭제', // confirm 버튼 텍스트 지정
			   cancelButtonText: '취소', // cancel 버튼 텍스트 지정
			   
			}).then(result => {
			   // 만약 Promise리턴을 받으면,
			    if(result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면
					sweetAlert('success',"처리 완료");
					deleteForm.submit();	
			   		
			    }
			});
	})
});
</script>
</html>