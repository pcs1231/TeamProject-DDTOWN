<!-- 포스트 상세 모달 -->
<div class="modal fade " id="detailPostModal" tabindex="-1" aria-labelledby="detailPostModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="detailPostModalLabel">

				</h1>
				<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';">
					<img id="modalImg" src="${post.writerProfile.comuProfileImg }">
				</div>
				<div id="modalNick"></div>
				<span class="post-time" id="modalTime"></span>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form id="detailPostForm" enctype="multipart/form-data" method="post">
					<div id="detailImgArea"></div>
					<div>내용</div>
					<textarea rows="5" cols="10" id="detailComuPostContent"
						 name="comuPostContent" onchange="contentLengthCheck(this)" readonly="readonly"></textarea>
				</form>
			</div>
			<div class="reply modal-body">
				<div class="replyArea" id="replyArea">
					<div class="replyList" id="replyList">
					</div>
					<div class="comment-form-container">
						<form action="/community/reply/insert" method="get" id="replyForm">
							<input type="hidden" id="boardTypeCode" name="boardTypeCode" />
							<input type="hidden" id="comuPostNo" name="comuPostNo" />
							<input type="hidden" id="artGroupNo" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
			        		<textarea id="comuReplyContent" class="comment-textarea" placeholder="댓글을 남겨보세요..." onkeyup="replyContentLengthCheck(this)" name="comuReplyContent"></textarea>
			 				<button class="btn-submit-comment" id="replyBtn">등록</button>
						</form>
		        	</div>
	        		<div class="text-right pt-2">
						<span class="pt-1"><span class="cmt-sub-size">0</span>/300</span>
					</div>
	        	</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="likeBtn"><i class="bi bi-suit-heart"></i><span id="likeCount"></span></button>
			</div>
		</div>
	</div>
</div>

<<script type="text/javascript">
let artGroupNo = $("#communityArtistGroupNo").val();

let data = new FormData();
data.append("artGroupNo",artGroupNo);
data.append("comuPostNo",postNum )

$.ajax({
	url : "/community/post/detail/" + postNum,
	type : "get",
	data : {
		"artGroupNo" : artGroupNo,
		"comuPostNo" : postNum
	},
	success : function(res){
		console.log("요청 : ", res);
		/* 작성자 정보 */
		let writer =res.writerProfile;
		let writerImg = writer.comuProfileImg;
		let writerNick = writer.comuNicknm;

		/* 게시판 정보 */
		let content = res.comuPostContent;
		let file = res.postFiles;
		let boardTypeCode = res.boardTypeCode;
		let comuPostNo = res.comuPostNo;

		let likeIcon = $("#likeBtn").children('i');
		let likeYn = res.likeYn;
		let likeClass;
		if(likeYn == 'Y'){
			likeClass = "bi bi-suit-heart-fill";
		}else{
			likeClass = "bi bi-suit-heart";
		}
		likeIcon.attr("class",likeClass);

		let regDate = res.comuPostRegDate;
		let modDate = res.comuPostModDate;

		let date;
		if(regDate === modDate){
			date = dateFormat(regDate);
		}else{
			date = dateFormat(modDate) + "(수정됨)";
		}

		/* 카운트 한 거 */
		let likeCount = res.comuPostLike;

		$("#modalImg").attr("src",writerImg);
		$("#modalNick").html(writerNick);
		$("#modalTime").html(date);
		$("#boardTypeCode").val(boardTypeCode);
		$("#comuPostNo").val(comuPostNo)

		$("#detailComuPostContent").html(content);

		$("#likeCount").html(likeCount);

		/* 게시판 댓글 영역 */
		let reply = res.comuPostReplyList;

		let html = ``;
		if(reply != null && reply != ""){
			for(let i=0; i<reply.length; i++){
				let replyInfo = reply[i];
				let replyNo = replyInfo.comuReplyNo;
				let replyRegDate = replyInfo.comuReplyRegDate;
				let replyModDate = replyInfo.comuReplyModDate;
				let replyDate;
				if(replyRegDate === replyModDate){
					replyDate = dateFormat(replyRegDate);
				}else{
					replyDate = dateFormat(replyModDate) + "(수정됨)";
				}
				html += `
					<div class="reply">
						<div class="replyWriterInfo">
							<input type="hidden" id="replyNo" value="\${replyNo}" />
							<div class="replyWriterImg">
								<img src="\${replyInfo.replyMember.comuProfileImg}">
							</div>
							<div class="replyWriter">
								<span>\${replyInfo.replyMember.comuNicknm}</span>
								<span>\${replyDate}</span>
							</div>
							<div class="dropdown">
								<button type="button" class="btn btn-link text-secondary p-0" data-bs-toggle="dropdown" aria-expanded="false">
									<i class="bi bi-three-dots-vertical"></i>
								</button>
								<ul class="dropdown-menu">
							    	<li><a class="dropdown-item" href="#" id="replyUpdateBtn">수정</a></li>
							    	<li><a class="dropdown-item" href="#" id="replyDeleteBtn">삭제</a></li>
							    	<li><a class="dropdown-item" href="#">신고</a></li>
								</ul>
							</div>
						</div>
						<div class="replyContent">
							<span>\${replyInfo.comuReplyContent}</span>
						</div>
					</div>
				`;
			}
		}

		$("#replyList").append(html)

		/* 게시판 이미지 영역 */
		let imgHtml = ``;
		if(file != null && file != ""){
			for(let i=0; i<file.length; i++){
				let img = file[i];
				imgHtml += `
					<img src="\${img.webPath}" class="img-fluid" >
				`;
			}
		}
		$("#detailImgArea").append(imgHtml);
	},
	error : function(error){
		console.log(error.status);
	}
});
</script>
