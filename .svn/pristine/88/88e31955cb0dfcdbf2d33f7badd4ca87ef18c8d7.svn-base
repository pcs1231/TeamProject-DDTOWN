<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<%@ taglib uri="jakarta.tags.core" prefix="c" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APT</title>
<meta name="_csrf" content="${_csrf.token}"/>
<meta name="_csrf_header" content="${_csrf.headerName}"/>
<script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.17/index.global.min.js'></script>
<%@ include file="../../modules/headerPart.jsp" %>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/communityModal.css">

<style>

body{
	font-family: "Helvetica Neue", Arial, sans-serif;
    background-color: #f0f2f5;
    color: #1c1e21;
    line-height: 1.6;
}
.apt-main-layout {
    display: flex;
    max-width: 2000px;
    margin: 0 auto;
    gap: 20px;
    padding: 20px 15px;
    justify-content: center;
}
.membership-blur {
    filter: blur(5px);
    pointer-events: none;
}

.membership-only {
    position: relative;
}

.membership-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.membership-badge {
    background: #8a2be2;
    color: #fff;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.8em;
    margin-left: 5px;
}
div#imgArea {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}
.imgDiv{
	position: relative;
    width: 300px;
    /* height: auto; */
    border: 1px solid #ddd;
    padding: 10px;
    box-sizing: border-box;
}

.imgDiv img{
	width: 100%;
    height: auto;
    display: block;
}

.imgDiv i{
	position: absolute;
    top: -15%;
    right: 10%;
    color: white;
}
button#imgDeleteBtn {
    background-color: black;
    position: absolute;
    top: 15px;
    left: 260px;
    height: 20px;
    width: 10px;
    padding: 10px;
    border-radius: 50%;
    z-index: 10;
}

.replyWriterInfo {
    display: flex;
    align-items: center;
    gap: 10px;
}

/* í”„ë¡œí•„ ì´ë¯¸ì§€ ê´€ë ¨ CSS */
.artist-avatar-placeholder {
    /* 1. ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • */
    width: 60px; /* ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆí•˜ì„¸ìš” */
    height: 60px; /* widthì™€ ë™ì¼í•œ ê°’ìœ¼ë¡œ ì„¤ì • */
    position: relative; /* ìì‹ ìš”ì†Œì˜ ê¸°ì¤€ì ì´ ë¨ */

    /* 2. ì›í˜•ìœ¼ë¡œ ë§Œë“¤ê¸° */
    border-radius: 50%;

    /* 3. ë‚´ë¶€ ì´ë¯¸ì§€ê°€ ì›ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì„¤ì • */
    overflow: hidden;

    /* ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ê¸° ì „ì´ë‚˜ ì—†ì„ ë•Œë¥¼ ìœ„í•œ ë°°ê²½ìƒ‰ (ì„ íƒ ì‚¬í•­) */
    background-color: #f0f0f0;
}

.artist-avatar-placeholder img {
    /* 4. ì´ë¯¸ì§€ê°€ ì»¨í…Œì´ë„ˆë¥¼ ê½‰ ì±„ìš°ë„ë¡ ì„¤ì • */
    width: 100%;
    height: 100%;

    /* 5. ì´ë¯¸ì§€ ë¹„ìœ¨ì„ ìœ ì§€í•˜ë©´ì„œ ì˜ë¦¬ì§€ ì•Šë„ë¡ ì±„ìš°ê¸° (ê°€ì¥ ì¤‘ìš”í•œ ì†ì„±) */
    object-fit: cover;
}

.modal-header h2 {
    width: 100%; /* h2ê°€ modal-headerì˜ ì „ì²´ ë„ˆë¹„ë¥¼ ì°¨ì§€í•˜ë„ë¡ ê°•ì œí•˜ì—¬ pê°€ ë‹¤ìŒ ì¤„ë¡œ ë‚´ë ¤ê°€ê²Œ í•¨ */
    /* í•„ìš”ì— ë”°ë¼ ë§ˆì§„ ì¡°ì • */
    margin-bottom: 5px; /* h2ì™€ p ì‚¬ì´ ê°„ê²© ì¶”ê°€ */
}

.modal-header p.membership-duration {
	width: 100%;
    display: block; /* p íƒœê·¸ê°€ ìƒˆë¡œìš´ ì¤„ì—ì„œ ì‹œì‘í•˜ë„ë¡ í•¨ */
    margin-top: 5px; /* ì„ íƒ ì‚¬í•­: ì œëª©ê³¼ ê¸°ê°„ ì‚¬ì´ì— ì•½ê°„ì˜ ê°„ê²© ì¶”ê°€ */
}

.modal-header {
    flex-direction: column; /* Flex ì•„ì´í…œë“¤ì„ ìˆ˜ì§ ë°©í–¥ìœ¼ë¡œ ì •ë ¬ (h2, p ìˆœì„œëŒ€ë¡œ ì„¸ë¡œ ë°°ì¹˜) */
    align-items: center; /* ê°€ìš´ë° ì •ë ¬ */
    text-align: center; /* í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
}
.feed-item-header {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    border-bottom: 1px solid aliceblue;
    padding-bottom: 10px;
}
.postProfile {
	text-decoration : none;
    display: flex;
    align-items: center;
}
.feed-item:hover{
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ë” í¬ê³  ì§„í•œ ê·¸ë¦¼ì */
    transform: translateY(-5px); /* ì‚´ì§ ìœ„ë¡œ ë– ì˜¤ë¥´ëŠ” íš¨ê³¼ (ì„ íƒ ì‚¬í•­) */
}
.feed-item {
    background-color: #fff;
    border-radius: 8px;
    margin-bottom: 15px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    padding: 15px;
    transition: transform 0.3s ease;
}

div#openModal {
    border: 1px solid aliceblue;
    background-color: white;
    border-radius: 8px;
    margin-bottom: 10px;
    transition: 1s;
}

div#openModal:hover{
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-5px);
}

.artistPostInserBtn{
	width: 100%;
    justify-items: left;
}

.feed-item-actions {
    display: flex;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
    margin-top: 15px;
    align-items: baseline;
}
button#postListLike {
    color: #fd6083;
}
span#likeCount {
    margin-left: 5px;
    font-style: normal;
}

/* ë“±ë¡ ëª¨ë‹¬ ì…ë ¥textarea */
textarea#comuPostContent {
    width: 100%;
    height: 200px;
    border-radius: 8px;
    font-size: 15px;
    resize: none;
}
/* ë“±ë¡ëª¨ë‹¬ ë©¤ë²„ì‹­ ì—¬ë¶€ ë¼ë²¨ */
label.checkbox-label {
    border: 1px solid;
    width: 100px;
    height: 30px;
    align-content: center;
    text-align: center;
    border-radius: 15px;
    cursor: pointer;
    margin-bottom: 10px;
    transition: 0.8s;
}

label.checkbox-label:hover {
    box-shadow: 0px 0px 20px;
    transform: scale(1.1);
    background-color: #6a0dad;
    color: white;
}

.inserPostCheckbox input[type=checkbox]:checked + label.checkbox-label{
	background-color : #6a0dad;
	color: white;
}

.inserPostCheckbox {
    justify-items: center;
}
/* ë“±ë¡ëª¨ë‹¬ ë©¤ë²„ì‹­ ì—¬ë¶€ ë¼ë²¨ ë */

/* ë“±ë¡ ëª¨ë‹¬ íŒŒì¼ ì„ íƒ */
input#fileName {
    height: 40px;
    width: 530px;
    padding: 12px;
    cursor: initial;
}
label.file-label {
    border: 1px solid;
    border-radius: 8px;
    width: 80px;
    height: 40px;
    align-content: center;
    text-align: center;
    background-color: #bbdfff;
    cursor: pointer;
}
input#insertPostFile {
    display: none;
}
.file-wrap {
    display: flex;
    gap: 2px;
    margin-top: 30px;
    justify-content: right;
}
/* ë“±ë¡ ëª¨ë‹¬ íŒŒì¼ ì„ íƒ ë */

/* ìƒì„¸ ëª¨ë‹¬ ì´ë¯¸ì§€ */
.detailImgContainer {
    border-bottom: 1px solid aliceblue;
    padding-bottom: 20px;
    margin-bottom: 20px;
}
.detailImg {
    width: 800px;
    height: auto;
    margin-top: 10px;
}
.detailImg img{
	width : 100%;
	border-radius: 10px;
}
/* ìƒì„¸ ëª¨ë‹¬ ì´ë¯¸ì§€ ë */

textarea#editComuPostContent {
    width: 100%;
    height: 200px;
    border-radius: 8px;
    font-size: 15px;
    resize: none;
}

.notice-container {
	border: 1px solid aliceblue;
    height: 80px;
    padding-top: 10px;
    padding-left: 20px;
    margin-bottom: 10px;
    background-color: white;
    padding-right: 20px;
    border-radius: 10px;
    padding-bottom: 90px;
    transition: transform 0.3s ease;
}

.notice-container:hover{
	box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-5px);
}

.noticeTitle-container {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 20px;
    margin-bottom: 20px;
}

span.noticeTitle {
    color: black;
    font-size: 14px;
    max-width: 250pt;
}

.noticeDate {
    font-size: 12px;
    color: #7f9097;
}

@keyframes heartbeat{
	0% {transform: scale(1);}
	25% {transform: scale(1.2);}
	50% {transform: scale(1);}
	75% {transform: scale(1.2);}
	100% {transform: scale(1);}
}
.newNotice {
    animation: heartbeat 1s ease-in-out infinite;
    color: #ff0000ab;
}

.notice-container b {
    display: flex;
    gap: 5px;
}
/* ë“±ë¡ëœ ê²Œì‹œë¬¼ ì—†ì„ ë•Œ í‘œì‹œ */
.noSearchPostList {
    border: 1px solid aliceblue;
    background-color: white;
    background-color: #fff;
    border-radius: 8px;
    margin-bottom: 15px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    padding: 15px;
    transition: transform 0.3s ease;
    color: #ff0000ad;
}

.noSearchPostList:hover {
	box-shadow: 0px 4px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-2px);
}

.noticeList-container {
    margin-bottom: 10pt;
}

.carousel-item-title {
    max-width: 100%;
    border-bottom: 1px solid aliceblue;
    margin-bottom: 10pt;
    padding-bottom: 5pt;
    color: black;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    font-weight: 600;
}

.author-avatar {
    width: 50px; /* ì›í•˜ëŠ” í¬ê¸° */
    height: 50px; /* widthì™€ ë™ì¼í•˜ê²Œ ì„¤ì • */
    border-radius: 50%; /* ì›í˜•ìœ¼ë¡œ ë§Œë“¦ */
    overflow: hidden; /* ë„˜ì¹˜ëŠ” ë¶€ë¶„ ìˆ¨ê¹€ */
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    background-color: #8a2be2;
    color: #fff;
    display: flex; /* ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì— ë°°ì¹˜í•˜ê¸° ìœ„í•¨ */
    align-items: center;
    justify-content: center;
}

.author-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ì´ë¯¸ì§€ ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì±„ì›€ */
}

form#replyForm {
    gap: 10pt;
}

#calendar {
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; /* ê¸°ì¡´ ìœ ì§€ (í•œê¸€ í°íŠ¸ëŠ” body ë˜ëŠ” globalì— ì •ì˜ëœ ê²ƒì„ ë”°ë¦„) */
    background-color: #ffffff;
    border-radius: 8px; /* ë©¤ë²„ì‹­ ì¹´ë“œ, ì°¨íŠ¸ ë°•ìŠ¤ì™€ ìœ ì‚¬í•œ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    padding: 20px; /* ë‚´ë¶€ ì—¬ë°± */
    box-shadow: 0 2px 8px rgba(0,0,0,0.05); /* ë©¤ë²„ì‹­ ì¹´ë“œ, ì°¨íŠ¸ ë°•ìŠ¤ì™€ ìœ ì‚¬í•œ ê·¸ë¦¼ì */
}
/* FullCalendar íˆ´ë°” (í—¤ë”) ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.fc .fc-button-group > .fc-button {
    background-color: #f8f9fa; /* ë°ì€ íšŒìƒ‰ ë°°ê²½ */
    color: #495057; /* ì–´ë‘ìš´ íšŒìƒ‰ í…ìŠ¤íŠ¸ */
    border: 1px solid #ced4da; /* ì—°í•œ í…Œë‘ë¦¬ */
    border-radius: 4px; /* ì‚´ì§ ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    font-weight: 500;
    padding: 6px 12px;
    transition: all 0.2s ease;
}

.fc .fc-button-group > .fc-button:hover {
    background-color: #e2e6ea; /* í˜¸ë²„ ì‹œ ë” ì§„í•œ íšŒìƒ‰ */
    border-color: #dae0e5;
    color: #212529;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.fc .fc-button-group > .fc-button.fc-button-active {
    background-color: #007bff; /* ë¶€íŠ¸ìŠ¤íŠ¸ë© primary ìƒ‰ìƒê³¼ ìœ ì‚¬ */
    color: #ffffff;
    border-color: #007bff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

/* FullCalendar ìš”ì¼ í—¤ë” */
.fc-col-header-cell-cushion {
    color: #6c757d; /* ë¶€íŠ¸ìŠ¤íŠ¸ë© secondary í…ìŠ¤íŠ¸ ìƒ‰ìƒê³¼ ìœ ì‚¬ */
    font-weight: 600;
    padding: 10px 0;
}

/* FullCalendar ë‚ ì§œ ì…€ ìŠ¤íƒ€ì¼ */
.fc-daygrid-day {
    transition: background-color 0.1s ease;
}

.fc-daygrid-day:hover {
    background-color: #f5f5f5; /* í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ */
}

.fc-day-today {
    background-color: #eaf6ff !important; /* ì˜¤ëŠ˜ ë‚ ì§œ ë°°ê²½ìƒ‰ì„ ë” ë¶€ë“œëŸ½ê²Œ */
    border: 1px solid #a8d6ff !important; /* ì˜¤ëŠ˜ ë‚ ì§œ í…Œë‘ë¦¬ */
    border-radius: 6px; /* ì˜¤ëŠ˜ ë‚ ì§œ ëª¨ì„œë¦¬ ì‚´ì§ ë‘¥ê¸€ê²Œ */
}

/* ì£¼ë§ ë‚ ì§œ ìƒ‰ìƒ */
.fc-day-sun .fc-daygrid-day-number {
    color: #dc3545; /* ë¹¨ê°„ìƒ‰ (ë¶€íŠ¸ìŠ¤íŠ¸ë© danger ìƒ‰ìƒ) */
}
.fc-day-sat .fc-daygrid-day-number {
    color: #007bff; /* íŒŒë€ìƒ‰ (ë¶€íŠ¸ìŠ¤íŠ¸ë© primary ìƒ‰ìƒ) */
}

.fc-event {
    background-color: #28a745; /* ê¸°ë³¸ ì´ë²¤íŠ¸ ìƒ‰ìƒ (êµ¬ë…ì¤‘ activeì™€ ìœ ì‚¬) */
    border: 1px solid azure;
    border-radius: 4px; /* ì´ë²¤íŠ¸ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    font-size: 0.88em;
    padding: 2px 6px;
    color: #ffffff !important;
    white-space: normal; /* í…ìŠ¤íŠ¸ê°€ ê¸¸ ê²½ìš° ì¤„ ë°”ê¿ˆ */
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.fc-event-time{
	display : none;
}
.fc-event-title{
	overflow: hidden;
	white-space: nowrap;
	text-overflow: ellipsis;
	word-break: break-all;
}
body .tooltip.bs-tooltip-auto{
	max-width : 320px;
	width : 320px;
}
body .tooltip-inner{
	max-width : 300px;
	width : 300px;
}
/* íˆ´íŒ (popper.js ê´€ë ¨) - ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€í•˜ë©´ì„œ í¬ê¸° ì¡°ì • */
.popper,
.tooltip {
  position: absolute;
  z-index: 9999;
  background: #343a40; /* ì–´ë‘ìš´ ë°°ê²½ (ë¶€íŠ¸ìŠ¤íŠ¸ë© dark ìƒ‰ìƒ) */
  color: #FFFFFF;
  width: auto; /* ë‚´ìš©ì— ë”°ë¼ ë„ˆë¹„ ìë™ ì¡°ì ˆ */
  max-width: 200px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
  border-radius: 5px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  padding: 8px 12px;
  text-align: center;
  font-size: 0.85em;
  line-height: 1.4;
}
.style5 .tooltip { /* style5ëŠ” ë” ê°„ê²°í•˜ê²Œ ì¡°ì • */
  background: #1e252b;
  color: #FFFFFF;
  max-width: 220px;
  width: auto;
  font-size: .8rem;
  padding: .6em 1em;
}
.popper .popper__arrow,
.tooltip .tooltip-arrow {
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
  margin: 5px;
}

.tooltip .tooltip-arrow,
.popper .popper__arrow {
  border-color: #343a40; /* íˆ´íŒ ë°°ê²½ìƒ‰ê³¼ ë™ì¼í•˜ê²Œ */
}
.style5 .tooltip .tooltip-arrow {
  border-color: #1e252b; /* style5 ë°°ê²½ìƒ‰ê³¼ ë™ì¼í•˜ê²Œ */
}
/* íˆ´íŒ ìœ„ì¹˜ì— ë”°ë¥¸ í™”ì‚´í‘œ ì¡°ì • (í¬ê¸° ì•½ê°„ ì¤„ì„) */
.popper[x-placement^="top"],
.tooltip[x-placement^="top"] {
  margin-bottom: 8px;
}
.popper[x-placement^="top"] .popper__arrow,
.tooltip[x-placement^="top"] .tooltip-arrow {
  border-width: 6px 6px 0 6px;
  bottom: -6px;
  left: calc(50% - 6px);
}
.popper[x-placement^="bottom"],
.tooltip[x-placement^="bottom"] {
  margin-top: 8px;
}
.tooltip[x-placement^="bottom"] .tooltip-arrow,
.popper[x-placement^="bottom"] .popper__arrow {
  border-width: 0 6px 6px 6px;
  top: -6px;
  left: calc(50% - 6px);
}
.tooltip[x-placement^="right"],
.popper[x-placement^="right"] {
  margin-left: 8px;
}
.popper[x-placement^="right"] .popper__arrow,
.tooltip[x-placement^="right"] .tooltip-arrow {
  border-width: 6px 6px 6px 0;
  left: -6px;
  top: calc(50% - 6px);
}
.popper[x-placement^="left"],
.tooltip[x-placement^="left"] {
  margin-right: 8px;
}
.popper[x-placement^="left"] .popper__arrow,
.tooltip[x-placement^="left"] .tooltip-arrow {
  border-width: 6px 0 6px 6px;
  right: -6px;
  top: calc(50% - 6px);
}

/* FullCalendar ìŠ¤í¬ë¡¤ë°” (í•„ìš”ì‹œ) */
.fc-scroller {
    overflow-y: auto;
    /* ì›¹í‚· ê¸°ë°˜ ë¸Œë¼ìš°ì € ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í„°ë§ˆì´ì§• */
    &::-webkit-scrollbar {
        width: 8px;
    }
    &::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }
    &::-webkit-scrollbar-thumb {
        background: #c0c0c0; /* ì—°í•œ íšŒìƒ‰ */
        border-radius: 10px;
    }
    &::-webkit-scrollbar-thumb:hover {
        background: #a0a0a0; /* í˜¸ë²„ ì‹œ ì•½ê°„ ì§„í•˜ê²Œ */
    }
}

/* FullCalendarì˜ ìº˜ë¦°ë” ì œëª© (ex. May 2025) */
.fc-toolbar-title {
    font-size: 1.8em;
    font-weight: 700;
    color: #343a40; /* ì–´ë‘ìš´ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    line-height: 1.2;
}

/* FullCalendar ë‚ ì§œ ë²ˆí˜¸ */
.fc-daygrid-day-number {
    padding: 4px 6px;
    font-size: 0.9em;
    color: #495057; /* ê¸°ë³¸ ë‚ ì§œ ìˆ«ì ìƒ‰ìƒ */
}
.fc-license-message{
	display: none;
}

</style>
</head>
<body>
	<jsp:include page="/WEB-INF/views/modules/communityHeader.jsp" />

	<sec:authentication property="principal" var="user"/>
	<input type="hidden" id="communityArtistGroupNo" value="${artistGroupVO.artGroupNo }">
	<input type="hidden" id="communityArtistGroupNm" value="${artistGroupVO.artGroupNm }">
	<input type="hidden" id="mediaServerUrl" value="${mediaServerUrl}">
<%-- 	    <c:out value="${artistGroupVO}"/> --%>
<%-- 	    <c:out value="${user}"/> --%>
<c:set value="${artistGroupVO.communityVO.totalArtist }" var="artists"></c:set>
    <c:choose>
		<c:when test="${communityVO.artistTabYn }">
			<c:set value="${artistPostVO }" var="communityPostVO" />
		</c:when>
		<c:otherwise>
			<c:set value="${fanPostVO }" var="communityPostVO" />
		</c:otherwise>
	</c:choose>
	<c:set value="${userProfile.memberShipYn }" var="memberShipCheck" />

    <div class="apt-main-layout">
    	<aside class="apt-sidebar">
			<div class="sidebar-widget goods-widget">
				<div id="carouselExampleFade" class="carousel slide carousel-fade" data-bs-ride="carousel">
					<div class="carousel-inner">
						<c:forEach items="${thumnailImages }" var="img" varStatus="i">
							<a href="${pageContext.request.contextPath}/goods/detail?goodsNo=${img.goodsNo }">
								<div class="carousel-item <c:if test="${i.index == 0 }">active</c:if>" data-bs-interval="5000">
									<div class="carousel-item-title">
										<c:out value="${img.goodsNm }" />
									</div>
									<img src="${img.representativeImageFile.webPath }" class="d-block w-100" >
								</div>
							</a>
						</c:forEach>
					</div>
				</div>
			</div>
		</aside>

        <div class="apt-container">
            <header class="apt-header">
                <div class="apt-header-avatar">
                    <div class="artist-avatar-placeholder"><img alt="" src="${artistGroupVO.artGroupProfileImg}"> </div>
                </div>
                <div class="apt-header-info">
                	<input type="hidden" id="artistGroupProfileImg" value="${artistGroupVO.artGroupProfileImg}">
                    <h2 class="d-flex gap-2">
                    	<c:out value="${artistGroupVO.artGroupNm }" />
                    	<img alt="ì•„í‹°ìŠ¤íŠ¸ ì¸ì¦ ë§ˆí¬" src="${pageContext.request.contextPath }/resources/img/verified.png" style="width: 25px; height: 25px;">
                   	</h2>
                    <div class="artist-stats">
                        <span><c:out value="${artists }"/>ëª…</span> &bull; <span><fmt:formatNumber value="${fansWithoutDel}" pattern="#,###"/></span> íŒ¬
                    </div>
                </div>
                <div class="apt-header-actions">
                	<c:if test="${!hasMembership}">
		               	<c:if test="${followFlag eq 'N'}">
			                <button class="btn-apt-action" id="followToggleBtn">
			                    íŒ”ë¡œìš°
			                </button>
		              	</c:if>
		               	<c:if test="${followFlag eq 'Y'}">
			                <button class="btn-apt-action following" id="followToggleBtn">
			                    <span class="follow-icon">âœ”</span> íŒ”ë¡œì‰
			                </button>
		               	</c:if>
                	</c:if>
	            </div>
            </header>

            <ul class="nav apt-tabs" id="comuTab" role="tabList">
            	<li class="nav-item" role="presentation">
			        <button class="tab-item active" id="artistPost" data-bs-toggle="tab" data-bs-target="#artistPostList" type="button" role="tab" aria-controls="artistPostList" aria-selected="true" >ì•„í‹°ìŠ¤íŠ¸</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="fanPost" data-bs-toggle="tab" data-bs-target="#fanPostList" type="button" role="tab" aria-controls="fanPostList" aria-selected="false">íŒ¬</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="live" data-bs-toggle="tab" data-bs-target="#liveArea" type="button" role="tab" aria-controls="liveArea" aria-selected="false">ë¼ì´ë¸Œ</button>
			        <%-- <button class="tab-item" id="live" href="/community/apt/${artistGroupVO.artGroupNo}/live">ë¼ì´ë¸Œ</button>  <-----ì›ë˜ ì‚¬ìš©í•˜ì‹œë˜ê±°          --%>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="schedule" data-bs-toggle="tab" data-bs-target="#scheduleList" type="button" role="tab" aria-controls="scheduleList" aria-selected="false">ìŠ¤ì¼€ì¤„</button>
			    </li>
			    <li class="nav-item" role="presentation">
			        <button class="tab-item" id="noticeApt" data-bs-toggle="tab" data-bs-target="#noticeAptList" type="button" role="tab" aria-controls="noticeAptList" aria-selected="false">ê³µì§€ì‚¬í•­</button>
			    </li>
            </ul>

            <main class="apt-content-area">

                <div class="tab-pane show active" id="artistPostList" role="tabpanel" aria-labelledby="artistPost">
                   	<div id="artistFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">

                    </div>

                    <!-- ë“±ë¡ ëª¨ë‹¬ ì˜¤í”ˆ -->
                    <sec:authorize access="hasRole('ARTIST')">
	                    <div class="post-composer" id="openModal">
					        <button type="button" class="artistPostInserBtn" data-bs-toggle="modal" data-bs-target="#insertPostModal">
						        <div class="profile-placeholder"></div>
						        <span class="placeholder-text">í¬ìŠ¤íŠ¸ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</span>
							</button>
					    </div>
                    </sec:authorize>
				    <!-- ë“±ë¡ ëª¨ë‹¬ ì˜¤í”ˆ ë -->

                    <div id="artistFeedList" class="feedList">

                    </div>
                </div>

                <div class="tab-pane" id="fanPostList" role="tabpanel" aria-labelledby="fanPost">
                	<div id="fanFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">

                    </div>
                    <c:if test="${userProfile.comuMemCatCode eq 'CMCC001' || userProfile.comuMemCatCode eq 'CMCC002' }">
	                    <div class="post-composer" id="openModal">
					        <button type="button" data-bs-toggle="modal" data-bs-target="#insertPostModal">
						        <div class="profile-placeholder"></div>
						        <span class="placeholder-text">í¬ìŠ¤íŠ¸ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”.</span>
							</button>
					    </div>
                    </c:if>

					 <div id="fanFeedList" class="feedList">

                    </div>
                </div>

				<sec:authentication property="principal.username" var="currentUserId"/>

				<div class="tab-pane<c:if test='${requestScope["javax.servlet.forward.request_uri"].endsWith("/live")}'> show active</c:if>" id="liveArea" role="tabpanel" aria-labelledby="live">

				    <%-- 'Live ë°©ì†¡í•˜ê¸°' ë²„íŠ¼ì€ ìœ ì§€ --%>
				    <sec:authorize access="hasRole('ARTIST')">
				        <c:forEach items="${artistGroupVO.artistList}" var="artist">
				            <c:if test="${artist.memUsername eq currentUserId}">
				                <button onclick="startLive()" id="stream-info" class="btn btn-danger mt-4" data-user-id="${currentUserId}"
				                                           data-room-id="stream-room-${artistGroupVO.artGroupNo }">
				                    <i class="bi bi-mic-fill"></i> Live ë°©ì†¡í•˜ê¸°
				                </button>
				            </c:if>
				        </c:forEach>
				    </sec:authorize>

					<%-- ë¼ì´ë¸Œ ì •ë³´ê°€ ë™ì ìœ¼ë¡œ ë¡œë“œë  ì˜ì—­ --%>
				    <div id="liveContentArea" class="mt-4">
				        <%-- JavaScriptë¡œ ì—¬ê¸°ì— ë¼ì´ë¸Œ ì •ë³´ê°€ ì‚½ì…ë©ë‹ˆë‹¤. --%>
				        <div class="text-center p-5 text-muted border rounded" id="liveLoadingIndicator" style="display: none;">
				            <div class="spinner-border text-primary" role="status">
				                <span class="visually-hidden">Loading...</span>
				            </div>
				            <p class="mt-3 mb-0">ë¼ì´ë¸Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
				        </div>
				        <div class="text-center p-5 text-muted border rounded" id="noLiveMessage" style="display: none;">
				            <i class="bi bi-camera-video-off" style="font-size: 3rem;"></i>
				            <p class="mt-3 mb-0">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë¼ì´ë¸Œ ë°©ì†¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
				        </div>
				    </div>

<!-- 				    <div> -->
<!-- 				    	ì—¬ê¸°ì—ë‹¤ê°€ ë©¤ë²„ì‹­ì´ ì—†ìœ¼ë©´, ë¸”ëŸ¬ì²˜ë¦¬ í•´ì„œ í´ë¦­ ì•ˆë˜ê²Œ ë§‰ì„ê±°ê³  -->
<!-- 				    	ë©¤ë²„ì‹­ì´ ìˆìœ¼ë©´, ë¸”ëŸ¬ ì²˜ë¦¬ í•´ì²´í•´ì„œ ì˜ìƒì„ ë³¼ ìˆ˜ ìˆê²Œ ë§Œë“¤ê±°ì•¼. -->
<!-- 				    	Tyrdager -->
<!-- 						<iframe width="560" height="315" src="https://www.youtube.com/embed/Q9KCtQaI2EI?si=gqJ4KwQOHQbeqhw1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe> -->
<!-- 						Tyrdager Â· MUHANLOOP -->

<!-- 						Tyrdager -->

<!-- 						â„— MUHANLOOP -->

<!-- 						Released on: 2019-02-28 -->

<!-- 						Music Publisher: GMS MUSIC -->
<!-- 						Lyricist, Composer, Arranger: MUHANLOOP -->


<!-- 				    </div> -->
				</div>

			    <div class="tab-pane" id="scheduleList" role="tabpanel" aria-labelledby="schedule">
			        <p class="loading-placeholder" style="text-align: center; display: block;">
			        	<div id="calendar"></div>
					</p>
			    </div>

			    <div class="tab-pane" id="noticeAptList" role="tabpanel" aria-labelledby="noticeApt">
                  	<h3><c:out value="${artistGroupVO.artGroupNm }"/>&nbsp;ì»¤ë®¤ë‹ˆí‹° ê³µì§€ì‚¬í•­</h3>
			    	<div id="noticeSearchWarp" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">

	                </div>
				    <div id="noticeList" >

	                </div>

	                <div id="noticePagingArea">

	                </div>

			    </div>

            </main>
        </div>




<!-- /////////////////////////////////////////////////////////////////////////////////////////////////////// -->






        <aside class="apt-sidebar">
            <div class="sidebar-widget apt-level-widget">
                <h3>APT í˜„í™©</h3>
                <div class="apt-floor-display" id="aptFloorDisplay">
                	<!-- 1. div ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ì—¬ 10ëª…ë‹¹ 1ì¸µìœ¼ë¡œ ê³„ì‚° (ì •ìˆ˜ ë‚˜ëˆ—ì…ˆ) -->
                	<c:set var="aptFloor" value="${Math.floor(fansWithoutDel div 10) } "/>
                	<fmt:formatNumber value="${aptFloor }" pattern="#,###,###"/>ì¸µ
                </div>


                <div class="fan-count-tooltip-wrapper"> <p class="fan-count-display">íŒ¬ <span id="sidebarFanCountApprox">
                	<fmt:formatNumber value="${fansWithoutDel}" pattern="#,###,###"></fmt:formatNumber> </span>ëª…</p>
                </div>
            </div>
            <c:if test="${not empty userProfile }">
				<c:if test="${not empty membershipInfo }">
	            <div class="sidebar-widget membership-widget">
	                <div class="membership-icon">ğŸ›¡ï¸</div>
	                <h3>Membership</h3>
	                <c:choose>
	                	<c:when test="${hasMembership }">
	                		<p><strong>ë©¤ë²„ì‹­ì— ê°€ì…ë˜ì–´ ìˆìŠµë‹ˆë‹¤!</strong></p>
	                		<p>íŠ¹ë³„í•œ ì»¨í…ì¸ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.</p>
	                		<button class="btn-view-membership" onclick="location.href='${pageContext.request.contextPath}/mypage/memberships'" style="cursor:pointer;">
			                ë‚˜ì˜ ë©¤ë²„ì‹­ ë³´ê¸° <span class="arrow">&gt;</span>
			            </button>
	                	</c:when>
	                	<c:otherwise>
	                		<p>ì§€ê¸ˆ ë©¤ë²„ì‹­ì— ê°€ì…í•˜ê³ , íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”.</p>
			                <button class="btn-join-membership" id="openMembershipModalBtn" data-bs-toggle="modal" data-bs-target="#membershipModalOverlay">
			                    ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° <span class="arrow">&gt;</span>
			                </button>
	                	</c:otherwise>
	                </c:choose>
	            </div>
				</c:if>

	             <!-- ë§ˆì´ í”„ë¡œí•„ ì˜ì—­ ì¶”ê°€ -->
	             <div id="myProfile" class="sidebar-widget my-profile-widget" style="margin-bottom: 20px; text-align: center; cursor: pointer;" data-comu-profile-no="${userProfile.comuProfileNo}">
	                <div style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; overflow: hidden; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
	                	<img alt="í”„ë¡œí•„ img" src="${userProfile.comuProfileImg}" style="height: 100%; object-fit: cover;">
	                </div>
	                <p id="myProfileNickname" style="margin-top: 8px; font-weight: bold; font-size: 1.1em;">${userProfile.comuNicknm}</p>
	                <small>ë‚´ê°€ ì“´ ê¸€ : ${fn:length(userProfile.postList)}ê°œ</small> | <small>ë‚´ê°€ ì“´ ëŒ“ê¸€ : ${fn:length(userProfile.replyList)}ê°œ</small>
	            </div>
			</c:if>

        </aside>
    </div>

     <div class="modal fade" id="membershipModalOverlay" tabindex="-1" aria-labelledby="membershipModalLabel" aria-hidden="true"
     	data-artist-group-no="${artistGroupVO.artGroupNo }"
     	data-membership-goods-no="${artistGroupVO.membershipGoodsNo}">
        <div class="modal-dialog modal-xl">
	        <div class="modal-content membership-modal">
	            <button class="modal-close-btn" id="closeMembershipModalBtn" aria-label="Close" data-bs-dismiss="modal">&times;</button>
	            <div class="modal-header">
	                <h2>${membershipInfo.mbspNm }</h2>
	                <p class="membership-duration">ì´ìš© ê¸°ê°„: ê²°ì œì¼ë¡œë¶€í„° ${membershipInfo.mbspDuration}ì¼</p>
	            </div>
	            <div class="modal-body">
	                <div class="membership-main-image">
	                </div>
	                <h3>ì£¼ìš” í˜œíƒ ì•ˆë‚´</h3>
	                <ul class="modal-benefits-list">
	                    <li>âœ”ï¸ ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥ (ì¼ë¶€ ë¸”ëŸ¬ ì²˜ë¦¬ëœ ì½˜í…ì¸  ì¦‰ì‹œ í•´ì œ!)</li>
	                    <li>ğŸ—“ï¸ APT ë©”ì¸ ìƒë‹¨ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ êµ¬ë…ì¼ D-Day í™•ì¸</li>
	                    <li>ğŸ¤ ì½˜ì„œíŠ¸/íŒ¬ë¯¸íŒ… ì„ ì˜ˆë§¤ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ ì°¸ì—¬ ê¸°íšŒ</li>
	                    <li>ğŸ í•œì •íŒ ë©¤ë²„ì‹­ í‚¤íŠ¸ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë˜ëŠ” ë“±ê¸‰ì— ë”°ë¼)</li>
	                </ul>

	                <h3>ì´ìš© ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</h3>
	                <ul class="modal-notes-list">
	                    <li>ë³¸ ë©¤ë²„ì‹­ì€ ë¹„ìš©ì„ ì„ ì§€ë¶ˆí•˜ì—¬ ì´ìš©í•˜ëŠ” ìœ ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</li>
	                    <li>ë©¤ë²„ì‹­ì€ ì•„í‹°ìŠ¤íŠ¸(ì†”ë¡œ, ê·¸ë£¹)ë³„ë¡œ ë³„ë„ ìš´ì˜ë˜ë©°, ë³¸ ë©¤ë²„ì‹­ì€ [${artistGroupVO.artGroupNm }] ì „ìš©ì…ë‹ˆë‹¤.</li>
	                    <li>ê·¸ë£¹ ë‚´ ì†”ë¡œ í™œë™ ë©¤ë²„ ë°œìƒ ì‹œ, í•´ë‹¹ ë©¤ë²„ì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³„ë„ ìƒì„±/ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
	                    <li>ìì„¸í•œ ë‚´ìš©ì€ êµ¬ë§¤ í˜ì´ì§€ì˜ ì•½ê´€ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
	                </ul>
	            </div>
	            <div class="modal-footer">
	                <div class="membership-price">â‚© <fmt:formatNumber value="${membershipInfo.mbspPrice}" pattern="###,###"></fmt:formatNumber> <span class="vat-notice">(VAT í¬í•¨)</span></div>
	                <button class="btn-modal-purchase" id="goToPurchasePageBtn">ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸°</button>
	            </div>
	        </div>
        </div>
    </div>

	<c:if test="${followFlag eq 'N'}">
	     <!-- ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë²„ë ˆì´ -->
	    <div id="communityOverlay" class="d-flex p-2 align-items-center fixed-bottom"
	    	style="height:80px; bottom: 0px; width:100%; background-color: rgba(0,0,0,0.7); border-radius: 5px;">
	        <div class="community-overlay-bg"></div>
	        <span style="color: #fff;">ì»¤ë®¤ë‹ˆí‹° íŒ”ë¡œìš°ë¥¼ í•´ì„œ ëª¨ë“  ì»¨í…ì¸ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”</span>
	        <button class="community-join-btn" id="followBtn" style="margin-left: auto; color:#fff">íŒ”ë¡œìš°í•˜ê¸°</button>
	    </div>

	    <!-- ë‹‰ë„¤ì„ ì…ë ¥ ëª¨ë‹¬ -->
	    <div class="modal fade" id="commProfileModal" tabindex="-1" aria-labelledby="nicknameModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-centered">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h5 class="modal-title" id="commProfileModalLabel">ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</h5>
	                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	                </div>
	                <div class="modal-body">
	                	<div class="mb-3 d-flex justify-content-center align-items-center">
	                        <div class="profile-img-box" id="previewImgBox" style="width:100px; height:100px; border-radius: 50%; cursor:pointer; overflow: hidden; object-fit:cover; ">
	                            <img alt="í”„ë¡œí•„ì´ë¯¸ì§€" src="${pageContext.request.contextPath}/upload/profile/base/defaultImg.png" id="previewImg" style="height: 100px; width:100%;">
	                        </div>
	                	</div>
	                    <div class="mb-3">
	                        <label for="comuNicknm" class="form-label">ë‹‰ë„¤ì„</label>
	                        <input type="text" class="form-control" id="comuNicknm" name="comuNicknm" maxlength="12" placeholder="12ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì„¸ìš”">
	                    </div>

	                    <div class="mb-3">
	                        <label for="imgFile" class="form-label">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
	                        <input class="form-control" type="file" id="imgFile" name="imgFile" accept="image/*">
	                    </div>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
	                    <button type="button" class="btn btn-primary" id="profileSubmitBtn">ì™„ë£Œ</button>
	                </div>
	            </div>
	        </div>
	    </div>
	</c:if>

    <!-- DM ëª¨ë‹¬ì´ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="weverse-dm-modal-container"></div>


<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade " id="insertPostModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
	aria-labelledby="insertPostModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="insertPostModalLabel">
					<c:out value="${artistGroupVO.artGroupNm }" />
				</h1>
				<button type="button" class="btn-close"
					aria-label="Close" id="insertModalHeaderCloseBtn"></button>
			</div>
			<div class="modal-body">
				<form id="postForm" action="/community/insert/post"
					enctype="multipart/form-data" method="post">
					<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
					<input type="hidden" name="boardTypeCode" value="${communityVO.boardTypeCode }" />
					<input type="hidden" name="artistTabYn" value="${communityVO.artistTabYn }" />

					<div id="imgArea"></div>

					<div>ë‚´ìš©</div>
					<textarea rows="5" cols="10" id="comuPostContent"
						onkeyup="contentLengthCheck(this)" name="comuPostContent"></textarea>

					<div class="text-right pt-2">
						<span class="pt-1"><span class="cmt-sub-size">0</span>/1000</span>
					</div>

					<sec:authorize access="hasRole('ARTIST')">
						<div class="inserPostCheckbox">
							<input type="checkbox" id="postMemberShipYn" name="postMemberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼" style="display:none"/>
							<label for="postMemberShipYn" class="checkbox-label">ë©¤ë²„ì‹­ì „ìš©</label>
							<input type="hidden" id="memberShipYn" name="memberShipYn" value="" />
						</div>
					</sec:authorize>
					<div class="file-wrap">
						<input type="text" name="fileName" id="fileName" class="fileName" placeholder="ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤." readonly="readonly" />
						<input type="file" name="files" id="insertPostFile" multiple accept="image/*">
						<label for="insertPostFile" class="file-label">íŒŒì¼ì„ íƒ</label>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="postSendBtn">ì €ì¥</button>
				<button type="button" class="btn btn-secondary"
					id="addPostModalCloseBtn">ì·¨ì†Œ</button>
			</div>
		</div>
	</div>
</div>

<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ë“±ë¡ ëª¨ë‹¬ ë -->

<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal fade " id="editPostModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editPostModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h1 class="modal-title fs-5" id="editPostModalLabel">
					<c:out value="í¬ìŠ¤íŠ¸ ìˆ˜ì •" />
				</h1>
				<button type="button" class="btn-close"
					aria-label="Close" id="editPostModalHeaderCloseBtn"></button>
			</div>
			<div class="modal-body">
				<form id="editPostForm" enctype="multipart/form-data" method="post">
				<input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
					<input type="hidden" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
					<input type="hidden" name="comuPostNo" id="postNum" />
					<input type="hidden" id="fileGroupNo" name="fileGroupNo" />
					<input type="hidden" id="deleteFiles" name="deleteFiles" />

					<div id="editImgArea" class="editImg"></div>
					<div id="plusImg" class="editImg"></div>

					<div>ë‚´ìš©</div>
					<textarea rows="5" cols="10" id="editComuPostContent"
						 name="comuPostContent" onkeyup="contentLengthCheck(this)"></textarea>
					<div class="text-right pt-2">
						<span class="pt-1"><span class="cmt-sub-size">0</span>/1000</span>
					</div>

					<c:if test="${communityVO.artistTabYn }">
						<label for="editPostMemberShipYn" id="checkBoxMbs">
							<input type="checkbox" id="editPostMemberShipYn" name="postMemberShipYn" value="ë©¤ë²„ì‹­ì „ìš© ê²Œì‹œë¬¼" />
							<input type="hidden" id="editMemberShipYn" name="memberShipYn"
							value="" /> ë©¤ë²„ì‹­ì „ìš©
						</label>
					</c:if>
					<input type="file" name="files" id="editInsertPostFile" multiple accept="image/*">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" id="postUpdateBtn">ìˆ˜ì •</button>
				<button type="button" class="btn btn-secondary"
					 id="postUpdateCloseBtn">ì·¨ì†Œ</button>
			</div>
		</div>
	</div>
</div>
<!-- ì•„í‹°ìŠ¤íŠ¸ ê¸€ ìˆ˜ì • ëª¨ë‹¬ ë -->

<!-- ì‹ ê³ ëª¨ë‹¬ -->
<div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="reportModalLabel">ì‹ ê³ ì‚¬ìœ  ì„ íƒ</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="reportForm" method="post">
        	<input type="hidden" name="targetComuPostNo" id="targetComuPostNo">
        	<input type="hidden" name="targetBoardTypeCode" id="targetBoardTypeCode">
        	<input type="hidden" name="targetComuReplyNo" id="targetComuReplyNo" value="">
        	<input type="hidden" name="artGroupNo" id="reportArtGroupNo">
        	<input type="hidden" name="targetComuProfileNo" id="targetComuProfileNo">
        	<input type="hidden" name="reportTargetTypeCode" id="reportTargetTypeCode">
          <div class="mb-3">
          	<div class="radioArea">
          	</div>
          </div>
          <div class="mb-3">
            <label for="targetNick" class="col-form-label">ì‹ ê³  ì²˜ë¦¬ ëŒ€ìƒ:</label>
            <input type="text" class="form-control" id="targetNick" disabled="disabled" />
          </div>
          <div class="mb-3">
            <label for="targetContent" class="col-form-label">ì²˜ë¦¬ ë‚´ìš©:</label>
            <textarea class="form-control" id="targetContent" disabled="disabled"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="reportSendBtn">ì‹ ê³ í•˜ê¸°</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>
</div>

<!-- í¬ìŠ¤íŠ¸ ìƒì„¸ ëª¨ë‹¬ ver2 -->
<div class="modal fade" id="detailPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-custom">
         <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>

        <div class="modal-content">
            <div class="modal-body p-0">
                <div class="d-flex h-100">

                    <div class="post-pane" id="postBox">
                    </div>

                    <div class="comment-pane">
					    <div class="comment-pane-header">
					        <strong class="mx-auto" id="replyCount"></strong>
					    </div>

					    <div class="comment-pane-body" id="replyList">

					    </div>

					    <div class="comment-pane-footer">
					    	<form action="/community/reply/insert" method="get" id="replyForm">
								<input type="hidden" id="boardTypeCode" name="boardTypeCode" />
								<input type="hidden" id="comuPostNo" name="comuPostNo" />
								<input type="hidden" id="artGroupNo" name="artGroupNo" value="${artistGroupVO.artGroupNo }" />
							    <div class="input-group">
						        	<textarea id="comuReplyContent" onkeyup="replyContentLengthCheck(this)" name="comuReplyContent" class="form-control" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”." aria-label="ëŒ“ê¸€ ì…ë ¥" rows="1" style="resize: none;"></textarea>
						        	<button class="btn btn-primary" type="button" id="replyBtn">ë“±ë¡</button>
							    </div>
								<div class="text-right pt-2">
									<span class="pt-1"><span class="cmt-sub-size">0</span>/300</span>
								</div>
							</form>
						</div>
					</div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- ìŠ¤ì¼€ì¤„ ìƒì„¸ ëª¨ë‹¬ -->
<div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="scheduleModalLabel">ì¼ì •ìƒì„¸</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeBtn"></button>
			</div>
			<div class="modal-body">
	        	<div class="mb-3">
	        		 <label for="title" class="form-label">ì¼ì •ëª…</label>
	        		 <input type="text" class="form-control-plaintext" id="title" name="title" disabled="disabled">
	        	</div>
	        	<div class="mb-3">
					<label for="content" class="col-form-label">ë‚´ìš©</label>
					<textarea class="form-control" id="content" disabled="disabled"></textarea>
				</div>
				<div class="mb-3">
					<label for="place" class="col-form-label">ì¥ì†Œ</label>
					<input type="text" name="place" id="place" class="form-control" disabled="disabled"/>
				</div>
				<div class="mb-3">
					<label for="dateUrl" class="col-form-label">ê²½ë¡œ</label><br/>
					<a href="" id="datelink"></a>
				</div>
				<div class="mb-3">
					<label for="allDayCheck" class="col-form-label">í•˜ë£¨ì¼ì •ì—¬ë¶€</label>
					<input type="checkbox"  id="allDayStatus" name="allDayStatus" disabled="disabled">
				</div>
				<div class="mb-3">
					<label for="date" class="col-form-label">ì¼ì •</label>
					<div class="notAllDaySchedule" style="display:none">
						<input type="text" name="datetimes" id="startDate" class="form-control" disabled="disabled"/> ~
						<input type="text" name="datetimes" id="endDate" class="form-control" disabled="disabled"/>
					</div>
					<div class="allDaySchedule" style="display:none">
						<input type="text" name="datetimes" id="allDate" class="form-control" disabled="disabled"/>
					</div>
				</div>
	        </div>
	        <div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancelBtn">ë‹«ê¸°</button>
			</div>
		</div>
	</div>
</div>

<div id="footer">
       <!-- FOOTER -->
    <jsp:include page="/WEB-INF/views/modules/communityFooter.jsp" />
    <script src="${pageContext.request.contextPath}/resources/js/pages/communityFooter.js"></script>
    <!-- FOOTER END -->
</div>
<script type="text/javascript">

// ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
document.addEventListener('DOMContentLoaded', function () {
	// ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸° ë²„íŠ¼
	const mbspBtn = document.getElementById('openMembershipModalBtn');
	const membershipModal = document.getElementById('membershipModalOverlay');
	const closeModalBtn = document.querySelector('#closeMembershipModalBtn');
	const goToPurchasePageBtn = document.getElementById('goToPurchasePageBtn');

	const csrfMeta = document.querySelector('meta[name="_csrf"]');
	const csrfHeaderMeta = document.querySelector('meta[name="_csrf_header"]');

	let csrfToken = csrfMeta.getAttribute('content');
	let csrfHeaderName = csrfHeaderMeta.getAttribute('content');

	let artistGroupNo = membershipModal.dataset.artistGroupNo;
	let membershipGoodsNo = parseInt(membershipModal.dataset.membershipGoodsNo);

	// ê²°ì œ êµ¬í˜„
	goToPurchasePageBtn.addEventListener('click', function() {
		requestKakaoPaySubscription(membershipGoodsNo, artistGroupNo);
	});

	function requestKakaoPaySubscription(goodsNo, artistGroupNo) {
		// 1. ê²°ì œí•  ë©¤ë²„ì‹­ ìƒí’ˆ ì •ë³´ ì •ì˜
		const orderData = {
				orderItems: [
					{
						goodsNo: goodsNo,
						goodsOptNo: null,
						qty: 1,
						goodsNm: "DDTOWN ì•„í‹°ìŠ¤íŠ¸ ë©¤ë²„ì‹­",
					}
				],
				singleGoodsName: "DDTOWN ì•„í‹°ìŠ¤íŠ¸ ë©¤ë²„ì‹­",
				totalAmount: "${membershipInfo.mbspPrice}",
				isFromCart: false,
				orderTypeCode: "OTC001", // ë©¤ë²„ì‹­
				orderPayMethodNm: "ì¹´ì¹´ì˜¤í˜ì´",
				orderRecipientNm: "${user.memberVO.peoName}",
	            orderRecipientPhone: "${user.memberVO.peoPhone}", // ìœ íš¨í•˜ì§€ ì•Šì€ ì „í™”ë²ˆí˜¸
	            orderZipCode: "${user.memberVO.memZipCode}", // ë”ë¯¸ ìš°í¸ë²ˆí˜¸
	            orderAddress1: "${user.memberVO.memAddress1}", // ë”ë¯¸ ì£¼ì†Œ
	            orderAddress2: "${user.memberVO.memAddress2}", // ë”ë¯¸ ìƒì„¸ ì£¼ì†Œ
	            orderEmail: "${user.memberVO.peoEmail}", // ë”ë¯¸ ì´ë©”ì¼
	            orderMemo: `ë©¤ë²„ì‹­ ìƒí’ˆ êµ¬ë§¤ - ì•„í‹°ìŠ¤íŠ¸ ê·¸ë£¹ ë²ˆí˜¸ : \${artistGroupNo}`
		};

		console.log("ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì¤€ë¹„ ìš”ì²­ ë°ì´í„° : ", orderData);

		const headers = {
				'Content-Type':'application/json'
		};

		if (csrfToken && csrfHeaderName) { // null ì²´í¬ í›„ í• ë‹¹
		    headers[csrfHeaderName] = csrfToken;
		}

		// 2. ë°±ì—”ë“œ API í˜¸ì¶œ
		fetch('/goods/order/pay/ready', {
			method: 'POST',
			headers: headers,
			body: JSON.stringify(orderData)
		})
		.then(response => {
			if(!response.ok) {
				return response.text().then(errorMessage => {
					console.error("ë°±ì—”ë“œ ì˜¤ë¥˜ ì‘ë‹µ: ", errorMessage);
				});
			}
			return response.json();
		})
		.then(data => {
			const nextRedirectUrl = data.next_redirect_pc_url;

			if(nextRedirectUrl) {
				console.log("ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸: ", nextRedirectUrl);
				window.location.href = nextRedirectUrl;
				localStorage.setItem("url",window.location.href);

			} else {
				console.log("ì¹´ì¹´ì˜¤í˜ì´ ë¦¬ë‹¤ì´ë ‰íŠ¸ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë°ì´í„°: ", data);
			}
		})
		.catch(error => {
			console.log("ì¹´ì¹´ì˜¤í˜ì´ ê²°ì œ ì¤€ë¹„ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ", error.message);
		})
	};

});


// ë°©ì†¡í•˜ê¸° ê´€ë ¨ ìŠ¤í¬ë¦½ëŠ” ë³„ë„ì˜jsë¥¼ import í•©ë‹ˆë‹¤. í•˜ë‹¨ì— ìˆìŒ.

function fullCalendar(artGroupNo){
	var calendarEl = document.getElementById('calendar');
	var calendar = new FullCalendar.Calendar(calendarEl,{
		height : 'auto',
		initialView : 'dayGridMonth',
		handleWindowResize : true,
		locale : 'ko',
		buttonText : {
			today : 'ì˜¤ëŠ˜',
			month : 'ë‹¬',
			week : 'ì´ë²ˆì£¼'
		},
		events : {
			url : '/community/fullcalendar/event/' + artGroupNo,
			type : 'get',
			success : function(res){
				console.log(res)
				return res;
			}
		},
		eventDidMount: function(info) {
			console.log(info);

			let { title, allDay, extendedProps, startStr,endStr} = info.event;
			let { place, content } = extendedProps;
			let startDate = fulldateFormat(startStr)
			let endDate = fulldateFormat(endStr)
			console.log(startDate)
			let formattedDate = "";
			if(allDay){
				formattedDate = startDate;
			}else{
				formattedDate = `\${startDate} ~ \${endDate}`;
			}
			tooltipHtml = `
				<div> ì œ ëª© : \${title}</div>
				<div> ì¥ ì†Œ : \${place}</div>
				<div> ë‚´ ìš© : \${content}</div>
				<div> ì‹œ ê°„ : \${formattedDate}</div>
			`;
			var tooltip = new bootstrap.Tooltip(info.el, {
			   title : tooltipHtml,
			html : true,
			   placement: 'top',
			   trigger: 'hover',
			   container: 'body'
			});
	    },
	    headerToolbar : {
			start : 'prevYear,prev,next,nextYear today',
			center : 'title',
			end : 'dayGridMonth,dayGridWeek'
		},
		eventClick : function(e){
        	e.jsEvent.cancelBubble = true;		// ì¼ì •ì— ìˆëŠ” url ë§‰ê¸°
        	e.jsEvent.preventDefault();

        	const detailModal = new bootstrap.Modal(document.getElementById('scheduleModal'));

        	detailModal.show(e);
        },
	});
	calendar.render();
}

function fulldateFormat(jsonDate){
	if (!jsonDate) return "";
	let date = new Date(jsonDate);
	let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return month + "ì›” " + day + "ì¼ " + hour + "ì‹œ" + minute + "ë¶„";
}

function dateFormat(jsonDate){
	if (!jsonDate) return "";
	let date = new Date(jsonDate);
	let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return month + '.' + day + ". " + hour + ":" + minute;
}

function artistPostList(data){
	let artGroupNo = data.artGroupNo;
	console.log(artGroupNo);
	$.ajax({
		url : "/community/gate/" + artGroupNo + "/apt/api",
		type : "get",
		data : data,
		success : function(res){
			console.log("ê²Œì‹œê¸€ ëª©ë¡ ê°€ì ¸ì˜´ : ", res);
			let tab = res.tab;
			let pagingVO = res.pagingVO;
			let artistGroupVO = res.artistGroupVO;
			let artistList = artistGroupVO.artistList;
			let { userProfile, followFlag } = res;

			let searchId;
			if(tab){
				searchId = "artistFeedSearchInput";
			}else{
				searchId = "fanFeedSearchInput";
			}

			let searchHtml = `
				<form id="artistSearchForm">
					<div class="searchArea">
						<input type="hidden" id="comuArtGroupNo" value="\${artistGroupVO.artGroupNo }" />
						<input type="hidden" id="artistTabYn" name="artistTabYn" value="\${tab }" />
						<input type="hidden" name="searchType" id="searchType" />
						<input type="search" name="searchWord" id="\${searchId}"
			`;

			if(pagingVO.searchWord != null){
				searchHtml += `value="\${pagingVO.searchWord }"`;
			}

			searchHtml += `
						placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰ (ì œëª©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
						<input type="button" id="searchFormBtn" class="btn btn-primary" value="ê²€ìƒ‰" />
					</div>
				`;

			if(tab){
				searchHtml += `
					<div class="radioBtnArea">
						<input type="radio" class="btn-check" name="artistNm" id="all" value=""`;
				if(pagingVO.searchType == null || pagingVO.searchType == ''){
					searchHtml += `checked`;
				}
				searchHtml += `/>
					<label class="btn btn-outline-primary" for="all">ì „ì²´</label>
				`;
				for(let i=0; i<artistList.length; i++){

					let artist = artistList[i];
					let checked;
					if(pagingVO.searchType != null && pagingVO.searchType != 'undefined'){

						if(artist.memUsername == pagingVO.searchType){
							console.log("ê°™ìŒ");
							checked = `<input type="radio" class="btn-check" name="artistNm" id="\${artist.artNm }" value="\${artist.memUsername }" checked />`;
						}else{
							console.log("ë‹¤ë¦„");
							checked = `<input type="radio" class="btn-check" name="artistNm" id="\${artist.artNm }" value="\${artist.memUsername }" />`;
						}

					}else{
						console.log("ë‹¤ë¦„");
						checked = `<input type="radio" class="btn-check" name="artistNm" id="\${artist.artNm }" value="\${artist.memUsername }" />`;
					}

					searchHtml += `
						\${checked}
						<label class="btn btn-outline-primary" for="\${artist.artNm }">\${artist.artNm }</label>

					`;
				}

				searchHtml += `
						</div>
					</form>`;

				$("#artistFeedSearchWrap").html(searchHtml);
			}else{
				searchHtml += `</form>`;

				$("#fanFeedSearchWrap").html(searchHtml);
			}

			// ì•„í‹°ìŠ¤íŠ¸ íƒ­ì¼ ë•Œ
			if(tab){
				let artistPostVO = res.artistPostVO;
				
				let postHtml = ``;
				if(artistPostVO.length > 0 && artistPostVO != null){
					for(let i=0; i<artistPostVO.length; i++){
						let post = artistPostVO[i];
						let postModDate = dateFormat(post.comuPostModDate);
						let postRegDate = dateFormat(post.comuPostRegDate);
						
						let lastPost = "";
						let curPage = 0;
						if(artistPostVO.length -1 == i){
							lastPost = "lastPost";
							curPage = pagingVO.currentPage;
						}

						let blurPostYn;
						if(post.comuPostMbspYn == 'Y' && userProfile.memberShipYn == 'N'){
							blurPostYn = 'Y';
						}else{
							blurPostYn = 'N';
						}

						postHtml += `
							<div class="feed-item feedBox \${lastPost}" id="\${lastPost}" data-post-id="\${post.comuPostNo }" >
								<div class="feed-item-header">
								<a href="/community/\${post.artGroupNo}/profile/\${post.comuProfileNo}" id="profileLink" class="postProfile">
									<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="\${post.writerProfile.comuProfileImg }"></div>
									<div class="author-info">
										<span class="author-name" style="color:'#8a2be2';">\${post.writerProfile.comuNicknm}</span>
										<span class="post-time">
										`;
						if(post.comuPostRegDate != post.comuPostModDate){
											postHtml += `\${postModDate} (ìˆ˜ì •ë¨) </span>`;
						}else{
											postHtml += `\${postRegDate} </span>`;
						}

						if(post.memberShipYn){
											postHtml += `<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>`;
						}
						postHtml += `
									</div>
								</a>

									<div class="post-options">
										<button id="dropCate" class="post-options-btn" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-three-dots-vertical"></i></button>
										<ul class="dropdown-menu" aria-labelledby="dropCate">
									`;
						if(userProfile.memUsername == post.writerProfile.memUsername){
						postHtml += `
							<li><a class="dropdown-item" href="#" id="edit" data-bs-toggle="modal" data-bs-target="#editPostModal" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="listEdit">ìˆ˜ì •</a></li>
							<li><hr class="dropdown-divider"></li>
						    <li><a class="dropdown-item" href="#" id="delete" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="delete">ì‚­ì œ</a></li>
						`;
						}else{
						postHtml += `
							<li><a class="dropdown-item" href="#" id="reportPost"
									data-bs-toggle="modal"
									data-bs-target="#reportModal"
									data-bs-whatever="\${post.comuPostNo }"
									data-bs-boardType="\${post.boardTypeCode }"
									data-bs-comuProfileNo="\${post.comuProfileNo }"
									data-bs-comuNick="\${post.writerProfile.comuNicknm }"
									data-bs-comuContent="\${post.comuPostContent }"
									data-bs-selectType="RTTC001">ì‹ ê³ </a></li>
						`;
						}
						postHtml += `
										</ul>
								</div>
								</div>
								<a href=`;
						if(blurPostYn == 'Y'){
							postHtml += `""`;
						}else{
							postHtml += `"#detailPostModal"`;
						}
							postHtml +=`id="postLink" data-bs-toggle="modal" data-bs-postNum="\${post.comuPostNo}" data-bs-membershipBlur="\${blurPostYn}">
						`;

						if(post.memberShipYn && userProfile.memberShipYn == 'N'){
							postHtml += `<div class="feed-item-content membership-blur" data-post-id="\${post.comuPostNo }" style="position:relative;">`;
						}else{
							postHtml += `<div class="feed-item-content" data-post-id="\${post.comuPostNo }" >`;
						}

						postHtml += `

										<form id="postForm\${i }" data-postNum="\${post.comuPostNo }">
											<div class="openPostModal" id="openPostModal" data-postNum=\${post.comuPostNo }>
						`;

						if(post.postFiles != null && post.postFiles.length > 0){
							postHtml += `<div class="post-img">`;
							for(let j=0; j<post.postFiles.length; j++){
								let postFile = post.postFiles[j];
								postHtml += `<img src="\${postFile.webPath }">`;
							}
							postHtml += `</div>`;
						}

						postHtml += `
												<div class="post-text" id="artistPostViewer">\${post.comuPostContent}</div>
											</div>
										</form>

									</div>
									<div class="feed-item-actions">
										<button class="action-btn comment-toggle-btn"><i class="bi bi-chat-left-dots"></i> ëŒ“ê¸€ <span class="count">\${post.comuPostReplyCount }</span></button>
									</a>
										<button class="action-btn comment-toggle-btn" id="postListLike"
											data-board-type-code="\${post.boardTypeCode}"
											data-comu-post-no="\${post.comuPostNo}">
						`;

						if(post.likeYn == 'N'){
							postHtml += `<i class="bi bi-heart"><span id="likeCount">\${post.comuPostLike }</span></i>`;
						}else{
							postHtml += `<i class="bi bi-heart-fill"><span id="likeCount">\${post.comuPostLike }</span></i>`;
						}

						postHtml += `
										</button>
									</div>
								</div>
							</div>
						</a>
						</div>
						`;
					}
				}else{	// ê²Œì‹œë¬¼ì´ í•˜ë‚˜ë„ ì—†ì„ ë•Œ
					postHtml += `
					<div class="noSearchPostList">
						<i class="bi bi-exclamation-circle"></i> ì¡°íšŒê°€ëŠ¥í•œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.
					</div>
				`;
				}

				$("#artistFeedList").html(postHtml);

			}else{

				let fanPostVO = res.fanPostVO;
				let postHtml = ``;
				if(fanPostVO.length > 0 && fanPostVO != null){
					for(let i=0; i<fanPostVO.length; i++){
						let post = fanPostVO[i];
						let postModDate = dateFormat(post.comuPostModDate);
						let postRegDate = dateFormat(post.comuPostRegDate);
						
						let lastPost = "";
						let curPage = 0;
						if(fanPostVO.length -1 == i){
							lastPost = "lastPost";
							curPage = pagingVO.currentPage;
						}
						


						postHtml += `
							<div class="feed-item feedBox \${lastPost}" id="\${lastPost}" data-current-page="\${curPage}" data-post-id="\${post.comuPostNo }">
							<div class="feed-item-header">
								<a href="/community/\${post.artGroupNo}/profile/\${post.comuProfileNo}"  class="postProfile">
								<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="\${post.writerProfile.comuProfileImg }"></div>
								<div class="author-info">
									<span class="author-name" style="color:'#8a2be2';">\${post.writerProfile.comuNicknm}</span>
									<span class="post-time">
						`;

						if(post.comuPostRegDate != post.comuPostModDate){
							postHtml += `\${postModDate} (ìˆ˜ì •ë¨) </span>`;
						}else{
							postHtml += `\${postRegDate} </span>`;
						}

						postHtml += `
									</div>
								</a>
									<div class="post-options">
										<button id="dropCate" class="post-options-btn" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-three-dots-vertical"></i></button>
										<ul class="dropdown-menu" aria-labelledby="dropCate">
						`;
						if(userProfile.memUsername == post.writerProfile.memUsername){
						postHtml += `
							<li><a class="dropdown-item" href="#" id="edit" data-bs-toggle="modal" data-bs-target="#editPostModal" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="listEdit">ìˆ˜ì •</a></li>
							<li><hr class="dropdown-divider"></li>
							<li><a class="dropdown-item" href="#" id="delete" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="delete">ì‚­ì œ</a></li>
						`;
						}else{
						postHtml += `
							<li><a class="dropdown-item" href="#" id="reportPost"
									data-bs-toggle="modal"
									data-bs-target="#reportModal"
									data-bs-whatever="\${post.comuPostNo }"
									data-bs-boardType="\${post.boardTypeCode }"
									data-bs-comuProfileNo="\${post.comuProfileNo }"
									data-bs-comuNick="\${post.writerProfile.comuNicknm }"
									data-bs-comuContent="\${post.comuPostContent }"
									data-bs-selectType="RTTC001">ì‹ ê³ </a></li>
						`;
						}
						postHtml += `
										</ul>
									</div>
								</div>
							<div class="feed-item-content" data-post-id="\${post.comuPostNo }" >
								<a href="#detailPostModal" data-bs-toggle="modal" data-bs-postNum="\${post.comuPostNo}">
									<form id="postForm\${i }" data-postNum="\${post.comuPostNo }">
										<div class="openPostModal" id="openPostModal" data-postNum=\${post.comuPostNo }>
						`;

						if(post.postFiles != null && post.postFiles.length > 0){
							postHtml += `<div class="post-img">`;
							for(let j=0; j<post.postFiles.length; j++){
								let postFile = post.postFiles[j];
								postHtml += `<img src="\${postFile.webPath }">`;
							}
							postHtml += `</div>`;
						}

						postHtml += `
							<div class="post-text" id="artistPostViewer">\${post.comuPostContent}</div>
								</div>
							</form>

							</div>
							<div class="feed-item-actions">
								<button class="action-btn comment-toggle-btn"><i class="bi bi-chat-left-dots"></i> ëŒ“ê¸€ <span class="count">\${post.comuPostReplyCount }</span></button>
							</a>
								<button class="action-btn comment-toggle-btn" id="postListLike"
									data-board-type-code="\${post.boardTypeCode}"
									data-comu-post-no="\${post.comuPostNo}">
							`;

						if(post.likeYn == 'N'){
							postHtml += `<i class="bi bi-heart"><span id="likeCount">\${post.comuPostLike }</span></i>`;
						}else{
							postHtml += `<i class="bi bi-heart-fill"><span id="likeCount">\${post.comuPostLike }</span></i>`;
						}

						postHtml += `
										</button>
									</div>
								</div>
							</div>
						</a>
						`;

					}

				}else{
					postHtml += `
						<div class="noSearchPostList">
							<i class="bi bi-exclamation-circle"></i> ì¡°íšŒê°€ëŠ¥í•œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.
						</div>
					`;
				}
				`;

				$("#fanFeedList").html(postHtml);
			}
			
			// .children("span.pt-1").children(".cmt-sub-size"))
			const lastPost = document.querySelector('#lastPost');
			
//				let data = {
//						"artGroupNo" : $("#communityArtistGroupNo").val(),
//						"searchType" : $(this).val(),
//						"searchWord" : $("#artistFeedSearchInput").val(),
//						"artistTabYn" : artistTabFlag
//					}
			console.log(lastPost.dataset.currentPage);
			console.log(lastPost);
			data.page = parseInt(lastPost.dataset.currentPage) + 1;
			
			if(tab){
				data.searchWord = $("#artistFeedSearchInput").val();
			}else{
				data.searchWord = $("#fanFeedSearchInput").val();
			}
			console.log(data)
			
			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
				    console.log(entry.isIntersecting);
				    if(entry.isIntersecting){
				    	$.ajax({
				    		url : '/community/gate/' + artGroupNo + '/apt/api',
				    		type : 'get',
				    		data : data,
				    		success : function(res){
				    			fanFeedList.removeAttribute('id');
				    			
				    			if(res.tab){
				    				if(res.artistPostVO.length > 0 && res.artistPostVO != null){
				    					infinite(res);
				    					lastPost = document.querySelector('#lastPost');
				    				}else{
				    					return;
				    				}
				    			}else{
				    				if(res.fanPostVO.length > 0 && res.fanPostVO != null){
				    					infinite(res);
				    					lastPost = document.querySelector('#lastPost');
				    				}else{
				    					return;
				    				}
				    			}
				    			
				    		},
				    		error : function(error){
				    			console.log(error.status)
				    		}
				    	});
				    }
		  		});
		    });
			
			observer.observe(lastPost);
		},
		error : function(error){
			console.log(error);
		}
	})
}

function infinite(res){
	let pagingVO = res.pagingVO;
	let artistGroupVO = res.artistGroupVO;
	let artistList = artistGroupVO.artistList;
	let { userProfile, followFlag } = res;
	let postTab = res.tab;
	
	if(postTab){
		let artistPostVO = res.artistPostVO;
		
		let postHtml = ``;
		if(artistPostVO.length > 0 && artistPostVO != null){
			for(let i=0; i<artistPostVO.length; i++){
				let post = artistPostVO[i];
				let postModDate = dateFormat(post.comuPostModDate);
				let postRegDate = dateFormat(post.comuPostRegDate);
				
				let lastPost = "";
				let curPage = 0;
				if(artistPostVO.length -1 == i){
					lastPost = "lastPost";
					curPage = pagingVO.currentPage;
				}

				let blurPostYn;
				if(post.comuPostMbspYn == 'Y' && userProfile.memberShipYn == 'N'){
					blurPostYn = 'Y';
				}else{
					blurPostYn = 'N';
				}

				postHtml += `
					<div class="feed-item feedBox \${lastPost}" id="\${lastPost}" data-current-page="\${curPage}" data-post-id="\${post.comuPostNo }" >
						<div class="feed-item-header">
						<a href="/community/\${post.artGroupNo}/profile/\${post.comuProfileNo}" id="profileLink" class="postProfile">
							<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="\${post.writerProfile.comuProfileImg }"></div>
							<div class="author-info">
								<span class="author-name" style="color:'#8a2be2';">\${post.writerProfile.comuNicknm}</span>
								<span class="post-time">
								`;
				if(post.comuPostRegDate != post.comuPostModDate){
									postHtml += `\${postModDate} (ìˆ˜ì •ë¨) </span>`;
				}else{
									postHtml += `\${postRegDate} </span>`;
				}

				if(post.memberShipYn){
									postHtml += `<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>`;
				}
				postHtml += `
							</div>
						</a>

							<div class="post-options">
								<button id="dropCate" class="post-options-btn" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-three-dots-vertical"></i></button>
								<ul class="dropdown-menu" aria-labelledby="dropCate">
							`;
				if(userProfile.memUsername == post.writerProfile.memUsername){
				postHtml += `
					<li><a class="dropdown-item" href="#" id="edit" data-bs-toggle="modal" data-bs-target="#editPostModal" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="listEdit">ìˆ˜ì •</a></li>
					<li><hr class="dropdown-divider"></li>
				    <li><a class="dropdown-item" href="#" id="delete" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="delete">ì‚­ì œ</a></li>
				`;
				}else{
				postHtml += `
					<li><a class="dropdown-item" href="#" id="reportPost"
							data-bs-toggle="modal"
							data-bs-target="#reportModal"
							data-bs-whatever="\${post.comuPostNo }"
							data-bs-boardType="\${post.boardTypeCode }"
							data-bs-comuProfileNo="\${post.comuProfileNo }"
							data-bs-comuNick="\${post.writerProfile.comuNicknm }"
							data-bs-comuContent="\${post.comuPostContent }"
							data-bs-selectType="RTTC001">ì‹ ê³ </a></li>
				`;
				}
				postHtml += `
								</ul>
						</div>
						</div>
						<a href=`;
				if(blurPostYn == 'Y'){
					postHtml += `""`;
				}else{
					postHtml += `"#detailPostModal"`;
				}
					postHtml +=`id="postLink" data-bs-toggle="modal" data-bs-postNum="\${post.comuPostNo}" data-bs-membershipBlur="\${blurPostYn}">
				`;

				if(post.memberShipYn && userProfile.memberShipYn == 'N'){
					postHtml += `<div class="feed-item-content membership-blur" data-post-id="\${post.comuPostNo }" style="position:relative;">`;
				}else{
					postHtml += `<div class="feed-item-content" data-post-id="\${post.comuPostNo }" >`;
				}

				postHtml += `

								<form id="postForm\${i }" data-postNum="\${post.comuPostNo }">
									<div class="openPostModal" id="openPostModal" data-postNum=\${post.comuPostNo }>
				`;

				if(post.postFiles != null && post.postFiles.length > 0){
					postHtml += `<div class="post-img">`;
					for(let j=0; j<post.postFiles.length; j++){
						let postFile = post.postFiles[j];
						postHtml += `<img src="\${postFile.webPath }">`;
					}
					postHtml += `</div>`;
				}

				postHtml += `
										<div class="post-text" id="artistPostViewer">\${post.comuPostContent}</div>
									</div>
								</form>

							</div>
							<div class="feed-item-actions">
								<button class="action-btn comment-toggle-btn"><i class="bi bi-chat-left-dots"></i> ëŒ“ê¸€ <span class="count">\${post.comuPostReplyCount }</span></button>
							</a>
								<button class="action-btn comment-toggle-btn" id="postListLike"
									data-board-type-code="\${post.boardTypeCode}"
									data-comu-post-no="\${post.comuPostNo}">
				`;

				if(post.likeYn == 'N'){
					postHtml += `<i class="bi bi-heart"><span id="likeCount">\${post.comuPostLike }</span></i>`;
				}else{
					postHtml += `<i class="bi bi-heart-fill"><span id="likeCount">\${post.comuPostLike }</span></i>`;
				}

				postHtml += `
								</button>
							</div>
						</div>
					</div>
				</a>
				</div>
				`;
			}
		}else{	// ê²Œì‹œë¬¼ì´ í•˜ë‚˜ë„ ì—†ì„ ë•Œ
			postHtml += `
			<div class="noSearchPostList">
				<i class="bi bi-exclamation-circle"></i> ì¡°íšŒê°€ëŠ¥í•œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.
			</div>
		`;
		}

		$("#artistFeedList").append(postHtml);

	}else{

		let fanPostVO = res.fanPostVO;
		let postHtml = ``;
		if(fanPostVO.length > 0 && fanPostVO != null){
			for(let i=0; i<fanPostVO.length; i++){
				let post = fanPostVO[i];
				let postModDate = dateFormat(post.comuPostModDate);
				let postRegDate = dateFormat(post.comuPostRegDate);
				
				let lastPost = "";
				let curPage = 0;
				if(fanPostVO.length -1 == i){
					lastPost = "lastPost";
					curPage = pagingVO.currentPage;
				}
				

				postHtml += `
					<div class="feed-item feedBox \${lastPost}" id="\${lastPost}" data-current-page="\${curPage}" data-post-id="\${post.comuPostNo }">
					<div class="feed-item-header">
						<a href="/community/\${post.artGroupNo}/profile/\${post.comuProfileNo}"  class="postProfile">
						<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="\${post.writerProfile.comuProfileImg }"></div>
						<div class="author-info">
							<span class="author-name" style="color:'#8a2be2';">\${post.writerProfile.comuNicknm}</span>
							<span class="post-time">
				`;

				if(post.comuPostRegDate != post.comuPostModDate){
					postHtml += `\${postModDate} (ìˆ˜ì •ë¨) </span>`;
				}else{
					postHtml += `\${postRegDate} </span>`;
				}

				postHtml += `
							</div>
						</a>
							<div class="post-options">
								<button id="dropCate" class="post-options-btn" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-three-dots-vertical"></i></button>
								<ul class="dropdown-menu" aria-labelledby="dropCate">
				`;
				if(userProfile.memUsername == post.writerProfile.memUsername){
				postHtml += `
					<li><a class="dropdown-item" href="#" id="edit" data-bs-toggle="modal" data-bs-target="#editPostModal" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="listEdit">ìˆ˜ì •</a></li>
					<li><hr class="dropdown-divider"></li>
					<li><a class="dropdown-item" href="#" id="delete" data-bs-postNum="\${post.comuPostNo }" data-bs-categroy="delete">ì‚­ì œ</a></li>
				`;
				}else{
				postHtml += `
					<li><a class="dropdown-item" href="#" id="reportPost"
							data-bs-toggle="modal"
							data-bs-target="#reportModal"
							data-bs-whatever="\${post.comuPostNo }"
							data-bs-boardType="\${post.boardTypeCode }"
							data-bs-comuProfileNo="\${post.comuProfileNo }"
							data-bs-comuNick="\${post.writerProfile.comuNicknm }"
							data-bs-comuContent="\${post.comuPostContent }"
							data-bs-selectType="RTTC001">ì‹ ê³ </a></li>
				`;
				}
				postHtml += `
								</ul>
							</div>
						</div>
					<div class="feed-item-content" data-post-id="\${post.comuPostNo }" >
						<a href="#detailPostModal" data-bs-toggle="modal" data-bs-postNum="\${post.comuPostNo}">
							<form id="postForm\${i }" data-postNum="\${post.comuPostNo }">
								<div class="openPostModal" id="openPostModal" data-postNum=\${post.comuPostNo }>
				`;

				if(post.postFiles != null && post.postFiles.length > 0){
					postHtml += `<div class="post-img">`;
					for(let j=0; j<post.postFiles.length; j++){
						let postFile = post.postFiles[j];
						postHtml += `<img src="\${postFile.webPath }">`;
					}
					postHtml += `</div>`;
				}

				postHtml += `
					<div class="post-text" id="artistPostViewer">\${post.comuPostContent}</div>
						</div>
					</form>

					</div>
					<div class="feed-item-actions">
						<button class="action-btn comment-toggle-btn"><i class="bi bi-chat-left-dots"></i> ëŒ“ê¸€ <span class="count">\${post.comuPostReplyCount }</span></button>
					</a>
						<button class="action-btn comment-toggle-btn" id="postListLike"
							data-board-type-code="\${post.boardTypeCode}"
							data-comu-post-no="\${post.comuPostNo}">
					`;

				if(post.likeYn == 'N'){
					postHtml += `<i class="bi bi-heart"><span id="likeCount">\${post.comuPostLike }</span></i>`;
				}else{
					postHtml += `<i class="bi bi-heart-fill"><span id="likeCount">\${post.comuPostLike }</span></i>`;
				}

				postHtml += `
								</button>
							</div>
						</div>
					</div>
				</a>
				`;

			}

		}else{
			postHtml += `
				<div class="noSearchPostList">
					<i class="bi bi-exclamation-circle"></i> ì¡°íšŒê°€ëŠ¥í•œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.
				</div>
			`;
		}
		postHtml += `
			<div class="spinner-border text-primary" role="status">
			  <span class="visually-hidden">Loading...</span>
			</div>
		`;

		$("#fanFeedList").append(postHtml);
	}
}

//ìƒì„¸ ëª¨ë‹¬ ì°½ì—ì„œ ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì‹œ
function likeBtn(e){
	let icon = e.children('i');
	let like = e.children('span');

	let iconAttr = icon.attr("class")
	let likeCount = e.children('span').html();

	console.log("iconAttr", iconAttr);
	let updateLikeCount;

	if(iconAttr === "bi bi-heart-fill"){
		icon.attr("class","bi bi-heart");
		updateLikeCount = parseInt(likeCount) - 1;
	}else{
		icon.attr("class","bi bi-heart-fill");
		updateLikeCount = parseInt(likeCount) + 1;
	}

	like.html(updateLikeCount);

}

//ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
function likeUpdate(data){
	$.ajax({
		url : "/community/like/update",
		type : "post",
		data : data,
		processData : false,
		contentType : false,
		success : function(res){
			if(res == 'OK'){
				console.log('ì •ìƒì ìœ¼ë¡œ ë“±ë¡ ì™„ë£Œ')
				let boardTypeCode = data.get("boardTypeCode");
				console.log(boardTypeCode);
				let artistTabFlag = true;
				if (boardTypeCode == 'ARTIST_BOARD'){
					artistTabFlag = true;
				}else{
					artistTabFlag = false;
				}
				let param = {
					"artGroupNo" : $("#communityArtistGroupNo").val(),
					"artistTabYn" : artistTabFlag
				}
				artistPostList(param);
			}
		},
		error : function(error){
			console.log(error.status);
		},
		beforeSend : function(xhr){
			xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
		}
	});
}

function noticeList(data){
	let artGroupNo = data.artGroupNo;
	$.ajax({
		url : '/community/notice/' + artGroupNo,
		type : 'get',
		data : data,
		success : function(res){
			console.log(res);
			let pagingVO = res.pagingVO;
			let artistGroupVO = res.artistGroupVO;
			let noticeCodeVO = res.noticeCodeVO;
			let noticeList = pagingVO.dataList;

			let searchHtml = `
				<form id="noticeSearchForm">
					   <input type="search" name="searchWord" id="noticeSearchWord"
			`;

			if(pagingVO.searchWord != null && pagingVO.searchWord != ''){
				searchHtml += `value="\${pagingVO.searchWord }"`;
			}else{
				searchHtml += `value="" `;
			}

			searchHtml += `
			   placeholder="ê³µì§€ì‚¬í•­ ê²€ìƒ‰ (ì œëª©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
			   <input type="button" id="noticeSearchFormBtn" class="btn btn-primary" value="ê²€ìƒ‰" />

				<input type="radio" class="btn-check"name="searchType" id="noticeAll"  value=""
			`;

			if(pagingVO.searchType == null || pagingVO.searchType == ''){
				searchHtml += `checked`;
			}

			searchHtml += `
				/>
				<label class="btn btn-outline-primary" for="noticeAll">ì „ì²´</label>
			`;
			for(let i=0; i<noticeCodeVO.length; i++){
				let code = noticeCodeVO[i];
				searchHtml += `
					<input type="radio" class="btn-check" name="searchType" id="\${code.commCodeDetNo }" value="\${code.commCodeDetNo }"
				`;
				if(code.commCodeDetNo == pagingVO.searchType){
					searchHtml += `checked/>`;
				}else{
					searchHtml += `/>`;
				}
				searchHtml += `<label class="btn btn-outline-primary" for="\${code.commCodeDetNo }"><c:out value="\${code.description }" /></label>`;

			}
			searchHtml += `
				</form>
			`;

			$("#noticeSearchWarp").html(searchHtml);

			let date = new Date();
			let currentDay = date.getDate();

			let noticeListHtml = `
			<div class="noticeList-container">
			`;
			if(noticeList.length > 0 && noticeList != null){
				for(let i=0; i<noticeList.length; i++){
					let notice = noticeList[i];

					let noticeDate = new Date(notice.comuNotiRegDate);
					let noticeDay = noticeDate.getDate();

					let noticeRegDate = dateFormat(notice.comuNotiRegDate);
					noticeListHtml += `
					<div class="notice-container">
						<a href="/community/notice/post/\${notice.comuNotiNo }">
							<b><div>[\${notice.codeDescription} ]</div>`;
					if(noticeDay == currentDay){
						noticeListHtml += `<span class="newNotice">New</span>`;
					}
					noticeListHtml += `
							</b>
							<div class="noticeTitle-container">
								<span class="noticeTitle">\${notice.comuNotiTitle }</span>
								<div class="noticeDate">\${noticeRegDate}</div>
							</div>
						</a>
					</div>
					`;
				}
			}else{
				noticeListHtml += `
				<div class="noSearchPostList">
					<i class="bi bi-exclamation-circle"></i> ì¡°íšŒê°€ëŠ¥í•œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.
				</div>
				`;
			}
			noticeListHtml += `</div>`;

			$("#noticeList").html(noticeListHtml);

			$("#noticePagingArea").html(pagingVO.pagingHTML);

		},
		error : function(error){
			console.log(error.status);
		}
	})
}

$(function(){

	let fileMap = new Map();	// ì—…ë¡œë“œí•œ íŒŒì¼ ë‹´ì„ ê°ì²´
	let fileNum = 0;		// ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ìˆœë²ˆ

	let upFile = new Map();	// ìˆ˜ì • ì¤‘ ì—…ë¡œë“œí•œ íŒŒì¼ ë‹´ì„ ê°ì²´
	let upFileNum = 0;		// ìˆ˜ì • ì¤‘ ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ìˆœë²ˆ

	let deleteFileList = [];	// ì‚­ì œí•  íŒŒì¼ì˜ ìƒì„¸ë²ˆí˜¸
	let deleteFileGroupNo = new Map();	// ì‚­ì œí•  íŒŒì¼ì˜ ê·¸ë£¹ë²ˆí˜¸

	let likeFlag = false;	// ì¢‹ì•„ìš” ë²„íŠ¼ í´ë¦­ ì—¬ë¶€
	let oldLikeCount;		//
	let newLikeCount;

	let artistTabFlag = true;

	// ì´ˆê¸° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
	let first = {
		"artGroupNo" : $("#communityArtistGroupNo").val(),
	}
	artistPostList(first);
	// ì´ˆê¸° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë

	// ì•„í‹°ìŠ¤íŠ¸ íƒ­ í´ë¦­ ì‹œ
	$("#artistPost").on("click",function(){
		let newHash = "artistPostList";
		window.location.hash = newHash;
		artistTabFlag = true;
		console.log("ì•„í‹°ìŠ¤íŠ¸ ëª¨ë“œë¡œ ë³€ê²½ë¨")
		let data = {
			"artGroupNo" : $("#communityArtistGroupNo").val(),
			"artistTabYn" : artistTabFlag
		}
		artistPostList(data);

	});

	// íŒ¬íƒ­ í´ë¦­ ì‹œ
	$("#fanPost").on("click",function(){
		let newHash = "fanPostList";
		window.location.hash = newHash;
		artistTabFlag = false;
		console.log("íŒ¬ ëª¨ë“œë¡œ ë³€ê²½ë¨")
		let data = {
			"artGroupNo" : $("#communityArtistGroupNo").val(),
			"artistTabYn" : artistTabFlag
		}
		artistPostList(data);
	});

	// ìŠ¤ì¼€ì¤„ í´ë¦­ ì‹œ
	$("#schedule").on("click",function(){
		let newHash = "scheduleList";
		window.location.hash = newHash;
		let artGroupNo = $("#communityArtistGroupNo").val();
		fullCalendar(artGroupNo);
	});

	// ê³µì§€ì‚¬í•­ í´ë¦­ ì‹œ
	$("#noticeApt").on("click",function(){
		let newHash = "noticeAptList";
		window.location.hash = newHash;
		let data ={
			"artGroupNo" : $("#communityArtistGroupNo").val()
		}
		noticeList(data);
	});

	// ê²Œì‹œê¸€ ëŒ“ê¸€ ëª©ë¡ì—ì„œ í•˜íŠ¸ í´ë¦­ ì‹œ ë°˜ì˜
	$(".feedList").on("click","button[id=postListLike]" ,function(){
		console.log("123");
		let curLikeClass = $(this).children("i")[0].className;	// í´ë¦­í•œ í•˜íŠ¸ì˜ í´ë˜ìŠ¤ ì´ë¦„
		let curLikeCount = $(this).children("i").children("span")[0].innerHTML;	// í´ë¦­í•œ í•˜íŠ¸ì˜ ì¹´ìš´íŠ¸

		let updateCount;	// í´ë¦­ í›„ ë³€ê²½ë  ìˆ«ì ê°ì²´

		let pm = 0;
		if(curLikeClass == 'bi bi-heart'){		// í´ë¦­í•œ í•˜íŠ¸ì˜ í´ë˜ìŠ¤ê°€ bi bi-heart ë¼ë©´
			$(this).children("i")[0].className = "bi bi-heart-fill";
			updateCount = parseInt(curLikeCount) + 1;
			pm++;
		}else{		// í´ë¦­í•œ í•˜íŠ¸ì˜ í´ë˜ìŠ¤ê°€ bi bi-heart ë¼ë©´
			$(this).children("i")[0].className = "bi bi-heart";
			updateCount = parseInt(curLikeCount) - 1;
			pm--;
		}

		// ìƒˆë¡œìš´ ì¹´ìš´íŠ¸ ìˆ˜ í™”ë©´ìƒ ë°”ê¿”ì¤Œ
		$(this).children("i").children("span")[0].innerHTML = updateCount;

		// ì„ íƒí•œ í•˜íŠ¸ì— ë‹´ê¸´ ë°ì´í„°ë“¤ ê°€ì ¸ì˜´
		let boardTypeCode = $(this)[0].dataset.boardTypeCode;
		let comuPostNo = $(this)[0].dataset.comuPostNo;
		let artGroupNo = $("#communityArtistGroupNo").val()
		console.log(artGroupNo);

		// formdataë¡œ ë¬¶ì–´ì„œ likeUpdateë¡œ ë³´ëƒ„
		let data = new FormData();
		data.append("comuPostNo",comuPostNo);
		data.append("boardTypeCode",boardTypeCode);
		data.append("artGroupNo",artGroupNo);
		data.append("insertDelete", pm);

		likeUpdate(data);
	});

	// ê²Œì‹œê¸€ ëª©ë¡ì—ì„œ ìˆ˜ì •ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ
	$("#editPostModal").on("show.bs.modal",function(e){
		let postNum = e.relatedTarget.getAttribute('data-bs-postNum');
		updateModalInfo(postNum);
	});

	
	// ìˆ˜ì • ëª¨ë‹¬ì— ìˆëŠ” íŒŒì¼ ì˜ì—­ì— iíƒœê·¸ í´ë¦­ ì‹œ (íŒŒì¼ ì‚­ì œ)
	// ìˆ˜ì •ì¤‘111
	$("#editImgArea").on("click","button",function(){
		let pr = $(this).parent("div").remove();

		// ìˆ˜ì • ì´ë¯¸ì§€ ì˜ì—­ì— ì´ë¯¸ì§€ element
		let img = $(this).parent('div').find('img')[0];
		console.log("img : ", img);

		if(img.dataset.filenum != null){
			deleteFileList.push(img.dataset.filenum);	// ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì— ì‚­ì œí•œ íŒŒì¼ì˜ ìƒì„¸ë²ˆí˜¸ë¥¼ ë„£ìŒ
		}
		deleteFileGroupNo.set(img.dataset.filegroupno,deleteFileList);	// ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚­ì œí•  íŒŒì¼ì˜ ê·¸ë£¹ë²ˆí˜¸ë¥¼ í‚¤ë¡œ ì„¤ì •í•˜ê³  ì•ˆì— ì‚­ì œí•  íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë„£ìŒ
	});

	// ê²Œì‹œê¸€ ìˆ˜ì • ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#postUpdateBtn").on("click",function(){
		
		Swal.fire({
			title : 'ìˆ˜ì •ìš”ì²­',
			text : 'ì´ì „ì— ì‘ì„±ëœ ë‚´ìš©ì€ ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤. ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
			icon : 'question',
			showCancelButton : true,
			cancelButtonText : 'ì•„ë‹ˆì˜¤',
			confirmButtonText : 'ì˜ˆ',
		}).then((result) => {
			if(result.isConfirmed){
				// ì•„í‹°ìŠ¤íŠ¸ íƒ­ì¸ì§€ êµ¬ë¶„
				let tabCheck = $("#artistTabYn").val();
				if(tabCheck){
					let checkeded = $("#editPostMemberShipYn").is(':checked');
					$("#editMemberShipYn").val(checkeded);
				}

				let artGroupNo = $("#communityArtistGroupNo").val();

				if(deleteFileList != null && deleteFileList.length > 0){
					console.log(deleteFileList);
					$("#deleteFiles").val(deleteFileList);
				}

				// í¼ ë°ì´í„°ë¡œ ë³´ë‚´ì£¼ê¸° ìœ„í•¨
				let editPostForm = document.getElementById("editPostForm");

				let data = new FormData(editPostForm);

				$.ajax({
					url : "/community/update/post",
					type : "post",
					data : data,
					processData : false,
					contentType : false,
					success : function(res){
						if(res == "OK"){
							Swal.fire({
								title : 'ìˆ˜ì • ì„±ê³µ!',
								text : 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!',
								icon : 'success'
							}).then((result) => {
								$("#editPostModal").modal('hide');
								let data = {
									"artGroupNo" : $("#communityArtistGroupNo").val(),
									"artistTabYn" : artistTabFlag
								}
								artistPostList(data);
							});
						}else{
							Swal.fire({
								title : 'ìˆ˜ì • ì‹¤íŒ¨',
								text : 'ìˆ˜ì •ì´ ì‹¤íŒ¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤íŒ¨ ë°˜ë³µì‹œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜ë°”ëë‹ˆë‹¤.',
								icon : 'error'
							})
						}

					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				})
			}
		})

		
	});

	// ê²Œì‹œê¸€ ëª©ë¡ì—ì„œ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
	$(".feedList").on("click","a[id=delete]",function(e){
		e.preventDefault();
		console.log(e.target.dataset.bsPostnum);

		let postNum = e.target.dataset.bsPostnum;

		let artGroupNo = $("#communityArtistGroupNo").val();

		let data = new FormData();
		data.append("artGroupNo",artGroupNo);
		data.append("comuPostNo",postNum);

		Swal.fire({
			title : "ì‚­ì œ ìš”ì²­",
			text : 'ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œëœ ê²Œì‹œê¸€ì€ ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤',
			icon : "question",
			showCancelButton : true,
			cancelButtonText : "ì•„ë‹ˆì˜¤",
			confirmButtonText : "ì˜ˆ"
		}).then((result) => {
			if(result.isConfirmed){
				$.ajax({
					url : "/community/delete/post/" + postNum,
					type : "post",
					data : data,
					contentType : false,
					processData : false,
					success : function(res){
						if(res == "OK"){
							Swal.fire({
								title : 'ì‚­ì œ ì™„ë£Œ',
								text : 'ì •ìƒì ìœ¼ë¡œ ì‚­ì œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.',
								icon : "success"
							})

							let param = {
								"artGroupNo" : $("#communityArtistGroupNo").val(),
								"artistTabYn" : artistTabFlag
							}

							artistPostList(param);
						}else{
							alert("ê²Œì‹œê¸€ì´ ì‚­ì œê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
						}
					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				})
			}
		});

	});


	// ë‹«ê¸° ë²„íŠ¼ í–‰ë™ì œì–´
	$("#editPostModal").on("shown.bs.modal",function(e){
		console.log("ì—´ë¦´ ë–„ e : ", e.relatedTarget.getAttribute("data-bs-categroy"));
		let editBtnInfo = e.relatedTarget.getAttribute("data-bs-categroy");
		let closeBtn = $("#editPostModal").find("button[id=postUpdateCloseBtn]");

		// ìƒì„¸ ëª¨ë‹¬ì—ì„œ ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ì•„ë˜ì˜ ì†ì„±ì„ ì¶”ê°€ ì‹œì¼œì¤Œìœ¼ë¡œ ë‹«ê¸° ë²„íŠ¼ ëˆŒë €ì„ ë–„
		// ë‹¤ì‹œ ìƒì„¸ëª¨ë‹¬ì´ ì˜¤í”ˆë¨
		if(editBtnInfo === 'detailEdit'){
			$("#editPostModal").children("div[class=modal-footer]").children("button[class=btn-secondary]");
			console.log($("#editPostModal").find("button[id=postUpdateCloseBtn]"));
			closeBtn.attr("data-bs-target","#detailPostModal");
			closeBtn.attr("data-bs-toggle","modal");
		}else{
			// ë°›ì•„ì˜¨ editBtnInfoê°€ detailEditì´ ì•„ë‹ˆë¼ë©´ í•´ë‹¹ ì†ì„±ì„ ë„£ì—ˆë˜ ê±¸ ì§€ì›Œì¤Œ
			closeBtn.removeAttr("data-bs-target");
			closeBtn.removeAttr("data-bs-toggle");
		}
	});
	
	// ìˆ˜ì •ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#postUpdateCloseBtn").on("click",function(){
		updatePostModalClose();
	});
	
	// ìˆ˜ì •ëª¨ë‹¬ í—¤ë” ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#editPostModalHeaderCloseBtn").on("click",function(){
		updatePostModalClose();
	});
	
	// ë“±ë¡ ëª¨ë‹¬ì—ì„œ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#addPostModalCloseBtn").on("click",function(){
		insertPostModalClose();
	});
	
	// ë“±ë¡ëª¨ë‹¬ í—¤ë” xë²„íŠ¼ í´ë¦­ ì‹œ
	$("#insertModalHeaderCloseBtn").on("click",function(){
		insertPostModalClose();
	});

	// ëŒ“ê¸€ ì‘ì„±
	$("#replyBtn").on("click", function(e){
		e.preventDefault();
		let content = $("#comuReplyContent");
		if(content.val().trim() == null || content.val().trim() == ""){
			Swal.fire({
				title : 'ì‘ì„± í•„ìš”!',
				text : 'ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.',
				icon : 'warning'
			});
			return false;
		}

		let detailModal = document.getElementById("detailPostModal");
		let myDetailModal = bootstrap.Modal.getInstance(detailModal);

		myDetailModal.hide();

		let replyForm = document.getElementById("replyForm");

		let data = new FormData(replyForm);

		$.ajax({
			url : "/community/reply/insert",
			type : "post",
			data : data,
			processData : false,
			contentType : false,
			success : function(res){
				console.log(res);
				if(res.result == "OK"){

					let data = {
						"artGroupNo" : $("#communityArtistGroupNo").val(),
						"artistTabYn" : artistTabFlag
					}

					artistPostList(data);

					let detailModalReOpen = document.getElementById("detailPostModal");
					console.log(detailModalReOpen);
					let detailModal = new bootstrap.Modal(detailModalReOpen);
					console.log(detailModal);
					let postNum = res.replyVO.comuPostNo;

					openDetailModal(postNum);

					detailModal.show();

				}
			},
			error : function(error){
				console.log(error.status);
			},
			beforeSend : function(xhr) {
		        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
		    }
		});
	});

	// ìƒì„¸ ëª¨ë‹¬ì°½ ì—´ë ¸ì„ ì‹œ
	$("#detailPostModal").on("show.bs.modal",function(e){
		console.log("ìƒì„¸ e : " , e);

		$("#replyForm").children("div.text-right.pt-2").children("span.pt-1").children(".cmt-sub-size").text("0")
		$("#comuReplyContent").val("");
		$("#replyList").html("");
		$("#detailImgArea").html("");

		let postNum;
		if(e.relatedTarget){
			postNum = e.relatedTarget.getAttribute('data-bs-postNum')
			openDetailModal(postNum);
		}
	})

	// ìƒì„¸ëª¨ë‹¬ ì—´ë¦¬ê³  ë‚˜ì„œì˜ í–‰ë™
	$("#detailPostModal").on("shown.bs.modal",function(){

		$("#postBox").on("click","#delete",function(){
			console.log($(this)[0].dataset.comuPostNo);
			Swal.fire({
				title : "ì‚­ì œ ìš”ì²­",
				text : 'ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œëœ ê²Œì‹œê¸€ì€ ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.',
				icon : 'question',
				showCancelButton : true,
				cancelButtonText : 'ì•„ë‹ˆì˜¤',
				confirmButtonText : 'ì˜ˆ'
			}).then((result) => {
				if(result.isConfirmed){
					let postNum = $(this)[0].dataset.comuPostNo;

					let artGroupNo = $("#communityArtistGroupNo").val();

					let data = new FormData();
					data.append("artGroupNo",artGroupNo);
					data.append("comuPostNo",postNum);

					$.ajax({
						url : "/community/delete/post/" + postNum,
						type : "post",
						data : data,
						contentType : false,
						processData : false,
						success : function(res){
							if(res == "OK"){
								Swal.fire({
									title : 'ì‚­ì œ ì™„ë£Œ',
									text : 'ì •ìƒì ìœ¼ë¡œ ì‚­ì œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.',
									icon : "success"
								}).then((result) => {
									let param = {
										"artGroupNo" : $("#communityArtistGroupNo").val(),
										"artistTabYn" : artistTabFlag
									}

									artistPostList(param);

									$("#detailPostModal").modal('hide');
								})
							}else{
								alert("ê²Œì‹œê¸€ì´ ì‚­ì œê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
							}
						},
						error : function(error){
							console.log(error.status);
						},
						beforeSend : function(xhr) {
					        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
					    }
					})
				}
			});
		});

		// ëŒ“ê¸€ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
		let replyDeleteBtnList = document.querySelectorAll("#replyDeleteBtn");
		replyDeleteBtnList.forEach(btn => {
			btn.addEventListener("click",function(e){
				e.preventDefault();
				Swal.fire({
					title : 'ì‚­ì œìš”ì²­',
					text : "ì‚­ì œì‹œ ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.",
					icon : 'question',
					showCancelButton : true,
					cancelButtonText : 'ì•„ë‹ˆì˜¤',
					confirmButtonText : 'ì˜ˆ'
				}).then((result) =>{
					if(result.isConfirmed){
						let detailModal = document.getElementById("detailPostModal");
						let myDetailModal = bootstrap.Modal.getInstance(detailModal);

						myDetailModal.hide();

						let test = e.target.dataset.comuReplyNo;
						let postNo = e.target.dataset.postNo;
						let replyNo = e.target.dataset.comuReplyNo;

						let data = new FormData();
						data.append("replyNo", replyNo)
						$.ajax({
							url : "/community/reply/delete",
							type : "post",
							data : data,
							contentType : false,
							processData : false,
							success : function(res){
								console.log(res)
								if(res == 'OK'){
									Swal.fire({
										title : 'ì‚­ì œ ì„±ê³µ',
										text : 'ëŒ“ê¸€ì´ ì •ìƒì ìœ¼ë¡œ ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
										icon : 'success'
									})

									let data = {
										"artGroupNo" : $("#communityArtistGroupNo").val(),
										"artistTabYn" : artistTabFlag
									}

									artistPostList(data);

									let detailModalReOpen = document.getElementById("detailPostModal");
									let detailModal = new bootstrap.Modal(detailModalReOpen);

									openDetailModal(postNo);

									detailModal.show();
								}
							},
							error : function(error){
								console.log(error.status);
							},
							beforeSend : function(xhr) {
						        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
						    }
						});
					}
				});


			})
		});

		oldLikeCount = $(this).find("#likeCount").html();
		console.log("ì²˜ìŒ ì¢‹ì•„ìš” ìˆ˜ : ", oldLikeCount);

		$("#likeButton").on("click", function(){
			console.log("ëˆ„ë¦„");
			likeFlag = true;
			likeBtn($(this));
		});

	});

	// ìƒì„¸ ëª¨ë‹¬ ë‹«í˜”ì„ ì‹œ ì¢‹ì•„ìš”ì— ë³€í™”ê°€ ìˆì„ ì‹œ
	$("#detailPostModal").on("hide.bs.modal",function(e){
		console.log("ë‹«ì•˜ì„ ë•Œ : ", e);
		console.log(e.currentTarget);
		console.log("í˜„ì¬ : ", $(this).find("#likeCount").html());

		newLikeCount = $(this).find("#likeCount").html();

		let comuPostNo = $(this).find("#comuPostNo").val();
		let boardTypeCode = $(this).find("#boardTypeCode").val();
		let artGroupNo = $("#communityArtistGroupNo").val();

		// ê¸°ì¡´ì˜ ì¢‹ì•„ìš” ìˆ˜ê°€ 40ì´ë¼ê³  ê°€ì •
		// ì•¡ì…˜ 1. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆ„ë¥´ì§€ ì•Šê³  ì°½ì„ ë‹«ì„ ë•Œ ì¢‹ì•„ìš” ìˆ˜ ë³€í™”ê°€ ì—†ìŒ
		// ì•¡ì…˜ 2. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì°½ì„ ë‹«ì„ ë•Œ ì¢‹ì•„ìš” ìˆ˜ëŠ” +1ì¸ ìƒíƒœ ê·¸ë˜ì„œ ì°½ì„ ë‹«ì„ ë•Œ 41ì´ ë˜ì–´ ìˆìŒ. ì´ì „ì— ìˆë˜ ì¢‹ì•„ìš” ìˆ˜ë³´ë‹¤ ìƒˆë¡œìš´ ì¢‹ì•„ìš” ìˆ˜ê°€ ë” ë†’ê¸°ì— pMì— 1ì´ ë“¤ì–´ê°€ ìˆìŒ
		// ì•¡ì…˜ 3. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ì·¨ì†Œí•˜ê³  ì°½ì„ ë‹«ì„ ë–„ ì¢‹ì•„ìš” ìˆ˜ëŠ” -1ì¸ìƒíƒœ ê·¸ë˜ì„œ ì°½ì„ ë‹«ì„ ë•Œ 39ê°€ ë˜ì–´ ìˆìŒ. ì´ì „ì— ìˆë˜ ì¢‹ì•„ìš” ìˆ˜ê°€ ë” ë†’ê¸°ì— pMì— -1ì´ ë“¤ì–´ê°€ ìˆìŒ
		let pM = 0;
		if(oldLikeCount == newLikeCount){
			pM = 0;
		}else if(oldLikeCount > newLikeCount){
			pM = -1;
		}else if(oldLikeCount < newLikeCount){
			pM = +1;
		}
		console.log("ê³„ì‚° : ", pM)

		if(likeFlag){	// ì¢‹ì•„ìš”ê°€ ë³€ê²½ì´ ë˜ì—ˆë‹¤ë©´
			let data = new FormData();
			data.append("comuPostNo",comuPostNo);
			data.append("boardTypeCode",boardTypeCode);
			data.append("artGroupNo",artGroupNo);
			data.append("insertDelete", pM);

			likeUpdate(data);
		}

	});

	// ê¸€ ë“±ë¡ ì‹œ
	$("#postSendBtn").on("click",function(){
		Swal.fire({
			title : 'ë“±ë¡ ìš”ì²­',
			text : 'ê²Œì‹œê¸€ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
			icon : 'question',
			showCancelButton : true,
			confirmButtonText : 'ì˜ˆ',
			cancelButtonText : 'ì•„ë‹ˆì˜¤'
		}).then((result) => {
			if(result.isConfirmed){
				let checkeded = $("#postMemberShipYn").is(':checked');
				$("#memberShipYn").val(checkeded);
				let postForm = document.getElementById("postForm");

				let artGroupNo = $("#comuArtGroupNo").val();

				let data = new FormData(postForm);

				$.ajax({
					url : "/community/insert/post",
					type : "post",
					data : data,
					processData : false,
					contentType : false,
					success : function(res){
						if(res == 'OK'){
							Swal.fire({
								title : 'ì €ì¥ì™„ë£Œ!',
								text : 'ê²Œì‹œê¸€ì´ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!',
								icon : 'success'
							});
							$("#insertPostModal").modal('hide');

							let data = {
								"artGroupNo" : $("#communityArtistGroupNo").val(),
								"artistTabYn" : artistTabFlag
							}

							artistPostList(data);

						}else{
							alert("ê¸€ ë“±ë¡ ì‹¤íŒ¨")
						}
					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				});
			}
		});

	});


	// ê²€ìƒ‰ì— ìˆëŠ” ì•„í‹°ìŠ¤íŠ¸ í´ë¦­ ì‹œ
	$("#artistFeedSearchWrap").on("click", "input[name=artistNm]", function(){
		$(this).val();
		console.log($(this).val())
		let data = {
			"artGroupNo" : $("#communityArtistGroupNo").val(),
			"searchType" : $(this).val(),
			"searchWord" : $("#artistFeedSearchInput").val(),
			"artistTabYn" : artistTabFlag
		}
		artistPostList(data);
	});

	// ì•„í‹°ìŠ¤íŠ¸ íƒ­ ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
	$("#artistFeedSearchWrap").on("click", "input[id=searchFormBtn]", function(){
		console.log($("input[name=artistNm]:checked").val())
		let searchType = $("input[name=artistNm]:checked").val();
		let data = {
			"artGroupNo" : $("#communityArtistGroupNo").val(),
			"searchType" : searchType,
			"searchWord" : $("#artistFeedSearchInput").val(),
			"artistTabYn" : artistTabFlag
		}
		artistPostList(data);
	});

	$("#fanFeedSearchWrap").on("click", "input[id=searchFormBtn]", function(){
		let data = {
			"artGroupNo" : $("#communityArtistGroupNo").val(),
			"searchWord" : $("#fanFeedSearchInput").val(),
			"artistTabYn" : artistTabFlag
		}
		artistPostList(data);
	});

	const hash = window.location.hash;
	if(hash){
		if(hash == '#scheduleList'){
			const schedule = new bootstrap.Tab(document.getElementById('schedule'));
						schedule.show();
						$("#schedule").click()
		}
		if(hash == '#fanPostList'){
			const fanPost = new bootstrap.Tab(document.getElementById('fanPost'));
			fanPost.show();
			$("#fanPost").click();

		}
		if(hash == '#artistPostList'){
			const artistPost = new bootstrap.Tab(document.getElementById('artistPost'));
						artistPost.show();
						$("#artistPost").click();
		}
		if(hash == '#noticeAptList'){
			const noticeApt = new bootstrap.Tab(document.getElementById('noticeApt'));
						noticeApt.show();
						$("#noticeApt").click();
		}
	}


	console.log("codeMap : ", ${codeMap})

	console.log("í˜„ì¬ ê²½ë¡œ : ", window.location.pathname);

	let pathname = window.location.pathname;
	let path = pathname.split('/');

	console.log(path);

	if(path[2] == 'live'){
		let artGroupNo = $("#communityArtistGroupNo").val();

		$("#live").attr("class","tab-item active");

		$("#liveList").addClass("show active");

	}

	// ì•Œë¦¼ í´ë¦­ìœ¼ë¡œ ë¼ì´ë¸Œ íƒ­ ì§„ì… ì‹œ ì²˜ë¦¬
	if(window.location.hash === '#liveArea') {
		console.log("ì•Œë¦¼ í´ë¦­ìœ¼ë¡œ ë¼ì´ë¸Œ íƒ­ ì§„ì… ê°ì§€");

		// í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ë¼ì´ë¸Œ íƒ­ í™œì„±í™”
		$(document).ready(function() {
			setTimeout(() => {
				// Bootstrap íƒ­ í™œì„±í™”
				const liveTab = new bootstrap.Tab(document.getElementById('live'));
				liveTab.show();

				// URL í•´ì‹œ ì œê±° (ê¹”ë”í•œ URL ìœ ì§€)
				history.replaceState(null, null, window.location.pathname);
			}, 100);
		});
	}



	// ì´ë¯¸ì§€ ì˜ì—­ ê°€ì ¸ì˜¤ê¸°
	let area = $("#imgArea");

	$("#insertPostFile").on("change",function(e){
		console.log($(this).val());

		let files = e.target.files;

	    let fileArr = [];

		let html = ``;
		for(let i=0; i<files.length; i++){
			let file = files[i];
			fileArr.push(file.name);

			fileMap.set(fileNum.toString(),file);

			let reader = new FileReader();
    		reader.onload = function(e){
    			html += `
					<div class="imgDiv">
						<img src="\${e.target.result}"  data-fileNum='\${fileNum}' >
							<button class="imgDeleteBtn" id="imgDeleteBtn">
								<i class="bi bi-x-lg"></i>
							</button>
						</img>
					</div>
					`;
        		fileNum++;
			$("#imgArea").html(html);
    		}
    		reader.readAsDataURL(file);
		}

		// íŒŒì¼ëª… ë…¸ì¶œë°©ë²•2: ë°°ì—´ ê°’ë“¤ì„ ì¤„ë°”ê¿ˆí•˜ì—¬ í‘œì‹œ
		var fileList = fileArr.join(', ');
		$(this).siblings('#fileName').val(fileList);

	});

	// ì´ë¯¸ì§€ ì‚­ì œ ì‹œ files mapì— ì‚­ì œ
	area.on("click","button",function(){
		let pr = $(this).parent("div").remove();
		let cur = $(this).parent("div").children('img')[0].dataset.filenum;

		files.delete(cur);

	});


	// ë“±ë¡ ëª¨ë‹¬ ì—´ë ¸ì„ ì‹œ
	$("#insertPostModal").on("show.bs.modal",function(){
		if(artistTabFlag){
			$("#postForm").children("label[for=memberShipYn]").attr("style","display:block");
			$("#postForm").children("input[name=boardTypeCode]").val('ARTIST_BOARD');
			$("#postForm").children("input[name=artistTabYn]").val('true');
			let tabCheck = $("#artistTabYn").val();

			if(tabCheck){
				$("#postMemberShipYn").prop("checked",false);
			}
		}else{
			console.log($("#postForm").children("label[for=memberShipYn]"));
			$("#postForm").children("label[for=memberShipYn]").attr("style","display:none");
			$("#postForm").children("input[name=boardTypeCode]").val('FAN_BOARD');
			$("#postForm").children("input[name=artistTabYn]").val('false');
		}

		$("#comuPostContent").val("");
		$("#insertPostFile").val("");
		$("#imgArea").html("");
		$("#fileName").val("");

		let content = document.getElementById("comuPostContent");
		contentLengthCheck(content);
	});

	// ìˆ˜ì • ëª¨ë‹¬ ë‹«ì•˜ì„ ì‹œ
	$("#editPostModal").on("hide.bs.modal",function(){
		$("#editImgArea").html("");
		let tabCheck = $("#artistTabYn").val();
		if(tabCheck){
			$("#editPostMemberShipYn").prop("checked",false);
		}
		$("#editInsertPostFile").val("");
	});



	// ìˆ˜ì • ëª¨ë‹¬ì—ì„œ íŒŒì¼ ì„ íƒ í´ë¦­ ì‹œ
	$("#editInsertPostFile").on("change",function(e){
		console.log("ìˆ˜ì • ì´ë¯¸ì§€ ì¶”ê°€ë¨")
		let files = e.target.files;

		for(let i=0; i<files.length; i++){
			let file = files[i];

			fileMap.set(fileNum.toString(),file);

			let reader = new FileReader();
    		reader.onload = function(e){
    			let html = `
					<div class="imgDiv">
						<img src="\${e.target.result}"  data-fileNum='\${fileNum}' >
							<button class="imgDeleteBtn" id="imgDeleteBtn">
								<i class="bi bi-x-lg"></i>
							</button>
						</img>
					</div>
				`;
        		fileNum++;
				$("#editImgArea").append(html);
    		}
    		reader.readAsDataURL(file);
		}

	});

	$("#reportModal").on("show.bs.modal",function(e){
		console.log("ì‹ ê³  ëª¨ë‹¬ ì—´ë¦¼ / ê²Œì‹œíŒ ë²ˆí˜¸ : " + e.relatedTarget.getAttribute('data-bs-whatever'));
		console.log("ë³´ë“œìœ í˜• : " + e.relatedTarget.getAttribute('data-bs-boardType'));

		let postNo = e.relatedTarget.getAttribute('data-bs-whatever');
		let boardType = e.relatedTarget.getAttribute('data-bs-boardType');
		let comuProfileNo = e.relatedTarget.getAttribute('data-bs-comuProfileNo');
		let comuNick = e.relatedTarget.getAttribute('data-bs-comuNick');
		let comuContent = e.relatedTarget.getAttribute('data-bs-comuContent');
		let selectType = e.relatedTarget.getAttribute('data-bs-selectType');
		let comuReplyNo = e.relatedTarget.getAttribute('data-bs-comuReplyNo');

		console.log("boardType:", boardType);

		let code = ${codeMap};
		let reasonCode = code.reasonCode;
		let reportStatCode = code.reportStatCode;
		let reportTarCode = code.reportTarCode;
		console.log(code);

		let targetCode;

		let info = {
			"postNo" : postNo,
			"boardType" : boardType,
			"comuProfileNo" : comuProfileNo,
			"reasonCode" : reasonCode,
			"reportTarCode" : selectType,
			"comuNick" : comuNick,
			"comuContent" : comuContent,
			"comuReplyNo" : comuReplyNo
		};
		reportModalInfo(info);

	});


	$("#reportSendBtn").on("click",function(){

		Swal.fire({
			title : 'ì‹ ê³ ',
			text : 'ë³¸ ì‹ ê³ ëŠ” ìš´ì˜ ì •ì±…ì— ë”°ë¼ ì²˜ë¦¬ë˜ë©°, ì‹ ê³  ë‚´ìš©ì´ ì„œë¹„ìŠ¤ ì•½ê´€ì— ìœ„ë°°ë  ê²½ìš° í•´ë‹¹ ê²Œì‹œë¬¼ ë˜ëŠ” ì‚¬ìš©ìëŠ” ì ì ˆí•œ ì¡°ì¹˜ë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤. ë¶€ì ì ˆí•œ ì‹ ê³ ëŠ” ì²˜ë¦¬ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
			footer : 'í—ˆìœ„ ì‹ ê³  ì‹œ ì„œë¹„ìŠ¤ ì´ìš©ì— ë¶ˆì´ìµì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì‹ ê³ í•´ì£¼ì„¸ìš”.',
			icon : 'warning',
			showCancelButton : true,
			cancelButtonText : 'ì·¨ì†Œ',
			confirmButtonText : 'ì‹ ê³ '
		}).then((result) => {
			if(result.isConfirmed){
				let reportForm = document.getElementById("reportForm");

				let data = new FormData(reportForm);
				console.log(data)
				$.ajax({
					url : "/community/send/report",
					type : "post",
					data : data,
					contentType : false,
					processData : false,
					success : function(res){
						if(res == 'OK'){
							Swal.fire({
								title : 'ì ‘ìˆ˜ ì™„ë£Œ',
								text : 'ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ë¹ ë¥¸ ì‹œì¼ ë‚´ ì¡°ì¹˜í•˜ê² ìŠµë‹ˆë‹¤!',
								icon : 'success'
							});
							$("#reportModal").modal('hide');
						}else if(res == 'EXIST'){
							Swal.fire({
								text : 'ì´ë¯¸ ì‹ ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.',
								icon : 'error'
							});
							$("#reportModal").modal('hide');
						}
					},
					error : function(error){
						console.log(error.status);
					},
					beforeSend : function(xhr) {
				        xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}');
				    }
				});
			}
		});
	});

	$("#reportModal").on("hide.bs.modal",function(e){
		$("#targetComuReplyNo").val("");
	});

	$("#scheduleModal").on("show.bs.modal",function(e){
		console.log(e);
		let flag = true;	// ìƒì„¸ì¼ì •ì´ë¼ëŠ” ì˜ë¯¸

		let modalTitle = $("#title");		// ìƒì„¸ ëª¨ë‹¬ ì œëª©
    	let modalContent = $("#content");	// ìƒì„¸ ëª¨ë‹¬ ë‚´ìš©
    	let modalPlace = $("#place");		// ìƒì„¸ ëª¨ë‹¬ ì¥ì†Œ
    	let modalUrl = $("#dateUrl");		// ìƒì„¸ ëª¨ë‹¬
    	let modalTextColor = $("#textColor");	// ìƒì„¸ ëª¨ë‹¬ ì œëª© ìƒ‰ìƒ
    	let modalBackgroundColor = $("#backgroundColor");	// ì¼ì • ë°°ê²½ ìƒ‰
    	let modalDateId = $("#dateId");		// ì¼ì • ë²ˆí˜¸
    	let link = $("#datelink");			// urlíƒœê·¸
    	let modalAllDayStatus = $("#allDayStatus");

    	let twolDayDiv = $("div[class=notAllDaySchedule]");
    	let oneDayDiv = $("div[class=allDaySchedule]");
    	let modalStartDate = $("#startDate");
    	let modalEndDate = $("#endDate");
    	let allDate = $("#allDate");

		let target = e.relatedTarget;

		console.log("ìƒì„¸ëª¨ë‹¬", twolDayDiv);

		let { title, url, textColor, backgroundColor, id, allDay, startStr, endStr, start, end } = target.event;
		let { allDayStatus, content, place } = target.event.extendedProps;
		console.log(target.event);
		modalTitle.val(title);
    	modalContent.html(content);
    	modalPlace.val(place);
    	modalUrl.val(url);
    	modalTextColor.val(textColor);
    	modalBackgroundColor.val(backgroundColor);
    	modalDateId.val(id);
    	modalAllDayStatus.val(allDayStatus)

    	link.attr("href",url);
    	link.html(title+"ë°”ë¡œê°€ê¸°");

    	if(allDay){
    		$("#allDayStatus").prop("checked",true);

    		if(endStr == null || end == null){
    			endStr = startStr;
    			oneDayDiv.attr("style","display:block");
    			allDate.val(startStr)
    		}else{
    			twolDayDiv.attr("style","display:block")
	    		modalStartDate.val(startStr);
	    		modalEndDate.val(endStr);
    		}

    	}else{
    		$("#allDayStatus").prop("checked",false);
    		twolDayDiv.attr("style","display:block");
    		let formatStart = scheduleDateFormat(start);
    		let formatEnd = scheduleDateFormat(end);
    		modalStartDate.val(formatStart);
    		modalEndDate.val(formatEnd);
    	}
	});

	$("#scheduleModal").on('hide.bs.modal',function(){
		let twolDayDiv = $("div[class=notAllDaySchedule]");
    	let oneDayDiv = $("div[class=allDaySchedule]");

    	twolDayDiv.attr("style","display:none");
    	oneDayDiv.attr("style","display:none");
	});

	$("#noticeSearchWarp").on("click","input[id=noticeSearchFormBtn]",function(){
		let searchType = $("#noticeSearchForm input[name=searchType]:checked").val();
		console.log(searchType);
		let data = {
			"searchType" : searchType,
			"searchWord" : $("#noticeSearchWord").val(),
			"artGroupNo" : $("#communityArtistGroupNo").val()
		}

		noticeList(data);
	});

	$("#noticeSearchWarp").on("click", "input[name=searchType]", function(){
		let data = {
			"searchType" : $(this).val(),
			"searchWord" : $("#noticeSearchWord").val(),
			"artGroupNo" : $("#communityArtistGroupNo").val()
		}
		noticeList(data);
	});

// 	let postArea = document.getElementByClassName("apt-content-area");
// 	$(".apt-content-area").scroll(function() {
//         // ìŠ¤í¬ë¡¤ì´ í˜ì´ì§€ í•˜ë‹¨ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ì¡°ê±´
// //         console.log("ë¬¸ì„œ ì „ì²´ ë†’ì´ : ", (document).height()) // ë¬¸ì„œ ì „ì²´ ë†’ì´
//         console.log("í˜„ì¬ ìŠ¤í¬ë¡¤ë°”ì˜ ìœ„ì¹˜ : ", (window).scrollTop()) // í˜„ì¬ ìŠ¤í¬ë¡¤ë°”ì˜ ìœ„ì¹˜
//         console.log("í˜„ì¬ ë¸Œë¼ìš°ì € ì°½ì˜ ë†’ì´ : ", (window).height()) // í˜„ì¬ ë¸Œë¼ìš°ì € ì°½ì˜ ë†’ì´

// //         if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) { // 100px ì—¬ìœ  ê³µê°„
// //             // ìŠ¤í¬ë¡¤ì´ í•˜ë‹¨ì— ë„ë‹¬í•˜ë©´ ë‹¤ìŒ í˜ì´ì§€ ë¡œë“œ
// //         }
//     });

	$("#artistFeedList").on("click",'a[id=postLink]',function(e){
		e.preventDefault();
		console.log("ì„¤ë§ˆ?", e)
		console.log("ì„¤ë§ˆ?", $(this))
		let membershipYn = $(this)[0].getAttribute('data-bs-membershipBlur');

		if(membershipYn == 'Y'){
			Swal.fire({
				title : 'ë©¤ë²„ì‹­ ì „ìš©',
				text : 'í•´ë‹¹ ê²Œì‹œê¸€ì„ ë©¤ë²„ì‹­ ì „ìš© ê²Œì‹œë¬¼ì…ë‹ˆë‹¤. ë©¤ë²„ì‹­ ê°€ì… í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
				icon : 'error'
			})
		}
	})
	

	


	$("#test").on("click",function(){
		$("#postDetailModal").modal('show');
	});


	// íŒ”ë¡œìš° ê¸°ëŠ¥
	// íŒ”ë¡œìš°ë²„íŠ¼
	let followFlag = "${followFlag}" != 'N' ? true : false;
	let followToggleBtn = $("#followToggleBtn"); // íŒ”ë¡œìš° ë²„íŠ¼

	followToggleBtn.on("click",function(){
		if(followFlag){
			Swal.fire({
				   title: 'íŒ”ë¡œìš°ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
				   text: 'ì·¨ì†Œ í›„ ì¬ ê°€ì…ì‹œ ê¸°ì¡´ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
				   icon: 'warning',

				   showCancelButton: true, // cancelë²„íŠ¼ ë³´ì´ê¸°. ê¸°ë³¸ì€ ì›ë˜ ì—†ìŒ
				   confirmButtonColor: '#3085d6', // confrim ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
				   cancelButtonColor: '#d33', // cancel ë²„íŠ¼ ìƒ‰ê¹” ì§€ì •
				   confirmButtonText: 'í™•ì¸', // confirm ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •
				   cancelButtonText: 'ì·¨ì†Œ', // cancel ë²„íŠ¼ í…ìŠ¤íŠ¸ ì§€ì •

				}).then(result => {
				   // ë§Œì•½ Promiseë¦¬í„´ì„ ë°›ìœ¼ë©´,
				    if(result.isConfirmed) { // ë§Œì•½ ëª¨ë‹¬ì°½ì—ì„œ confirm ë²„íŠ¼ì„ ëˆŒë €ë‹¤ë©´
				    	let comuProfileNo = "${userProfile.comuProfileNo}";
				    	let artGroupNo = "${userProfile.artGroupNo}";
				    	let memUsername = "${userProfile.memUsername}";
				    	let data = {
				    			comuProfileNo : comuProfileNo,
				    			artGroupNo : artGroupNo,
				    			memUsername : memUsername,
				    	}
				    	// íŒ”ë¡œìš° ì·¨ì†Œ
				    	$.ajax({
				    		url : "/api/community/removeapt",
				    		type : "post",
				    		contentType : "application/json; charset=utf-8",
				    		data : JSON.stringify(data),
				    		beforeSend : function(xhr){
								xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
							},
				    		success : function(res){
				    			location.reload();
				    		},
				    		error : function(err){
				    			console.log(err);
				    			sweetAlert("error","ì·¨ì†Œ ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!");
				    		}
				    	});

				    }
				});
		}else{
			$("#commProfileModal").modal("show");
		}
	})

	if(!followFlag){
		let followBtn = $("#followBtn");	// ì˜¤ë²„ë ˆì´ìª½ íŒ”ë¡œìš° ë²„íŠ¼
		let commProfileModal = $("#commProfileModal"); // ì»¤ë®¤ë‹ˆí‹° í”„ë¡œí•„ ìƒì„± ëª¨ë‹¬
		let previewImgBox = $("#previewImgBox"); //ë¯¸ë¦¬ë³´ê¸°ì´ë¯¸ì§€ë°•ìŠ¤
		let imgFile = $("#imgFile"); // ì´ë¯¸ì§€ ì²¨ë¶€ íŒŒì¼
		let previewImg = $("#previewImg"); // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€
		let comuNicknm = $("#comuNicknm"); // ë‹‰ë„¤ì„ í•„ë“œ
		let file = null;	// íŒŒì¼ ì—†ìœ¼ë©´ null
		let profileSubmitBtn = $("#profileSubmitBtn"); // ë‹‰ë„¤ì„ ë“±ë¡ ë²„íŠ¼

		followBtn.on("click",function(){
			commProfileModal.modal("show");
		});

		// í”„ë¡œí•„ ì´ë¯¸ì§€ ë°•ìŠ¤ í´ë¦­ì‹œ ì´ë¯¸ì§€íŒŒì¼ ì„ íƒ
		previewImgBox.on("click",function(){
			imgFile.click();
		})

		// í”„ë¡œí•„ ì´ë¯¸ì§€ ì´ë²¤íŠ¸
		imgFile.on("change",function(){
			const defaultPath = "${pageContext.request.contextPath}/upload/profile/base/defaultImg.png";
			const maxSize = 2 * 1024 * 1024;
			file = this.files[0];

			if(file == null){
				previewImg.attr("src", defaultPath);
				return false;
			}

			if(file.size > maxSize){
				sweetAlert("error", "íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 2MB ë¯¸ë§Œìœ¼ë¡œ ì„ íƒí•´ì£¼ì„¸ìš”!");
				$(this).val("");
				file = null;
				previewImg.attr("src", defaultPath);
				return false;
			}

			if(!file.type.startsWith("image/")){
				sweetAlert("error", "ì´ë¯¸ì§€íŒŒì¼ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”");
				$(this).val("");
				file = null;
				previewImg.attr("src", defaultPath);
				return false;
			}

			let fileReader = new FileReader();
			fileReader.onload = function(e){
				previewImg.attr("src", e.target.result);
			};

			fileReader.readAsDataURL(file);
		})

		profileSubmitBtn.on("click",function(){
			let comuNicknmVal = comuNicknm.val();
			if(comuNicknmVal == null || comuNicknmVal.trim() == ''){
				sweetAlert("error","ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
				return false;
			}
			if(comuNicknmVal.length > 12){
				sweetAlert("error","ë‹‰ë„¤ì„ì€ 12ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”");
				return false;
			}

			let formData = new FormData();
			let artGroupNo = "${artistGroupVO.artGroupNo}";
			let memUsername = "${user.username}";
			formData.append("artGroupNo",artGroupNo);
			formData.append("memUsername",memUsername);
			formData.append("comuNicknm", comuNicknmVal);
			if(file != null){
				formData.append("imgFile", file);
			}
			joinCommunity(formData);
		})
	}
	$("#commProfileModal").on("hide.bs.modal",function(){
		$("#comuNicknm", $(this)).val("");
		$("#previewImg").attr("src","${pageContext.request.contextPath}/upload/profile/base/defaultImg.png");
		$("#imgFile").val("");

	})

	function joinCommunity(formData){
		$.ajax({
			url : '/api/community/joinapt',
			type : "post",
			processData : false,
			contentType : false,
			data : formData,
			beforeSend : function(xhr){
				xhr.setRequestHeader('${_csrf.headerName}', '${_csrf.token}')
			},
			success : function(res){
				location.reload();
			},
			error : function(err){
				console.log(err);
				sweetAlert("error","íŒ”ë¡œìš° í•˜ëŠ” ë„ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”!");
			}
		});
	}

	let myProfile = $("#myProfile"); // ë§ˆì´í”„ë¡œí•„ ì—˜ë¦¬ë¨¼íŠ¸
	myProfile.on("click",function(){
		let artGroupNo = "${artistGroupVO.artGroupNo}";
		let comuProfileNo = $(this).data("comuProfileNo");
		location.href = `${pageContext.request.contextPath}/community/\${artGroupNo}/profile/\${comuProfileNo}`;
	});


	// ëª¨ë‹¬ ìˆ˜ì • ë¶€ë¶„
	// feedItem í´ë¦­ì‹œ ëª¨ë‹¬ ì˜¤í”ˆ
// 	$(".feed-item-content").each((i,v) => {
// 		$(v).on("click",function(){
// 			let postNum = $(this).data("postId");

// 			openDetailModal(postNum);
// 			$("#detailPostModal").modal("show");
// 		})
// 	});
});
function contentLengthCheck(ele){
	let size = ele.value.length;
	let text = ele.value;
	if(size > 1000){
		alert("ê¸€ ì‘ì„±ì€ 1000ì ì´ìƒì„ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		let subText = text.substring(0,1000);
		ele.value = subText;
		$(ele).parents("form").find(".cmt-sub-size").text(subText.length);
		return false;
	}

	$(ele).parent("form").find(".cmt-sub-size").text(size);
}

function replyContentLengthCheck(ele){
	let size = ele.value.length;
	let text = ele.value;
	console.log($(ele).parents("#replyForm").children("div.text-right.pt-2").children("span.pt-1").children(".cmt-sub-size"))
	if(size > 300){
		Swal.fire({
			title : 'ì…ë ¥ ì´ˆê³¼!',
			text : 'ëŒ“ê¸€ì€ 300ì ì´ˆê³¼ ì‘ì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
			icon : 'error'
		});
		let subText = text.substring(0,300);
		ele.value = subText;
		$(ele).parents("#replyForm").children("div.text-right.pt-2").children("span.pt-1").children(".cmt-sub-size").text(subText.length);
		return false;
	}

	$(ele).parents("#replyForm").children("div.text-right.pt-2").children("span.pt-1").children(".cmt-sub-size").text(size);
}



function scheduleDateFormat(jsonDate){
	if (!jsonDate) return "";
	let date = new Date(jsonDate);
	let month = date.getMonth() + 1;
    let day = date.getDate();
    let hour = date.getHours();
    let minute = date.getMinutes();
    let second = date.getSeconds();

    month = month >= 10 ? month : '0' + month;
    day = day >= 10 ? day : '0' + day;
    hour = hour >= 10 ? hour : '0' + hour;
    minute = minute >= 10 ? minute : '0' + minute;
    second = second >= 10 ? second : '0' + second;

    return month + '-' + day + ' ' + hour + ':' + minute;
}



/* let info = {
"postNo" : postNo,
"boardType" : boardType,
"comuProfileNo" : comuProfileNo,
"reasonCode" : reasonCode,
"reportTarCode" : reportTarCode,
"comuNick" : comuNick,
"comuContent" : comuContent
"comuReplyNo" : comuReplyNo
}; */

function reportModalInfo(info){
	console.log("ì²˜ë¦¬í•˜ê¸° : " + info)
// 	<input type="radio" class="btn-check" name="options-outlined" id="success-outlined" autocomplete="off" checked>
// 	<label class="btn btn-outline-primary" for="success-outlined">Checked success radio</label>

// 	<input type="radio" class="btn-check" name="options-outlined" id="danger-outlined" autocomplete="off">
// 	<label class="btn btn-outline-danger" for="danger-outlined">Danger radio</label>
	let postNo = info.postNo;
	let boardType = info.boardType;
	let comuProfileNo = info.comuProfileNo;
	let reasonCodeList = info.reasonCode;
	let reportTarCode = info.reportTarCode;
	let artGroupNo = $("#communityArtistGroupNo").val();
	let comuReplyNo = info.comuReplyNo;

	console.log(reportTarCode)

	let targetNick = info.comuNick;

	let targetContent = info.comuContent;

	let radioHtml = ``;
	for(let i=0; i<reasonCodeList.length; i++){
		let reasonCode = reasonCodeList[i];
		radioHtml += `
			<input type="radio" class="btn-check" name="reportReasonCode" id="\${reasonCode.commCodeDetNm}" value="\${reasonCode.commCodeDetNo}" autocomplete="off">
		 	<label class="btn btn-outline-primary" for="\${reasonCode.commCodeDetNm}">\${reasonCode.description}</label>
		`;
	}

	$(".radioArea").html(radioHtml);

	$("#targetNick").val(targetNick);
	$("#targetContent").html(targetContent);

	$("#targetComuPostNo").val(postNo);
	$("#targetBoardTypeCode").val(boardType);
	$("#reportArtGroupNo").val(artGroupNo);
	$("#targetComuProfileNo").val(comuProfileNo);
	$("#reportTargetTypeCode").val(reportTarCode);

	if(comuReplyNo != null){
		$("#targetComuReplyNo").val(comuReplyNo);
	}

	console.log("íƒ€ê²Ÿ ì½”ë“œ : ", reportTarCode);
}

function updateModalInfo(postNum){
	$.ajax({
		url : "/community/post/get/" + postNum,
		type : "get",
		success : function(res){
			console.log("ìˆ˜ì • ëª¨ë‹¬ì— ë“±ë¡ ë  ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì§€ê³  ì˜´",res);

			$("#postNum").val(res.comuPostNo);

			$("#editComuPostContent").text(res.comuPostContent);

			let content = document.getElementById("editComuPostContent");
			contentLengthCheck(content);

			$("#fileGroupNo").val(res.fileGroupNo);
			console.log("ê°€ì§€ê³  ì˜¨ ì •ë³´ ì¤‘ íŒŒì¼ ê·¸ë£¹ë²ˆí˜¸ë¥¼ fileGroupNoì•„ì´ë””ë¥¼ ê°€ì§„ inputì˜ íˆë“  íƒ€ì…ì— ê°’ì„ ë„£ì–´ì¤Œ fileGroupNo : ", res.fileGroupNo);

			if(res.artistTabYn){
				if(res.memberShipYn){
					$("#editPostMemberShipYn").prop("checked",true);
				}
				$("#checkBoxMbs").attr("style", "display:block");
			}else{
				$("#checkBoxMbs").attr("style", "display:none");
			}

			let html = ``;
			if(res.postFiles != null && res.postFiles.length > 0){
				for(let i=0; i<res.postFiles.length; i++){
					let postFile = res.postFiles[i];
					html += `
						<div class="imgDiv">
							<img src="\${postFile.webPath}"  data-fileNum='\${postFile.attachDetailNo}' >
								<button class="imgDeleteBtn" id="imgDeleteBtn">
									<i class="bi bi-x-lg"></i>
								</button>
							</img>
						</div>
					`;
				}
			}


			$("#editImgArea").append(html);


		},
		error : function(error){
			console.log(error.status);
		}
	});
}

//ëª¨ë‹¬ ìˆ˜ì • ë¶€ë¶„
function openDetailModal(postNum){

	console.log("postNum: ", postNum)
	let artGroupNo = $("#communityArtistGroupNo").val();

	let data = new FormData();
	data.append("artGroupNo",artGroupNo);
	data.append("comuPostNo",postNum )

	$.ajax({
		url : "/community/post/detail/" + postNum,
		type : "get",
		data : {
			"artGroupNo" : artGroupNo,
			"comuPostNo" : postNum
		},
		success : function(res){
			console.log("ìƒì„¸ì •ë³´ ìš”ì²­í•¨ : " , res);
			// ì‘ì„±ì ì •ë³´
			let writer = res.writerProfile;
			let {comuProfileImg : writerImg, comuNicknm : writerNick, comuProfileNo:writerComuProfileNo} = writer;
			let userProfileNo = 0;
				if("${not empty userProfile}"){
					userProfileNo = "${userProfile.comuProfileNo}"
				}
			// ê²Œì‹œíŒ ì •ë³´
			let {comuPostContent:content,postFiles,boardTypeCode
				,comuPostNo,likeYn, comuPostRegDate:regDate
				,comuPostModDate : modDate
				,comuPostLike : likeCount, comuPostReplyList, comuPostReplyCount} = res

			console.log("comuPostReplyCount : ", comuPostReplyCount);

			$("#comuPostNo").val(comuPostNo);
			$("#boardTypeCode").val(boardTypeCode);

			let likeIcon = $("#likeBtn").children('i');
			let likeClass;
			if(likeYn == 'Y'){
				likeClass = "bi bi-suit-heart-fill";
			}else{
				likeClass = "bi bi-suit-heart";
			}
			likeIcon.attr("class",likeClass);

			let date;
			if(regDate === modDate){
				date = dateFormat(regDate);
			}else{
				date = dateFormat(modDate) + "(ìˆ˜ì •ë¨)";
			}

			let postHtml = ``;
			postHtml = `
				<div class="post-pane-header">
                	<div class="d-flex align-items-center">
                        <img src="\${writerImg}" class="rounded-circle" width="50px" style="height:50px;">
                        <div class="ms-2">
                            <strong class="d-block">\${writerNick}</strong>
                            <small class="text-muted">\${date}</small>
                        </div>
                	</div>
                	<div class="dropdown">
				        <button class="btn btn-link text-secondary p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
				            <i class="bi bi-three-dots-vertical"></i>
				        </button>
				        <ul class="dropdown-menu"
				`;
			if(writerComuProfileNo == userProfileNo){
				postHtml += `
					<li><button class="dropdown-item" data-bs-target="#editPostModal" data-bs-toggle="modal" data-bs-dismiss="modal" data-bs-postNum="\${postNum}" id="edit" data-bs-categroy="detailEdit">ìˆ˜ì •</button></li>
		            <li><button class="dropdown-item" data-comu-post-no="\${postNum}" id="delete"  >ì‚­ì œ</button></li>
				`;
			}else{
				postHtml += `
					<li><button class="dropdown-item text-danger" data-comu-post-no="\${postNum}"
						data-bs-toggle="modal" data-bs-target="#reportModal"
							data-bs-whatever="\${postNum }"
						data-bs-boardtype="\${boardTypeCode}"
						data-bs-comuprofileno="\${writerComuProfileNo}"
						data-bs-comunick="\${writerNick}"
						data-bs-comucontent="\${content}"
						data-bs-selecttype="RTTC001">ì‹ ê³ </button></li>
				`;
			}
			postHtml += `
				        </ul>
				    </div>
                </div>
                <div class="post-pane-body">
                `;
            if(postFiles != null && postFiles.length > 0){
            	postHtml += `<div class="detailImgContainer">`;
            	for(let file of postFiles){
            		postHtml += `
            			<div class="detailImg">
            				<img src="\${file.webPath}" alt="\${file.fileOriginalNm}" width="150px" height="150px">
            			</div>
            		`;
            	}
            	postHtml +=`</div>`;
            }
            postHtml += `
                	<p>\${content}<p>
                </div>
                <div class="post-pane-footer">
                `;
            if(likeYn == 'Y'){
            postHtml += `
				    <button type="button" class="btn btn-like active" data-comu-post-no="\${postNum}" data-comu-profile-no="\${userProfileNo}" id="likeButton">
				        <i class="bi bi-heart-fill"></i>
				        <span id="likeCount">\${likeCount}</span>
				    </button>
            	`;
            }else{
            	postHtml += `
				    <button type="button" class="btn btn-like" data-comu-post-no="\${postNum}" data-comu-profile-no="\${userProfileNo}" id="likeButton">
				        <i class="bi bi-heart"></i>
				        <span id="likeCount">\${likeCount}</span>
				    </button>
            	`;
            }
            postHtml +=`
				</div>
			`;

			$("#postBox").html(postHtml);

			$("#replyCount").html("ë‹µê¸€ " + comuPostReplyCount + "ê°œ");

			// ëŒ“ê¸€ ì˜ì—­
			let replyHtml = ``;
			for(let reply of comuPostReplyList){
				let {comuReplyContent, comuReplyRegDate, comuReplyNo, replyMember, comuReplyModDate} = reply;
				let {comuProfileImg, comuNicknm, comuProfileNo:replyComuProfileNo} = replyMember;
				replyHtml += `
					<div class="comment-item">
		            <img src="\${comuProfileImg}" class="rounded-circle comment-avatar">
		            <div class="comment-main-wrapper">
		            	<div class="comment-header">
		            		<strong>\${comuNicknm}</strong>
		            		<div class="dropdown">
						        <button class="btn btn-link text-secondary p-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
						            <i class="bi bi-three-dots-vertical"></i>
						        </button>
						        <ul class="dropdown-menu">
					`;
					if(userProfileNo == replyComuProfileNo){
						replyHtml += `
				            <li><button class="dropdown-item" data-comu-reply-no="\${comuReplyNo}" data-post-no="\${comuPostNo}" id="replyDeleteBtn">ì‚­ì œ</button></li>
						`;
					}else{
						replyHtml += `
							<li><button class="dropdown-item text-danger"
								data-bs-toggle="modal"
								data-bs-target="#reportModal"
								data-bs-whatever="\${comuPostNo}"
								data-bs-comuReplyNo="\${comuReplyNo}"
								data-bs-boardType="\${boardTypeCode}"
								data-bs-comuProfileNo="\${replyComuProfileNo}"
								data-bs-comuNick="\${comuNicknm}"
								data-bs-comuContent="\${comuReplyContent}"
								data-bs-selectType="RTTC002"
								>ì‹ ê³ </button></li>
						`;
					}
					replyHtml += `
										</ul>
						            </div>
						        </div>
						        <div class="comment-body-text"> <p>\${comuReplyContent}</p>
						            <small class="text-muted">\${dateFormat(comuReplyModDate)}</small>
						        </div>
						    </div>
						</div>
					`;
			}
			$("#replyList").html(replyHtml);

			$("#boardTypeCode",$("#postBox")).val(boardTypeCode);
			$("#comuPostNo",$("#postBox")).val(comuPostNo)

		},
		error : function(error){
			console.log(error.status);
		}
	});
}

function insertPostModalClose(){
	Swal.fire({
		title : 'ì‘ì„± ì·¨ì†Œ ìš”ì²­',
		text : 'ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì •ë§ë¡œ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
		icon : 'question',
		showCancelButton : true,
		cancelButtonText : 'ì•„ë‹ˆì˜¤',
		confirmButtonText : 'ì˜ˆ'
	}).then((result) => {
		if(result.isConfirmed){
			$("#insertPostModal").modal('hide')
		}
	});
}

function updatePostModalClose(){
	Swal.fire({
		title : 'ìˆ˜ì •ì·¨ì†Œ ìš”ì²­',
		text : 'ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì •ë§ë¡œ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
		icon : 'question',
		showCancelButton : true,
		cancelButtonText : 'ì•„ë‹ˆì˜¤',
		confirmButtonText : 'ì˜ˆ'
	}).then((result) => {
		if(result.isConfirmed){
			$("#editPostModal").modal('hide')
		}
	});
}

</script>
<script src="${pageContext.request.contextPath}/resources/js/pages/live/apt-community.js"></script>
<script>
$(document).ready(function() {
    // í˜ì´ì§€ì— ë¼ì´ë¸Œ ì •ë³´ ì¹´ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
    const liveCard = $('.card[data-broadcast-id]');
    if (liveCard.length > 0) {
        const mediaServerUrl = $('#mediaServerUrl').val(); // mediaServerUrl ê°’ ê°€ì ¸ì˜¤ê¸°
        const socket = new SockJS(`${mediaServerUrl}/ws`);
        const stompClient = Stomp.over(socket);

        stompClient.connect({}, function(frame) {
            console.log('ë©”ì¸ í˜ì´ì§€ - ë¯¸ë””ì–´ ì„œë²„ STOMP ì—°ê²° ì„±ê³µ');

            // í˜ì´ì§€ì— ìˆëŠ” ëª¨ë“  ë¼ì´ë¸Œ ì¹´ë“œì— ëŒ€í•´ ê°ê° êµ¬ë… ì„¤ì •
            liveCard.each(function() {
                const broadcastId = $(this).data('broadcast-id');

                stompClient.subscribe('/topic/viewers/' + broadcastId, function(message) {
                    const data = JSON.parse(message.body);
                    // IDë¡œ ì •í™•í•œ span íƒœê·¸ë¥¼ ì°¾ì•„ ë‚´ìš© ì—…ë°ì´íŠ¸
                    $('#viewer-count-' + broadcastId).text(data.viewerCount);
                });
            });
        });
    }
});
</script>
</body>
</html>