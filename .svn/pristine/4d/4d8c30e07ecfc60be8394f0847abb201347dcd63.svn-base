<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>블랙리스트 관리 - DDTOWN 관리자</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .current-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 6px;
            font-size: 0.95em;
        }
        .current-info strong {
            color: #333;
        }
        .emp-form .form-group textarea#blacklistReasonText {
            min-height: 150px;
        }
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="emp-content">
                <section id="blacklistReasonFormSection" class="ea-section active-section">
                    <div class="ea-section-header">
                        <h2 id="blacklistFormTitle">블랙리스트 사유 상세</h2>
                    </div>

                    <div class="current-info">
                        <p><strong>대상 회원 ID:</strong> <span id="targetUserId">${blacklist.memUsername }</span></p>
                        <p><strong>현재 지정 사유:</strong>
                           <span id="currentBlacklistReason">
                           <c:choose>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC001'}">스팸</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC002'}">욕설</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC003'}">음란물</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC004'}">기타</c:when>
                            </c:choose>
                           </span>
                       </p>
                    </div>

                    <form class="ea-form" id="blacklistReasonForm">
                        <input type="hidden" id="blacklistRecordId" name="blacklistRecordId">
                        <input type="hidden" id="targetMemberIdHidden" name="targetMemberId">

                        <div class="form-group">
                            <label for="blacklistReasonText">추가 사항 및 상세</label>
                            <span>${blacklist.banReasonDetail }</span>
                        </div>

                        <div class="form-group-group" style="display: flex; gap: 16px; align-items: flex-end;">
                            <div class="form-group" style="flex:1;">
                                <label for="blacklistReleaseDate">정지 기간</label>
                                 <li><strong>차단 시작 일시:</strong><c:set value="${fn:split(blacklist.banStartDate, ' ')}" var="banStartDate"/> ${banStartDate[0]}</li> 
		                    	<li><strong>차단 해제 일시:</strong><c:set value="${fn:split(blacklist.banEndDate, ' ')}" var="banEndDate"/> ${banEndDate[0]}</li>
                            </div>                           
                        </div>
                        <label for="blacklistReleaseDate">차단 담당자</label>
                        <span>${blacklist.empUsername }</span>
                        <div class="ea-form-actions">
                            <a href="/admin/community/blacklist/list" class="ea-btn outline">목록</a>
                            <button type="submit" class="ea-btn success" id="delBtn">
                            	<i class="fas fa-undo"></i>즉시 해제
                            </button>
                            <form action="/admin/community/blacklist/delete"  method="post" id="delForm">
								<input type="hidden" name="banNo" value="${blacklist.banNo}" />		                   
		                   		<sec:csrfInput/>
							</form>
                            <button type="submit" class="ea-btn primary" id="saveBlacklistReasonBtn"><a href="/admin/community/blacklist/modForm?banNo=${blacklist.banNo }">수정</a></button>
                        </div>
                    </form>
                </section>
            </main>
        </div>
    </div>
<%@ include file="../../modules/footerPart.jsp" %>

<%@ include file="../../modules/sidebar.jsp" %>     
 <script>
      
   	// 페이지네이션 로직
      const pagingArea = $('#pagingArea');
      if(pagingArea.length > 0) {
          pagingArea.on('click', 'a', function(event) { 
              event.preventDefault();
              const page = $(this).data('page');
              
              // 현재 URL에서 검색 파라미터 유지
              const currentSearchUrl = new URL(window.location.href);
              const searchType = currentSearchUrl.searchParams.get("searchType");
              const searchWord = currentSearchUrl.searchParams.get("searchWord");

              let targetPageUrl = '${pageContext.request.contextPath}/emp/artist/artist-management?page=' + page;

              if (searchType && searchWord) {
                  targetPageUrl += '&searchType=' + encodeURIComponent(searchType);
                  targetPageUrl += '&searchWord=' + encodeURIComponent(searchWord);
              }
              window.location.href = targetPageUrl;
          });
      }
let delBtn = $("#delBtn");
let delForm = $("#delForm");
      
delBtn.on("click", function(){
  
  
       	  delForm.submit();
         

})
</script>
</body>
</html> 