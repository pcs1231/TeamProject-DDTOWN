<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<%@ taglib uri="jakarta.tags.core" prefix="c" %>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN - 오디션 일정 상세페이지</title>
    
    <%@ include file="../../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="<%=request.getContextPath()%>/resources/css/pages/audition_management_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <style type="text/css">
    	main{
    		padding: 25px;
    		width: 85%;
    	}
    </style>
</head>
<body>
     <div class="emp-container">
        <%@ include file="../../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../../modules/aside.jsp" %>
<!--  main  -->        
			<main>
				<section class="audition-detail-hero">
		            <div class="container">
		                <h2>오디션 상세정보</h2>
		            </div>
		        </section>
				
				<section class="audition-detail-section">
		            <div class="container">
		                <div class="audition-detail-header">
		                    <span class="audition-status recruiting">
		                    	<c:choose>
	                       			<c:when test="${audition.audiStatCode eq 'ADSC001'}">진행중</c:when>
	                       			<c:when test="${audition.audiStatCode eq 'ADSC002'}">마감</c:when>
	                       			<c:when test="${audition.audiStatCode eq 'ADSC003'}">예정됨</c:when>
	                       		</c:choose>
		                    </span>
		                    <h3 class="audition-detail-title">${audition.audiTitle }</h3>
		                </div>
		                <ul class="audition-detail-meta">
		                    <li><strong>모집 분야:</strong>
		                    	<c:choose>
	                       			<c:when test="${audition.audiTypeCode eq 'ADTC001'}">보컬</c:when>
	                       			<c:when test="${audition.audiTypeCode eq 'ADTC002'}">댄스</c:when>
	                       			<c:when test="${audition.audiTypeCode eq 'ADTC003'}">연기</c:when>
		                    	</c:choose></li>
		                    <li><strong>지원 접수 시작일:</strong><c:set value="${fn:split(audition.audiStartDate, ' ')}" var="auditionStartDate"/> ${auditionStartDate[0]}</li>
		                    <li><strong>지원 접수 마감일:</strong><c:set value="${fn:split(audition.audiEndDate, ' ')}" var="auditionEndDate"/> ${auditionEndDate[0]}</li>
			                <li><strong>공고 등록일시:</strong><c:set value="${fn:split(audition.audiRegDate, ' ')}" var="auditionRegDate"/> ${auditionRegDate[0] }</li>
			                <li><strong>공고 수정일시:</strong><c:set value="${fn:split(audition.audiModDate, ' ')}" var="auditionModDate"/> ${auditionModDate[0] }</li>
		                </ul>
		                <div class="audition-detail-content">
		                    <h4>오디션 내용</h4>
		                   <p>
		       				 ${fn:replace(audition.audiContent, '-', '<br><br>-')}
		    				</p>
		                </div>
		                
		                <div class="audition-detail-attachments">
		                <c:if test="${audition.fileGroupNo ne null}">
						    <h4>첨부파일</h4>
						    <ul class="list-unstyled">
						    	<c:if test="${not empty audition.fileList}">
						    		<c:forEach var="file" items="${audition.fileList}">
							    		<li>
								            <a href="<c:url value='/Emp/Audition/download.do'>
								            	 <c:param name='attachDetailNo' value='${file.attachDetailNo}'/>
								            	 </c:url>" class="attachment-link">
								                <i class="fas fa-file-pdf"></i>
								                 ${file.fileOriginalNm}
								            </a>
							        	</li>
						    		</c:forEach>						
						    	</c:if>
						        <c:if test="${empty audition.fileList}">
							        <li>첨부된 파일이 없습니다.</li>
							    </c:if>
						    </ul>
						</c:if>
		                </div>
		                <div class="audition-detail-actions">
		                    <a href="${pageContext.request.contextPath}/emp/audition/schedule" class="btn btn-secondary">
		                        <i class="fas fa-list"></i> 목록
		                    </a>
		                   <!--  작성자만 보이기 -->
		                    <sec:authentication property="principal.username" var="currentUsername" />
		                    <c:if test="${currentUsername eq audition.empUsername}">
		                    <a href="/emp/audition/updateForm.do?audiNo=${audition.audiNo }" class="btn btn-primary">
		                        <i class="fas fa-pen"></i> 수정하기
 		                    </a>&nbsp;<button type="submit" class="btn btn-primary" id="delBtn">삭제</button>
							<form action="/emp/audition/delete.do"  method="post" id="delForm">
							<input type="hidden" name="audiNo" value="${audition.audiNo}" />
		                   
		                   <sec:csrfInput/>
							</form>
							</c:if>
		                </div>
		            </div>
		        </section>
			</main>  
		    </div>
		<footer class="emp-footer">
			<p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (직원 전용)</p>
		</footer>
	</div>
<!-- 수정 성공시 알림창 -->	
	<script>
    $(function(){
        <c:if test="${not empty message}">
        var message = "${message}"; // 컨트롤러에서 넘어온 message 값을 JavaScript 변수에 할당

        if (typeof swal === 'function') {
            swal({
                title: "알림",
                text: message,
                icon: "success",
                button: "확인",
            });
        }
    </c:if>
    });
    </script>
</body>
<%@ include file="../../../modules/footerPart.jsp" %>

<%@ include file="../../../modules/sidebar.jsp" %>
<script src="schedule_management.js">

let delBtn = $("#delBtn");
let delForm = $("#delForm");

delBtn.on("click", function(){
	delForm.attr("action", "/emp/audition/delete.do");
	delForm.attr("method", "get");
	delForm.submit();
})




</script> 
</html>