<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>블랙리스트 관리 - DDTOWN 관리자</title>
	<li>
    
</li>
    <%@ include file="../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .current-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 6px;
            font-size: 0.95em;
        }
        .current-info strong {
            color: #333;
        }
        .emp-form .form-group textarea#blacklistReasonText {
            min-height: 150px;
        }
.status-badge {
 	display: inline-block; /* 텍스트 내용만큼 너비 차지 */
    padding: 4px 10px;    /* 내부 여백 (위아래 4px, 좌우 10px) */
    border-radius: 20px;  /* 모서리를 둥글게 (값이 클수록 더 둥글게) */
    font-size: 0.9em;     /* 글자 크기 */
    font-weight: bold;    /* 글자 두껍게 */
    margin-left: 10px;    /* 제목 옆에 붙이기 위한 왼쪽 여백 */
    vertical-align: middle; /* 세로 정렬 (텍스트와 중앙 맞춤) */
}

/* 활성 상태 스타일 - 초록색 테두리와 글자 */
.status-active {
    background-color: #20c997; /* 밝은 청록색 */
    color: #ffffff;           /* 흰색 글자 */
}

/* 비활성 상태 스타일 - 회색 테두리와 글자 */
.status-inactive {
    background-color: #dc3545; /* 빨간색 (부트스트랩의 danger 색상과 유사) */
    color: #ffffff;            /* 흰색 글자 */
}
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>
            <main class="emp-content">
                <section id="blacklistReasonFormSection" class="ea-section active-section">
                    <div class="ea-section-header">
                        <h2 id="blacklistFormTitle">블랙리스트 사유 상세<c:choose>
					            <c:when test="${blacklist.banActYn eq 'N'}">
					                <span class="status-inactive">비활성</span>
					            </c:when>
					            <c:when test="${blacklist.banActYn eq 'Y'}">
					                <span class="status-active">활성</span>
					            </c:when>
					        </c:choose>
					    </h2>
                    </div>

                    <div class="current-info">
                        <p><strong>대상 회원 ID:</strong> <span id="targetUserId">${blacklist.memUsername }</span></p>
                        <p><strong>현재 지정 사유:</strong>
                           <span id="currentBlacklistReason">
                           <c:choose>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC001'}">스팸</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC002'}">욕설</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC003'}">음란물</c:when>
                              	<c:when test="${blacklist.banReasonCode eq 'BRC004'}">기타</c:when>
                            </c:choose>
                           </span>
                       </p>
                    </div>

                    <form class="ea-form" id="blacklistReasonForm">
                        <input type="hidden" id="blacklistRecordId" name="blacklistRecordId">
                        <input type="hidden" id="targetMemberIdHidden" name="targetMemberId">

                        <div class="form-group">
                            <label for="blacklistReasonText">추가 사항 및 상세</label>
                            <span>${blacklist.banReasonDetail }</span>
                        </div>

                        <div class="form-group-group" style="display: flex; gap: 16px; align-items: flex-end;">
                            <div class="form-group" style="flex:1;">
                                <label for="blacklistReleaseDate">정지 기간</label>
                                 <li><strong>차단 시작 일시:</strong><c:set value="${fn:split(blacklist.banStartDate, ' ')}" var="banStartDate"/> ${banStartDate[0]}</li> 
		                    	<li><strong>차단 해제 일시:</strong><c:set value="${fn:split(blacklist.banEndDate, ' ')}" var="banEndDate"/> ${banEndDate[0]}</li>
                            </div>                           
                        </div>
                        <label for="blacklistReleaseDate">차단 담당자</label>
                        <span>${blacklist.empUsername }</span>
                        <div class="ea-form-actions">
                            <a href="/admin/community/blacklist/list" class="ea-btn outline">목록</a>
                            <button type="button" class="ea-btn success" id="delBtn">
                            	<i class="fas fa-undo"></i>즉시 해제
                            </button>
                            <button type="button" class="ea-btn primary" id="modBtn">수정</button>
                        </div>
                    </form>
                    <form action="/admin/community/blacklist/delete"  method="post" id="delForm">
						<input type="hidden" name="banNo" value="${blacklist.banNo}" />		                   
		                <sec:csrfInput/>
					</form>
                </section>
            </main>
        </div>
    </div>
<%@ include file="../../modules/footerPart.jsp" %>

<%@ include file="../../modules/sidebar.jsp" %>  
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
 <script>
 $(function(){
	 $("#modBtn").on("click", function(){
	        location.href = "/admin/community/blacklist/modForm?banNo=${blacklist.banNo }";
	    });
 })
      
   	// 페이지네이션 로직
      const pagingArea = $('#pagingArea');
      if(pagingArea.length > 0) {
          pagingArea.on('click', 'a', function(event) { 
              event.preventDefault();
              const page = $(this).data('page');
              
              // 현재 URL에서 검색 파라미터 유지
              const currentSearchUrl = new URL(window.location.href);
              const searchType = currentSearchUrl.searchParams.get("searchType");
              const searchWord = currentSearchUrl.searchParams.get("searchWord");

              let targetPageUrl = '${pageContext.request.contextPath}/emp/artist/artist-management?page=' + page;

              if (searchType && searchWord) {
                  targetPageUrl += '&searchType=' + encodeURIComponent(searchType);
                  targetPageUrl += '&searchWord=' + encodeURIComponent(searchWord);
              }
              window.location.href = targetPageUrl;
          });
      }
let delBtn = $("#delBtn");
let delForm = $("#delForm");
      
delBtn.on("click", function(){ 
	console.log("버튼 클릭됨!");
	delForm.submit();
})
//알림 관련 
$(function(){
    const message = "${message}";
    console.log("Flash Message:", message);
    if (message && message !== "") {
        Swal.fire({
            icon: 'success',
            title: '알림',
            text: message,
            showConfirmButton: true
        });
    }
    $("#cntArea").html(html);
	console.log(${cntMap})
});
</script>
</body>
</html> 