<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec"%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDTOWN 관리자 - 아티스트 계정 관리</title>
    <%@ include file="../../modules/headerPart.jsp" %>
    <style>
        /* admin_portal.css에 정의된 스타일을 최대한 활용합니다. */
        /* 아티스트명 링크 스타일 */
        .artist-name-link {
            font-weight: 500;
            color: #007bff; /* 기본 링크 색상 */
            text-decoration: none;
        }
        .artist-name-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="emp-container">
        <%@ include file="../modules/header.jsp" %>

        <div class="emp-body-wrapper">
            <%@ include file="../modules/aside.jsp" %>

			<c:set var="memberVO" value="${artistVO.memberVO }"/>
            <main class="emp-content">
                <section id="artistDetailSection" class="ea-section">
                    <div class="ea-section-header">
                        <h2 id="artistDetailNameTitle">아티스트 상세 정보</h2>
                        <div class="ea-header-actions">
                            <a href="/admin/community/artist/update?artNo=${artistVO.artNo }" class="ea-btn outline sm" id="editArtistBtn"><i class="fas fa-edit"></i> 정보 수정</a>
                            <form action="/admin/community/artist/deleteArtist" method="post" id="deleteForm">
                            	<input type="hidden" name="artNo" value="${artistVO.artNo }">
                            	<input type="hidden" name="memUsername" value="${artistVO.memUsername }">
                            	<sec:csrfInput/>
	                            <button type="button" class="ea-btn danger sm" id="deleteArtistBtn"><i class="fas fa-trash-alt"></i>정보 삭제</button>                            	
                            </form>
                            <button type="button" class="ea-btn primary sm" id="listBtn"><i class="fas fa-list"></i> 목록으로</button>
                        </div>
                    </div>

                    <div class="artist-detail-profile">
                        <img src="${artistVO.artProfileImg }" alt="아티스트 프로필 이미지" class="profile-image" id="detailArtistProfileImage">
                        <div class="profile-info">
                            <h2 id="detailArtistDisplayName">
                                </h2>
                            <p class="artist-id-display">아티스트 ID: <span id="detailArtistSystemId">${artistVO.memUsername }</span></p>
                            <p class="group-name-display">소속 그룹: <span id="detailArtistGroupName">
                            	<c:forEach items="${artistVO.groupList }" var="group">
                            		${group.artGroupNm }
                            	</c:forEach>
                            </span> 
                            <span class="status-badge" id="detailArtistStatus"></span></p>
                            <p>데뷔일: <span id="detailArtistDebutDate">${artistVO.artGroupDebutdate }</span></p>
                            <p>담당자: <span id="detailArtistManager">${artistVO.empName }</span></p>
                        </div>
                    </div>
                    
                    <div class="detail-card artist-description-view">
                        <h3>아티스트 소개</h3>
                        <div id="detailArtistDescription">
                            <p>아티스트 명: <span>${artistVO.artNm}</span></p>
                            <p>아티스트 소개: <span>${artistVO.artContent}</span></p>
                            <p>아티스트 성별: <span>${memberVO.peoGender eq 'M' ? '남성' : '여성'}</span></p>
                            <p>아티스트 이메일: <span>${memberVO.peoEmail}</span></p>
                            <p>아티스트 생일: <span>${memberVO.memBirth}</span></p>
                            <p>아티스트 본명: <span>${memberVO.peoName}</span></p>
                        </div>
                    </div>

                </section>
            </main>
        </div>

        <footer class="emp-footer">
            <p>&copy; 2025 DDTOWN Entertainment. All rights reserved. (관리자 전용)</p>
        </footer>
    </div>
</body>
<%@ include file="../../modules/footerPart.jsp" %>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
	const navItemsWithSubmenu = document.querySelectorAll('.emp-sidebar .emp-nav-item.has-submenu');
	navItemsWithSubmenu.forEach(item => {
		const arrow = item.querySelector('.submenu-arrow');
		item.addEventListener('click', function(event) {
			if (this.getAttribute('href') === '#') {
			    event.preventDefault();
			}
			const parentLi = this.parentElement;
			const submenu = this.nextElementSibling;
		
			if (submenu && submenu.classList.contains('emp-submenu')) {
				const parentUl = parentLi.parentElement;
				if (parentUl) {
					Array.from(parentUl.children).forEach(siblingLi => {
						if (siblingLi !== parentLi) {
							const siblingSubmenuControl = siblingLi.querySelector('.emp-nav-item.has-submenu.open');
							if (siblingSubmenuControl) {
								const siblingSubmenu = siblingSubmenuControl.nextElementSibling;
								siblingSubmenuControl.classList.remove('open');
								if (siblingSubmenu && siblingSubmenu.classList.contains('emp-submenu')) {
								    siblingSubmenu.style.display = 'none';
								}
								const siblingArrow = siblingSubmenuControl.querySelector('.submenu-arrow');
								if (siblingArrow) siblingArrow.style.transform = 'rotate(0deg)';
							}
						}
					});
				}
			}
		
			this.classList.toggle('open');
			if (submenu && submenu.classList.contains('emp-submenu')) {
				submenu.style.display = this.classList.contains('open') ? 'block' : 'none';
				if (arrow) arrow.style.transform = this.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
			}
		});
	});
	
	let deleteArtistBtn = $("#deleteArtistBtn");
	deleteArtistBtn.on("click",function(){
		Swal.fire({
			   title: '정말로 삭제 처리 하시겠습니까?',
			   text: '다시 되돌릴 수 없습니다. 신중하세요.',
			   icon: 'warning',
			   
			   showCancelButton: true, // cancel버튼 보이기. 기본은 원래 없음
			   confirmButtonColor: '#3085d6', // confrim 버튼 색깔 지정
			   cancelButtonColor: '#d33', // cancel 버튼 색깔 지정
			   confirmButtonText: '삭제', // confirm 버튼 텍스트 지정
			   cancelButtonText: '취소', // cancel 버튼 텍스트 지정
			   
			}).then(result => {
			   // 만약 Promise리턴을 받으면,
			    if(result.isConfirmed) { // 만약 모달창에서 confirm 버튼을 눌렀다면
					sweetAlert('success',"처리 완료");
			   		$("#deleteForm").submit();	
			   		
			    }
			});
	})
	
	
	// 목록 가기
	const listBtn = document.getElementById("listBtn");
	listBtn.addEventListener("click",function(){
		let searchWord = sessionStorage.getItem("searchWord");
		let currentPage = sessionStorage.getItem("currentPage");
		
		sessionStorage.removeItem("sarchWord");
		sessionStorage.removeItem("currentPage");
		
		location.href="/admin/community/artist/list?currentPage=" + currentPage +"&searchWord=" + searchWord; 
	})
});
</script>
</html>