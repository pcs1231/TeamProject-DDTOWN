<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>굿즈샵 주문내역 관리 - DDTOWN 관리자 시스템</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <%@ include file="../../../modules/headerPart.jsp" %>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/admin_order.css">
</head>
<body>
    <div class="emp-container">
        <%@ include file="../../modules/header.jsp" %>
        <div class="emp-body-wrapper">
            <%@ include file="../../modules/aside.jsp" %>
            <main class="emp-content">
                <section class="ea-section">
                    <div class="ea-section-header">
                        <h2>굿즈샵 주문내역 관리</h2>
                    </div>

                    <form id="searchForm" action="/admin/goods/orders/list" method="get" class="filter-group">
					    <input type="hidden" name="currentPage" value="${param.currentPage ne '' and param.currentPage ne null ? param.currentPage : 1}">
						
						<div class="filter-sub-group">
					    <label for="orderDateStart">주문일자:</label>
					    <input type="date" id="orderDateStart" name="orderDateStart" value="${param.orderDateStart}">
					    <span>~</span>
					    <input type="date" id="orderDateEnd" name="orderDateEnd" value="${param.orderDateEnd}">
						</div>
						
						<div class="filter-sub-group">
					    <label for="orderStatusFilter">주문상태:</label>
					    </div>
					    
					    <select id="orderStatusFilter" name="orderStatusFilter">
					        <option value="">전체</option>
					        <option value="OSC001" ${param.orderStatusFilter == 'OSC001' ? 'selected' : ''}>결제 완료</option>
					        <option value="OSC002" ${param.orderStatusFilter == 'OSC002' ? 'selected' : ''}>결제 실패</option>
					        <option value="OSC003" ${param.orderStatusFilter == 'OSC003' ? 'selected' : ''}>상품 준비중</option>
					        <option value="OSC004" ${param.orderStatusFilter == 'OSC004' ? 'selected' : ''}>배송 중</option>
					        <option value="OSC005" ${param.orderStatusFilter == 'OSC005' ? 'selected' : ''}>배송완료</option>
					        <option value="OSC006" ${param.orderStatusFilter == 'OSC006' ? 'selected' : ''}>취소 요청</option>
					        <option value="OSC007" ${param.orderStatusFilter == 'OSC007' ? 'selected' : ''}>취소 처리중</option>
					        <option value="OSC008" ${param.orderStatusFilter == 'OSC008' ? 'selected' : ''}>취소 완료</option>
					    </select>
					  
					    <div class="filter-sub-group search-group"> 
					    	<input type="text" id="orderSearchInput" name="orderSearchInput" placeholder="주문번호, 회원ID, 닉네임" value="${param.orderSearchInput}">
					        <button type="submit" id="orderSearchBtn" class="ea-btn"><i class="fas fa-search"></i> 검색</button>
					    </div>
					</form>
                    <table class="ea-table">
                        <thead>
                            <tr>
                                <th style="width:15%;">주문 번호</th>
                                <th style="width:15%;">주문 일시</th>
                                <th style="width:12%;">주문자(이름 / 아이디)</th>
                                <th style="width:12%;">총 주문금액</th>
                                <th style="width:10%;">결제 방법</th>
                                <th style="width:12%;">주문 상태</th>
                                <th style="width:10%;">관리</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <c:choose>
                                <c:when test="${not empty pagingVO.dataList}">
                                    <c:forEach var="order" items="${pagingVO.dataList}">
                                        <tr>
                                            <td>
                                                <a href="/admin/goods/orders/detail?orderNo=${order.orderNo}&amp;currentPage=${pagingVO.currentPage}&amp;orderDateStart=${param.orderDateStart}&amp;orderDateEnd=${param.orderDateEnd}&amp;orderStatusFilter=${param.orderStatusFilter}&amp;orderSearchInput=${param.orderSearchInput}" class="doc-link">
                                                    ${order.orderNo}
                                                </a>
                                            </td>
                                            <td><fmt:formatDate value="${order.orderDate}" pattern="yyyy-MM-dd HH:mm"/></td>
                                            <td>${order.customerName} (${order.customerId})</td>
                                            <td><fmt:formatNumber value="${order.orderTotalPrice}" pattern="#,###원"/></td>
                                            <td><span class="order-status-badge status-${order.orderPayMethodNm}">${order.orderPayMethodNm}</span></td>
                                           	<td>
											    <span class="order-status-badge status-${order.orderStatCode}">${order.orderStatName}</span>
											</td>
                                            <td>
                                                <a href="/admin/goods/orders/detail?orderNo=${order.orderNo}&amp;currentPage=${pagingVO.currentPage}&amp;orderDateStart=${param.orderDateStart}&amp;orderDateEnd=${param.orderDateEnd}&amp;orderStatusFilter=${param.orderStatusFilter}&amp;orderSearchInput=${param.orderSearchInput}" class="ea-btn sm"><i class="fas fa-eye"></i> 상세보기</a>
                                            </td>
                                        </tr>
                                    </c:forEach>
                                </c:when>
                                <c:otherwise>
                                    <tr>
                                        <td colspan="7" class="text-center">조회된 주문 내역이 없습니다.</td>
                                    </tr>
                                </c:otherwise>
                            </c:choose>
                        </tbody>
                    </table>
                    <div class="ea-pagination" id="pagingArea">
                    	${pagingVO.pagingHTML }
                    </div>
                </section>
            </main>
        </div>
    </div>
<%@ include file="../../../modules/footerPart.jsp" %>

<%@ include file="../../../modules/sidebar.jsp" %>
<script>
document.addEventListener('DOMContentLoaded', function() {

	//페이지네이션 처리 시작
	const searchForm = document.getElementById("searchForm");
    // hidden input의 name을 'currentPage'로 설정했으므로 동일하게 사용
    const pageInput = searchForm.querySelector("input[name='currentPage']");
    const paginationControls = document.getElementById("pagingArea");

    if (paginationControls) {
        paginationControls.addEventListener("click", function(e) {
            e.preventDefault();

            // 클릭된 요소가 'page-link' 클래스를 가지고 있고 'A' 또는 'SPAN' 태그인지 확인
            // data-page 속성에서 페이지 번호를 가져오므로 data-page 속성이 있는 요소만 처리
            const clickedElement = e.target.closest(".page-link"); // 가장 가까운 .page-link 부모를 찾음
            if (clickedElement && clickedElement.dataset.page) {
                pageInput.value = clickedElement.dataset.page; // data-page 속성 값으로 hidden input 업데이트
                searchForm.submit(); // 폼 제출
            }
        });
    }
    // 페이지네이션 처리 끝
})
</script>
</body>
</html>