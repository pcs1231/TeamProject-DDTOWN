<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="jakarta.tags.fmt" prefix="fmt" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="jakarta.tags.functions" prefix="fn" %>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artist A - ì»¤ë®¤ë‹ˆí‹°</title>
<link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/mainservice_common.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/pages/artist_community.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" ></script>
<%@ include file="../../modules/headerPart.jsp" %>
<style>
.membership-blur {
    filter: blur(5px);
    pointer-events: none;
}

.membership-only {
    position: relative;
}

.membership-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.membership-badge {
    background: #8a2be2;
    color: #fff;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.8em;
    margin-left: 5px;
}
</style>
</head>
<body>
    <!-- <header class="site-header">
        <div class="logo">
            <a href="../2.main/artist_community_main.html">DDTOWN SQUARE</a>
        </div>
        <nav class="utility-nav">
            <ul id="loggedOutNav">
                <li><a href="#" id="loginBtn" class="auth-link">ë¡œê·¸ì¸</a></li>
                <li><a href="signup.html" class="signup-link">íšŒì›ê°€ì…</a></li>
            </ul>
            <ul id="loggedInNav" style="display: none">
                <li>
                  <a href="#" id="notificationBtn" class="icon-btn" title="ì•Œë¦¼">ğŸ””</a>
                </li>
                <li>
                  <a href="#" id="myPageBtn" class="icon-btn" title="ë§ˆì´í˜ì´ì§€">ğŸ‘¤</a>
                </li>
                <li>
                  <a href="#" class="icon-btn" title="ê³ ê°ì„¼í„°">ğŸ‘©â€ğŸ’»</a>
                </li>
                <li><a href="#" id="logoutBtn" class="auth-link">ë¡œê·¸ì•„ì›ƒ</a></li>
              </ul>
        </nav>
        <div class="account-switch" style="margin-top:10px; text-align:right;">
            <button id="switchToArtist" style="margin-right:5px;">ì•„í‹°ìŠ¤íŠ¸ ê³„ì •</button>
            <button id="switchToFan">íŒ¬ ê³„ì •</button>
        </div>
    </header> -->
    <!-- nav class="main-navigation">
        <ul>
            <li><a href="#">êµ¿ì¦ˆìƒµ</a></li>
            <li>
                <a href="preference_vote.html">ì„ í˜¸ë„ ì¡°ì‚¬</a>
                <ul class="submenu">
                    <li><a href="preference_vote.html" style="color: #8a2be2; font-weight:bold;">ì¸ê¸° íˆ¬í‘œ</a></li>
                </ul>
            </li>
        </ul>
    </nav> -->
	<sec:authentication property="principal" var="user"/>
	
	    <c:out value="${user.username}"/>
    <div class="apt-main-layout">
        <div class="apt-container">
            <header class="apt-header">
                <div class="apt-header-avatar">
                    <div class="artist-avatar-placeholder">A</div><!-- ì•„í‹°ìŠ¤íŠ¸ ê·¸ë£¹ ì´ë¯¸ì§€ ë„£ì„ ì˜ˆì •-->
                </div>
                <div class="apt-header-info">
                    <h2><c:out value="${artistGroupVO.artGroupNm }" /> <span style="font-size:0.7em; color: #888;">(ì•„í‹°ìŠ¤íŠ¸)</span></h2>
                    <div class="artist-stats">
                        <span><c:out value="${artistGroupVO.communityVO.totalArtist }"/>ëª…</span> &bull; <span><fmt:formatNumber value="${artistGroupVO.communityVO.totalFan }" pattern="#,###"/></span> íŒ¬
                    </div>
                </div>
                <div class="apt-header-actions">
                <button class="btn-apt-action following" id="followToggleBtn">
                    <span class="follow-icon">âœ”</span> íŒ”ë¡œì‰ </button>
                <button class="btn-apt-action">ğŸ”” ì•Œë¦¼ ì„¤ì •</button>
            </div>
            </header>

            <ul class="nav apt-tabs" id="comuTab" role="tabList">
            	<li class="nav-item" role="presentation">
            		<button class="tab-item active" id="artistPost" data-bs-toggle="tab" data-bs-target="#artistPostList" type="button" role="tab" aria-controls="artistPostList" aria-selected="true">ì•„í‹°ìŠ¤íŠ¸</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="fanPost" data-bs-toggle="tab" data-bs-target="#fanPostList" type="button" role="tab" aria-controls="fanPostList" aria-selected="false">íŒ¬</button>
            	</li>
            	<li class="nav-item" role="presentation" >
            		<button class="tab-item" id="live" data-bs-toggle="tab" data-bs-target="#liveList" type="button" role="tab" aria-controls="liveList" aria-selected="false">ë¼ì´ë¸Œ</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="schedule" data-bs-toggle="tab" data-bs-target="#scheduleList" type="button" role="tab" aria-controls="scheduleList" aria-selected="false">ìŠ¤ì¼€ì¤„</button>
            	</li>
            	<li class="nav-item" role="presentation">
            		<button class="tab-item" id="noticeApt" data-bs-toggle="tab" data-bs-target="#noticeAptList" type="button" role="tab" aria-controls="noticeAptList" aria-selected="false">ê³µì§€ì‚¬í•­</button>
            	</li>
            </ul>

            <main class="apt-content-area">
                <div class="tab-pane show active" id="artistPostList" role="tabpanel" aria-labelledby="artistPost">
                    <div id="artistFeedSearchWrap" style="margin-bottom:10px; display:flex; gap:8px; align-items:center;">
                        <input type="text" id="artistFeedSearchInput" placeholder="ì•„í‹°ìŠ¤íŠ¸ ê²Œì‹œê¸€ ê²€ìƒ‰ (ì œëª©)" style="flex:1; padding:7px 10px; border:1px solid #ccc; border-radius:6px; font-size:0.95em;">
                        <sec:authorize access="hasAnyRole('MEMBER','MEMBERSHIP','EMPLOYEE','ADMIN')">
	                        <c:forEach items="${artistGroupVO.artistList }" var="artist">
	                        	<input type="radio" class="btn-check" name="artistNm" id="${artist.artNm }" />
	                        	<label class="btn btn-outline-primary" for="${artist.artNm }">${artist.artNm }</label>
	                        </c:forEach>
                        </sec:authorize>
                    </div>
                    <div id="editor">
                    
                    </div>
                    <div id="imgArea"></div>
                    <button type="button" id="postInserBtn">ì €ì¥</button>
                    <div id="artistFeedList">
                    	<c:forEach items="${artistPostVO }" var="post" >
                    		<c:if test="${post.boardTypeCode eq 'ARTIST_BOARD'}">
                    			<div class="feed-item" data-post-id="${post.comuPostNo }">
                    				<div class="feed-item-header">
                    					<div class="author-avatar" style="background-color:'#8a2be2'; color:'#fff';"><img src="${post.writerProfile.comuProfileImg }"></div>
                    					<div class="author-info">
                    						<span class="author-name" style="color:'#8a2be2';">${post.writerProfile.comuNicknm}</span>
                    						<span class="post-time">
	                    						<c:choose>
	                    							<c:when test="${post.comuPostRegDate ne post.comuPostModDate }">
			                    						<fmt:formatDate value="${post.comuPostModDate }" pattern="MM.dd. HH:mm"/>(ìˆ˜ì •ë¨)
	                    							</c:when>
	                    							<c:otherwise>
	                    								<fmt:formatDate value="${post.comuPostRegDate }" pattern="MM.dd. HH:mm"/>
	                    							</c:otherwise>
	                    						</c:choose>
                    						</span>
                    						<c:if test="${post.memberShipYn }">
                    							<span class="membership-badge" style="background:#8a2be2;color:#fff;padding:2px 6px;border-radius:10px;font-size:0.8em;margin-left:5px;">ë©¤ë²„ì‹­ ì „ìš©</span>
                    						</c:if>
                    					</div>
                    					<div class="post-options">
                    						<button class="post-options-btn" style="background:none;border:none;font-size:1.2em;cursor:pointer;">â€¢â€¢â€¢</button>
			                                <div class="post-options-menu" style="position:absolute;right:0;top:30px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.08);z-index:10;min-width:90px;">
				                                <sec:authorize access="hasRole('ARTIST') and ${user.name eq post.writerProfile.memUsername }">
				           							<div class="post-option-item" data-action="edit">ìˆ˜ì •</div>
				           							<div class="post-option-item" data-action="delete">ì‚­ì œ</div>
				                                </sec:authorize>
			                                </div>
                    					</div>
                    				</div>
                    				<div class="feed-item-content<c:if test="${post.memberShipYn }">membership-blur</c:if>" style="<c:if test="${post.memberShipYn }">'position:relative;'</c:if>">
                    					<div class="post-title" style="font-weight:bold;font-size:1.1em;margin-bottom:5px;">${post.comuPostTitle}</div>
                    					<p class="post-text">${post.comuPostContent}</p>
                    				</div>
                    				<div class="feed-item-actions">
			                            <button class="action-btn comment-toggle-btn">ğŸ’¬ ëŒ“ê¸€ <span class="count"><c:out value="${post.comuPostReplyCount }" /></span></button>
			                        </div>
			                        <div class="comments-wrapper" style="display:block;">
			                        	<div class="comment-form-container">
			                        		<textarea class="comment-textarea" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                    						<button class="btn-submit-comment" disabled>ë“±ë¡</button>
			                        	</div>
			                        	<div class="comment-list">
			                        		<c:forEach items="${post.comuPostReplyList }" var="reply">
				                        		<div class="comment-content">
				                        			<span class="comment-author-name"><c:out value="${reply.replyMember.comuNicknm }"/></span>
	                                				<p class="comment-text"><c:out value="${reply.comuReplyContent }"/></p>
				                        		</div>
			                        		</c:forEach>
			                        	</div>
			                        </div>
                    			</div>
                    		</c:if>
                    	</c:forEach>
                    </div>
                </div>
                <div class="tab-pane" id="fanPostList" role="tabpanel" aria-labelledby="fanPost">ddd</div>
                
				<div class="tab-pane" id="liveList" role="tabpanel" aria-labelledby="live">..d</div>
				
				<div class="tab-pane" id="scheduleList" role="tabpanel" aria-labelledby="schedule">.dd</div>
				<div class="tab-pane" id="noticeAptList" role="tabpanel" aria-labelledby="noticeApt">....</div>

            </main>
        </div>




<!-- /////////////////////////////////////////////////////////////////////////////////////////////////////// -->






        <aside class="apt-sidebar">
            <div class="sidebar-widget apt-level-widget">
                <h3>APT í˜„í™©</h3>
                <div class="apt-floor-display" id="aptFloorDisplay">123ì¸µ APT</div>
                <div class="fan-count-tooltip-wrapper"> <p class="fan-count-display">íŒ¬ <span id="sidebarFanCountApprox">ì•½ 12.3ë§Œ</span> ëª…</p> <span class="fan-count-tooltip" id="sidebarFanCountExact">123,456ëª…</span> </div>
            </div>

            <div class="sidebar-widget membership-widget">
                <div class="membership-icon">ğŸ›¡ï¸</div>
                <h3>Membership</h3>
                <p>ì§€ê¸ˆ ë©¤ë²„ì‹­ì— ê°€ì…í•˜ê³  Artist Aì˜ íŠ¹ë³„í•œ í˜œíƒì„ ëˆ„ë ¤ë³´ì„¸ìš”.</p>
                <button class="btn-join-membership" id="openMembershipModalBtn">
                    ë©¤ë²„ì‹­ ê°€ì…í•˜ê¸° <span class="arrow">&gt;</span>
                </button>
            </div>

             <!-- ë§ˆì´ í”„ë¡œí•„ ì˜ì—­ ì¶”ê°€ -->
             <div class="sidebar-widget my-profile-widget" style="margin-bottom: 20px; text-align: center; cursor: pointer;">
             	<div>
             		<button type="button" class="btn btn-outline-primary" id="registProfileBtn">í”„ë¡œí•„ ë§Œë“¤ê¸°</button>
             	</div>
                <div style="width: 80px; height: 80px; margin: 0 auto; border-radius: 50%; overflow: hidden; background-color: #e9ecef; display: flex; align-items: center; justify-content: center;">
                </div>
                <p id="myProfileNickname" style="margin-top: 8px; font-weight: bold; font-size: 1.1em;">ë‚˜ì˜ë©‹ì§„ë‹‰ë„¤ì„</p>
            </div>

        </aside>
    </div>

    <div id="footer-placeholder"></div>

     <div class="modal-overlay" id="membershipModalOverlay" style="display: none;">
        <div class="modal-content membership-modal">
            <button class="modal-close-btn" id="closeMembershipModalBtn" title="ë‹«ê¸°">&times;</button>
            <div class="modal-header">
                <h2>Artist A OFFICIAL MEMBERSHIP</h2>
                <p class="membership-duration">ì´ìš© ê¸°ê°„: ê²°ì œì¼ë¡œë¶€í„° 30ì¼</p>
            </div>
            <div class="modal-body">
                <div class="membership-main-image">
                </div>
                <h3>ì£¼ìš” í˜œíƒ ì•ˆë‚´</h3>
                <ul class="modal-benefits-list">
                    <li>âœ”ï¸ ë©¤ë²„ì‹­ ì „ìš© ì½˜í…ì¸  ì´ìš© ê°€ëŠ¥ (ì¼ë¶€ ë¸”ëŸ¬ ì²˜ë¦¬ëœ ì½˜í…ì¸  ì¦‰ì‹œ í•´ì œ!)</li>
                    <li>ğŸ—“ï¸ APT ë©”ì¸ ìƒë‹¨ì—ì„œ ì•„í‹°ìŠ¤íŠ¸ êµ¬ë…ì¼ D-Day í™•ì¸</li>
                    <li>ğŸ¤ ì½˜ì„œíŠ¸/íŒ¬ë¯¸íŒ… ì„ ì˜ˆë§¤ ë° íŠ¹ë³„ ì´ë²¤íŠ¸ ì°¸ì—¬ ê¸°íšŒ</li>
                    <li>ğŸ í•œì •íŒ ë©¤ë²„ì‹­ í‚¤íŠ¸ ì œê³µ (ë³„ë„ êµ¬ë§¤ ë˜ëŠ” ë“±ê¸‰ì— ë”°ë¼)</li>
                </ul>

                <h3>ì´ìš© ì•ˆë‚´ ë° ìœ ì˜ì‚¬í•­</h3>
                <ul class="modal-notes-list">
                    <li>ë³¸ ë©¤ë²„ì‹­ì€ ë¹„ìš©ì„ ì„ ì§€ë¶ˆí•˜ì—¬ ì´ìš©í•˜ëŠ” ìœ ë£Œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</li>
                    <li>ë©¤ë²„ì‹­ì€ ì•„í‹°ìŠ¤íŠ¸(ì†”ë¡œ, ê·¸ë£¹)ë³„ë¡œ ë³„ë„ ìš´ì˜ë˜ë©°, ë³¸ ë©¤ë²„ì‹­ì€ [Artist A] ì „ìš©ì…ë‹ˆë‹¤.</li>
                    <li>ê·¸ë£¹ ë‚´ ì†”ë¡œ í™œë™ ë©¤ë²„ ë°œìƒ ì‹œ, í•´ë‹¹ ë©¤ë²„ì˜ ì»¤ë®¤ë‹ˆí‹°ëŠ” ë³„ë„ ìƒì„±/ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>ìì„¸í•œ ë‚´ìš©ì€ êµ¬ë§¤ í˜ì´ì§€ì˜ ì•½ê´€ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <div class="membership-price">â‚©30,000 <span class="vat-notice">(VAT í¬í•¨)</span></div>
                <button class="btn-modal-purchase" id="goToPurchasePageBtn">ë©¤ë²„ì‹­ êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì»¤ë®¤ë‹ˆí‹° ê°€ì… ì˜¤ë²„ë ˆì´ -->
    <div id="communityOverlay" style="display:none;">
        <div class="community-overlay-bg"></div>
        <button id="joinCommunityBtn" class="join-community-btn">ì»¤ë®¤ë‹ˆí‹° ê°€ì…</button>
    </div>

    <!-- ë‹‰ë„¤ì„ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="nicknameModal" style="display:none;">
        <div class="nickname-modal-content">
            <h2>ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”</h2>
            <input type="text" id="nicknameInput" maxlength="12" placeholder="ë‹‰ë„¤ì„">
            <h2>í”„ë¡œí•„ ì´ë¯¸ì§€</h2>
			<div id="previewImgBox">
				<img alt="" src="" id="previewImg">
			</div>            
            <input type="file" id="profileImgBtn">
            <button id="nicknameSubmitBtn" disabled>ì™„ë£Œ</button>
        </div>
    </div>

    <!-- DM ëª¨ë‹¬ì´ ì‚½ì…ë  ì»¨í…Œì´ë„ˆ -->
    <div id="weverse-dm-modal-container"></div>

    <!-- DM ì—´ê¸° ë²„íŠ¼ (ì›í•˜ëŠ” ê³³ì— ë°°ì¹˜) -->
    <button onclick="openWeverseDM()">DM ì—´ê¸°</button>

<script>

$(function(){
	
	let files = [];
	let fileNum = 0;
	
	let area = $("#imgArea"); 
	
	const editor = new toastui.Editor({
        el: document.querySelector('#editor'),
        height: '200px',
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical',
        hideModeSwitch : true,
        toolbarItems: [
        	['heading','bold','italic','strike'],
        	['hr','ul','ol','indent','outdent'],
        	['image','link'],
        ],
        hooks : {
        	addImageBlobHook(blob, callback){
        		
        		files.push(blob);
        		
        		console.log("blob : ", blob);
        		
        		let reader = new FileReader();
        		reader.onload = function(e){
        			html = `
    					<div>
    						<img src="\${e.target.result}" style="width:100px; height:100px;" data-fileNum='\${fileNum}' >
    								<i class="bi bi-x-lg"></i>
    						</img>
    						
    					</div>
						`;
   					$("#imgArea").append(html);
	        		fileNum++;
        		}
        		reader.readAsDataURL(blob);
        		
        	}
        },
      });
	
	$("#postInserBtn").on("click",function(){
		let data = editor.getHTML();
		console.log("img : ", files);
		
	});
	
	area.on("click","i",function(){
		//$(this).parent("div");
		let cur = $(this).parent("div").children('img')[0].dataset.filenum;
		
		console.log("asdfa", cur);
	});

});

</script>
</body>
</html>