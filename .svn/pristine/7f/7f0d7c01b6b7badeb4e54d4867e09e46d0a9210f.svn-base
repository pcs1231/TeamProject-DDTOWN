<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="kr.or.ddit.ddtown.mapper.emp.postManagement.IPostManagementMapper">
 	<select id="getPost" parameterType="kr.or.ddit.vo.PaginationInfoVO" resultMap="post">
 		select * 
			from (
			select b.*
			from (SELECT 
			    ag.art_group_no
			  , ag.art_group_type_code
			  , ag.emp_username
			  , ag.art_group_debutdate
			  , ag.art_group_nm
			  , ag.art_group_content
			  , ag.art_group_reg_date
			  , ag.art_group_del_yn
			  , ag.art_group_profile_img
			  , ag.art_group_mod_date
			  
			  , agm.art_group_no
			  , agm.art_no
			  , agm.art_group_map_debutdate
			  , agm.art_del_yn
			  
			  , a.art_no
			  , a.mem_username
			  , a.art_nm
			  , a.art_content
			  , a.art_reg_date
			  , a.art_mod_date
			  , a.art_profile_img
			  , a.art_debutdate
			  , a.art_del_yn
			  
			  , cp.comu_profile_no
			  , cp.art_group_no
			  , cp.mem_username
			  , cp.comu_mem_cat_code
			  , cp.comu_profile_img
			  , cp.comu_nicknm
			  , cp.comu_reg_date
			  , cp.comu_del_yn
			  
			  , cpost.comu_post_no
			  , cpost.board_type_code
			  , cpost.comu_profile_no
			  , cpost.art_group_no
			  , cpost.file_group_no
			  , cpost.comu_post_stat_code
			  , cpost.comu_post_content
			  , cpost.comu_post_reg_date
			  , cpost.comu_post_mod_date
			  , cpost.comu_post_mbsp_yn
			  , cpost.comu_post_del_yn
			  
			  , (SELECT count(cl.comu_like_no) FROM community_like cl where cl.comu_post_no = cpost.comu_post_no) comu_like_no
			  , (select count(cr.comu_reply_no) from community_reply cr where cr.comu_post_no = cpost.comu_post_no) comu_reply_no
			  
			  , rownum as rnum
			FROM artist_group ag inner join artist_group_map agm on(ag.art_group_no = agm.art_group_no)
			                    inner join artist a on(agm.art_no = a.art_no)
			                    INNER join community_profile cp on(a.mem_username = cp.mem_username)
			                    inner join community_post cpost on(cp.comu_profile_no = cpost.comu_profile_no)
			where ag.emp_username = #{empUsername}
			AND   CP.COMU_MEM_CAT_CODE = 'CMCC003'
			order by cpost.comu_post_reg_date)b
			where rnum between #{startRow} and #{endRow})
 	</select>
 	
 	<select id="postTotalRecord" parameterType="String" resultType="int">
 		SELECT 
		   count(cpost.comu_post_no)
		FROM artist_group ag inner join artist_group_map agm on(ag.art_group_no = agm.art_group_no)
		                    inner join artist a on(agm.art_no = a.art_no)
		                    INNER join community_profile cp on(a.mem_username = cp.mem_username)
		                    inner join community_post cpost on(cp.comu_profile_no = cpost.comu_profile_no)
		where ag.emp_username = 'art001'
		AND   CP.COMU_MEM_CAT_CODE = 'CMCC003'
		order by cpost.comu_post_reg_date
 	</select>
 </mapper>